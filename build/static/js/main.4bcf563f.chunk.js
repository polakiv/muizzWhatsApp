(this["webpackJsonpuberclone-app"]=this["webpackJsonpuberclone-app"]||[]).push([[0],{127:function(e,t,n){},129:function(e,t,n){},135:function(e,t,n){},136:function(e,t,n){},138:function(e,t,n){},144:function(e,t,n){},145:function(e,t,n){},146:function(e,t,n){},147:function(e,t,n){},148:function(e,t,n){},149:function(e,t,n){},150:function(e,t,n){},151:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(15),i=n.n(r),s=(n(127),n(10)),o=n(6),l=n(14),u=n.n(l),d=n(23),h=n(216),j=n(184),m=n(185),f=n(187),b=n(188),g=(n(129),n(42)),p=n(186),O=n(25),v=n(1);function x(e){var t=e.dataList,n=e.title,c=e.path,r=e.fetchList,i=Object(O.b)(),s=Object(o.a)(i,2),l=s[0],u=l.roomsData,d=l.page,x=l.pathID,w=s[1],y=Object(a.useState)(!1),_=Object(o.a)(y,2),S=_[0],I=_[1],D=Object(a.useState)(null),L=Object(o.a)(D,2),N=L[0],R=L[1],k=Object(a.useRef)();return Object(a.useEffect)((function(){var e=null;r&&(e=function(){parseInt(k.current.scrollTop)===k.current.scrollHeight-k.current.offsetHeight&&r(I)},(null===t||void 0===t?void 0:t.length)>0&&k.current.addEventListener("scroll",e));var n=k.current;return function(){e&&n.removeEventListener("scroll",e)}}),[t,r]),Object(a.useEffect)((function(){(null===t||void 0===t?void 0:t.length)===(null===N||void 0===N?void 0:N.length)&&setTimeout((function(){Array.from(document.querySelectorAll(".animate")).forEach((function(e,t){setTimeout((function(){e.classList.remove("animate")}),50*t)}))}),10)}),[t,N]),Object(a.useEffect)((function(){if(t){var e=[];t.forEach((function(t){if(t){var a,r,i=(null===(a=u[t.id])||void 0===a?void 0:a.onlineState)?u[t.id].onlineState:t.state,s="Search Result"===n?null:(null===(r=u[t.id])||void 0===r?void 0:r.lastMessage)?u[t.id].lastMessage:t.lastMessage;("Rooms"===n||"Search Result"===n||"Chats"===n&&u[t.id].lastMessage||"Chats"!==n&&u[t.id])&&e.push(Object(v.jsx)(g.b,{className:"link",to:{pathname:c?"".concat(c,"/room/").concat(t.id):"/room/".concat(t.id),state:{photoURL:"".concat(t.photoURL?t.photoURL:"https://avatars.dicebear.com/api/human/".concat(t.id,".svg")),name:t.name,userID:t.userID?t.userID:null,state:t.state}},children:Object(v.jsxs)("div",{className:"sidebar__chat animate",children:[Object(v.jsxs)("div",{className:"avatar__container",children:[Object(v.jsx)(h.a,{style:{width:45,height:45},src:"".concat(t.photoURL?t.photoURL:"https://avatars.dicebear.com/api/human/".concat(t.id,".svg"))}),"online"===i?Object(v.jsx)("div",{className:"online"}):null]}),Object(v.jsxs)("div",{className:"sidebar__chat--info",children:[Object(v.jsx)("h2",{dangerouslySetInnerHTML:{__html:"\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043f\u043e\u0438\u0441\u043a\u0430"===n?t._highlightResult.name.value:t.name},style:{width:d.width<=760?d.width-126:.315*d.width-126,marginBottom:(null===s||void 0===s?void 0:s.message)||s?8:0}}),Object(v.jsx)("p",{style:{width:d.width<=760?d.width-126:.315*d.width-126},dangerouslySetInnerHTML:{__html:t.about}}),Object(v.jsx)("p",{style:{width:d.width<=760?d.width-126:.315*d.width-126},children:(null===s||void 0===s?void 0:s.message)?Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(j.a,{style:{width:19,height:19}})," ",Object(v.jsx)("span",{style:{width:d.width<=760?d.width-150:.315*d.width-150},children:s.message})," "]}):(null===s||void 0===s?void 0:s.audio)?Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(m.a,{style:{width:19,height:19}}),Object(v.jsx)("span",{style:{width:d.width<=760?d.width-150:.315*d.width-150},children:s.time})]}):""===(null===s||void 0===s?void 0:s.message)?Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(j.a,{style:{width:19,height:19}})," ",Object(v.jsx)("span",{style:{width:d.width<=760?d.width-150:.315*d.width-150},children:"Photo"})," "]}):s})]}),(null===t||void 0===t?void 0:t.unreadMessages)&&x!==t.id?Object(v.jsx)("div",{className:"sidebar__chat--unreadMessages",children:Object(v.jsx)("div",{children:t.unreadMessages})}):null]})},t.id))}else e.push(null)})),R(e)}}),[t,u,d,x]),Object(a.useEffect)((function(){d.width<=760?w({type:"SET_PATH",path:c}):w({type:"SET_PATH",path:""})}),[c,d]),Object(v.jsxs)("div",{ref:k,className:"sidebar__chat--container",children:[Object(v.jsxs)("h2",{className:"animate",children:[n," "]}),(null===t||void 0===t?void 0:t.length)>0?N:null===t&&"Chats"!==n?Object(v.jsx)("div",{className:"loader__container sidebar__loader",children:Object(v.jsx)(p.a,{})}):Object(v.jsxs)("div",{className:"no-result",children:[Object(v.jsxs)("div",{children:[Object(v.jsx)(f.a,{}),Object(v.jsx)("div",{className:"cancel-root",children:Object(v.jsx)(b.a,{})})]}),Object(v.jsxs)("h2",{children:[" ",n," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e "]})]}),Object(v.jsx)("div",{className:"loader__container scrollFetch",children:S?Object(v.jsx)(p.a,{}):null})]})}var w=Object(a.memo)(x),y=n(193),_=n(192),S=n(189),I=n(191),D=n(190),L=n(217),N=n.p+"static/media/tablets.13043575.png";var R=function(){var e=Object(a.useState)(!localStorage.getItem("role")),t=Object(o.a)(e,2),n=t[0],c=t[1],r=Object(a.useState)(localStorage.getItem("role")),i=Object(o.a)(r,2),s=i[0],l=i[1],u=function(){c(!0)};return Object(v.jsxs)("div",{children:[Object(v.jsxs)("span",{style:{cursor:"pointer"},onClick:function(){return u()},children:[Object(v.jsx)("img",{src:N,alt:"YouLrole",style:{maxWidth:40,paddingTop:20,cursor:"pointer"},onClick:function(){return u()}}),s]}),Object(v.jsxs)(S.a,{open:n,"aria-labelledby":"form-dialog-title",children:[Object(v.jsxs)(L.a,{id:"form-dialog-title",children:["\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0442\u043e \u0432\u044b \u0441\u0435\u0433\u043e\u0434\u043d\u044f:"," "]}),Object(v.jsx)(D.a,{children:Object(v.jsx)("img",{src:N,alt:"YouLrole",style:{maxWidth:"100%"}})}),Object(v.jsxs)(I.a,{style:{justifyContent:"space-around"},children:[Object(v.jsx)(_.a,{onClick:function(e){e.preventDefault(),localStorage.setItem("role","\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u044c"),localStorage.setItem("searchrole","\u041f\u0430\u0441\u0441\u0430\u0436\u0438\u0440"),c(!1),l("\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u044c")},color:"primary",children:"\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u044c"}),Object(v.jsx)(_.a,{onClick:function(e){e.preventDefault(),localStorage.setItem("role","\u041f\u0430\u0441\u0441\u0430\u0436\u0438\u0440"),localStorage.setItem("searchrole","\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u044c"),c(!1),l("\u041f\u0430\u0441\u0441\u0430\u0436\u0438\u0440")},color:"primary",children:"\u041f\u0430\u0441\u0441\u0430\u0436\u0438\u0440"})]})]})]})},k=n(196),E=n(197),M=n(198),U=n(199),C=n(21),T=(n(135),n.p+"static/media/notification.34e1d6f8.mp3"),P=n(96),H=n(5);n(39);function A(e){var t,n=e.chats,c=e.pwa,r=e.rooms,i=e.fetchRooms,s=e.users,l=e.fetchUsers,j=(e.usersSearch,e.fetchUsersSearch,Object(a.useState)(!1)),m=Object(o.a)(j,2),b=m[0],p=m[1],x=Object(a.useState)(null),_=Object(o.a)(x,2),S=(_[0],_[1],Object(a.useState)(null)),I=Object(o.a)(S,2),D=(I[0],I[1]),L=Object(a.useState)(null),N=Object(o.a)(L,2),A=N[0],F=N[1],W=Object(a.useState)(null),B=Object(o.a)(W,2),q=B[0],z=B[1],G=Object(a.useState)(""),X=Object(o.a)(G,2),Y=X[0],V=X[1],J=Object(a.useState)(1),K=Object(o.a)(J,2),Z=K[0],$=K[1],Q=Object(a.useState)(!1),ee=Object(o.a)(Q,2),te=ee[0],ne=ee[1],ae=Object(O.b)(),ce=Object(o.a)(ae,1)[0],re=ce.user,ie=ce.page,se=ce.pathID,oe=Object(C.g)(),le=new Audio(T),ue=Object(a.useRef)(function(){var e={};return n.forEach((function(t){return t.unreadMessages||0===t.unreadMessages?e[t.id]=t.unreadMessages:null})),e}());function de(){return(de=Object(d.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(document.querySelector(".sidebar__search input").blur(),t.preventDefault()),ie.width<=760&&oe.push("/search?"+Y),D(null),4!==Z&&$(4),n=s.filter((function(e,t,n){return e.name.toLowerCase().indexOf(Y.toLowerCase())>-1})),F(n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t=ie.width>760?function(e){return Object(v.jsx)("div",{className:"".concat(e.classSelected?"sidebar__menu--selected":""),onClick:e.click,children:e.children})}:g.c;function he(){return(he=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:3!==Z&&$(3),t=s.filter((function(e,t,n){return e.searchrole.toLowerCase().indexOf("\u041f\u0430\u0441\u0441\u0430\u0436\u0438\u0440".toLowerCase())>-1})),z(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(){return(je=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:2!==Z&&$(2),t=s.filter((function(e,t,n){return e.searchrole.toLowerCase().indexOf("\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u044c".toLowerCase())>-1})),z(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(){return(me=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:1!==Z&&$(1),oe.push("/");case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){var e={};n.forEach((function(t){(t.unreadMessages||0===t.unreadMessages)&&((t.unreadMessages>ue.current[t.id]||!ue.current[t.id]&&0!==ue.current[t.id])&&se!==t.id&&le.play(),e[t.id]=t.unreadMessages)})),ue.current=e}),[n,se]),Object(a.useEffect)((function(){ie.width<=760&&n&&!te&&(ne(!0),setTimeout((function(){document.querySelector(".sidebar").classList.add("side")}),10))}),[n,te]),Object(v.jsxs)("div",{className:"sidebar",style:{minHeight:ie.width<=760?ie.height:"auto"},children:[Object(v.jsxs)("div",{className:"sidebar__header",children:[Object(v.jsxs)("div",{className:"sidebar__header--left",children:[Object(v.jsx)(h.a,{src:null===re||void 0===re?void 0:re.photoURL,onClick:function(){p(!0)}}),Object(v.jsxs)("h4",{children:[null===re||void 0===re?void 0:re.displayName," "]})]}),Object(v.jsx)(P.a,{drawerLeft:b,setDrawerLeft:p,db:H.f,auth:H.b,storage:H.k}),Object(v.jsxs)("div",{className:"sidebar__header--right",children:[Object(v.jsx)(y.a,{onClick:function(){c?(console.log("prompting the pwa event"),c.prompt()):console.log("pwa event is undefined")},children:Object(v.jsx)(k.a,{})}),Object(v.jsx)(R,{uid:re.uid})]})]}),Object(v.jsx)("div",{className:"sidebar__search",children:Object(v.jsxs)("form",{className:"sidebar__search--container",children:[Object(v.jsx)(f.a,{}),Object(v.jsx)("input",{value:Y,onChange:function(e){return V(e.target.value)},placeholder:"\u041f\u043e\u0438\u0441\u043a",type:"text"}),Object(v.jsx)("button",{style:{display:"none"},type:"submit",onClick:function(e){return de.apply(this,arguments)}})]})}),Object(v.jsxs)("div",{className:"sidebar__menu",children:[Object(v.jsx)(t,{classSelected:1===Z,to:"/",click:function(){return me.apply(this,arguments)},activeClassName:"sidebar__menu--selected",children:Object(v.jsxs)("div",{className:"sidebar__menu--users",children:[Object(v.jsx)(E.a,{}),Object(v.jsx)("div",{className:"sidebar__menu--line"})]})}),Object(v.jsx)(t,{classSelected:2===Z,to:"/users",click:function(){return je.apply(this,arguments)},activeClassName:"sidebar__menu--selected",children:Object(v.jsxs)("div",{className:"sidebar__menu--users",children:[Object(v.jsx)(M.a,{}),Object(v.jsx)("div",{className:"sidebar__menu--line"})]})}),Object(v.jsx)(t,{classSelected:3===Z,to:"/users",click:function(){return he.apply(this,arguments)},activeClassName:"sidebar__menu--selected",children:Object(v.jsxs)("div",{className:"sidebar__menu--users",children:[Object(v.jsx)(U.a,{}),Object(v.jsx)("div",{className:"sidebar__menu--line"})]})})]}),ie.width<=760?Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)(C.d,{children:[Object(v.jsx)(C.b,{path:"/users",children:Object(v.jsx)(w,{fetchList:l,dataList:s,title:"Users",path:"/users"},"users")}),Object(v.jsx)(C.b,{path:"/rooms",children:Object(v.jsx)(w,{fetchList:i,dataList:r,title:"Rooms",path:"/rooms"},"rooms")}),Object(v.jsx)(C.b,{path:"/search",children:Object(v.jsx)(w,{fetchList:l,dataList:A,title:"Search Result",path:"/search"},"search")}),Object(v.jsx)(C.b,{path:"/chats",children:Object(v.jsx)(w,{dataList:n,title:"Chats",path:"/chats"},"chats")})]})}):1===Z?Object(v.jsx)(w,{fetchList:l,dataList:s},"users"):2===Z?Object(v.jsx)(w,{fetchList:l,dataList:q,title:"\u041f\u0430\u0441\u0441\u0430\u0436\u0438\u0440\u044b"},"usersPas"):3===Z?Object(v.jsx)(w,{fetchList:l,dataList:q,title:"\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u0438"},"usersDr"):4===Z?Object(v.jsx)(w,{fetchList:l,dataList:A,title:"\u041f\u043e\u0438\u0441\u043a"},"search"):null]})}var F=Object(a.memo)(A),W=n(36),B=n(41),q=n(213),z=n(214),G=n(80),X=n(203),Y=n(204),V=n(205),J=n(209),K=n(210),Z=n(211),$=n(215),Q=n(77),ee=n.n(Q),te=(n(144),Object(a.memo)((function(e){var t=e.imageSRC,n=e.mediaPreview,c=e.close,r=Object(a.useState)(""),i=Object(o.a)(r,2),s=i[0],l=i[1];return Object(a.useEffect)((function(){l(document.querySelector(".chat__body--container").offsetHeight)}),[]),Object(v.jsxs)("div",{ref:n,className:"mediaPreview",style:{height:s},children:[Object(v.jsx)(ee.a,{onClick:c}),Object(v.jsx)("img",{src:t,alt:""},t)]})}))),ne=(n(145),Object(a.memo)((function(e){var t=e.imagePreview,n=e.animState,c=Object(C.g)(),i=Object(a.useState)(!1),s=Object(o.a)(i,2),l=s[0],u=s[1],d=Object(O.b)(),h=Object(o.a)(d,1)[0].page;Object(a.useEffect)((function(){if(l){var e,a,c,r=h.height/h.width,i=document.querySelector(".imagePreview-container"),s=t.ratio?t.ratio:t.imgH/t.imgW;r<s?(c=!0,e=1/s*h.height,a=h.height):(c=!1,a=s*h.width,e=h.width),"entering"===n||"entered"===n?setTimeout((function(){document.querySelector(".imagePreview").style.backgroundColor="black",i.style.borderRadius="0px",i.style.transformOrigin="0% 0%",i.style.height=t.imgH+"px",i.style.transform=c?"translateX(".concat(h.width/2-e/2,"px) translateY(0px) scale(").concat(h.height/t.imgH,")"):"translateX(0px) translateY(".concat(h.height/2-a/2,"px) scale(").concat(h.width/t.width,")"),setTimeout((function(){document.querySelector(".imagePreview .MuiSvgIcon-root").classList.add("close-animate")}),300)}),10):"exiting"===n&&setTimeout((function(){document.querySelector(".imagePreview .MuiSvgIcon-root").classList.remove("close-animate"),setTimeout((function(){document.querySelector(".imagePreview").style.backgroundColor="transparent"}),200),i.style.borderRadius="10px",i.style.height=t.height+"px",i.style.transform="translateX(".concat(t.left,"px) translateY(").concat(t.top,"px) scale(1)")}),10)}}),[n,l]);var j={transform:"translateX(".concat(t.left,"px) translateY(").concat(t.top,"px) scale(1)"),width:t.width,height:t.height},m={};return h.height/h.width>t.ratio||h.height/h.width===t.ratio?m.minWidth="100%":(m.minHeight="100%",t.imgW<t.width&&(m.minWidth="100%")),Object(r.createPortal)(Object(v.jsxs)("div",{className:"imagePreview",onClick:function(){return document.querySelector(".imagePreview .MuiSvgIcon-root").classList.toggle("close-animate")},children:[Object(v.jsx)(ee.a,{onClick:function(){return c.goBack()}}),Object(v.jsx)("div",{className:"imagePreview-container",style:j,children:Object(v.jsx)("img",{style:m,onLoad:function(){return u(!0)},src:t.src,alt:""})})]}),document.querySelector(".app"))}))),ae=n(200),ce=n(201),re=n(202),ie=n(212);function se(){return new Promise((function(e){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){var n=new MediaRecorder(t),a=[];n.addEventListener("dataavailable",(function(e){a.push(e.data)}));e({start:function(){n.start()},stop:function(){return new Promise((function(e){n.addEventListener("stop",(function(){var t=Object(ie.a)(),n=new File(a,t,{type:"audio/mpeg"}),c=URL.createObjectURL(n),r=new Audio(c);e({audioFile:n,audioUrl:c,play:function(){r.play()},audioName:t})})),n.stop()}))}})}))}))}n(146);var oe=function(e){return new Promise((function(t){return setTimeout(t,e)}))},le=Object(a.memo)((function(e){var t=e.input,n=e.handleFocus,c=e.change,r=e.sendMessage,i=e.setFocus,s=e.image,l=e.focus,h=e.state,j=e.token,f=e.roomID,b=e.setAudioID,g=Object(a.useState)(!1),p=Object(o.a)(g,2),x=p[0],w=p[1],y=Object(a.useState)("00:00"),_=Object(o.a)(y,2),S=_[0],I=_[1],D=Object(O.b)(),L=Object(o.a)(D,1)[0].user,N=Object(a.useRef)(),R=Object(a.useRef)(),k=Object(a.useRef)(),E=Object(a.useRef)();function M(e,t,n){return U.apply(this,arguments)}function U(){return(U=Object(d.a)(u.a.mark((function e(t,n,a){var c,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.f.collection("rooms").doc(f).set(Object(B.a)({},L.uid,!1),{merge:!0}),H.f.collection("rooms").doc(f).set({lastMessage:{audio:!0,time:n},seen:!1},{merge:!0}),h.userID?(H.f.collection("users").doc(h.userID).collection("chats").doc(f).set({timestamp:Object(H.c)(),photoURL:L.photoURL?L.photoURL:null,name:L.displayName,userID:L.uid,unreadMessages:Object(H.g)(1)},{merge:!0}),H.f.collection("users").doc(L.uid).collection("chats").doc(f).set({timestamp:Object(H.c)(),photoURL:h.photoURL?h.photoURL:null,name:h.name,userID:h.userID},{merge:!0})):H.f.collection("users").doc(L.uid).collection("chats").doc(f).set({timestamp:Object(H.c)(),photoURL:h.photoURL?h.photoURL:null,name:h.name}),e.next=6,H.f.collection("rooms").doc(f).collection("messages").add({name:L.displayName,uid:L.uid,timestamp:Object(H.c)(),time:(new Date).toUTCString(),audioUrl:"uploading",audioName:a,audioPlayed:!1});case 6:return c=e.sent,e.next=9,H.a.child(a).put(t);case 9:return e.next=11,H.a.child(a).getDownloadURL();case 11:r=e.sent,H.f.collection("rooms").doc(f).collection("messages").doc(c.id).update({audioUrl:r}),h.userID&&""!==j&&H.f.collection("notifications").add({userID:L.uid,title:L.displayName,body:"\ud83c\udf99\ufe0f "+n,photoURL:L.photoURL,token:j});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){return(C=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!window.navigator.onLine){e.next=15;break}return l&&R.current.focus(),e.next=5,oe(150);case 5:return e.next=7,se();case 7:return E.current=e.sent,b(null),R.current.style.width="calc(100% - 56px)",e.next=12,oe(305);case 12:w(!0),e.next=16;break;case 15:alert("No access to internet !!!");case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(){return P.apply(this,arguments)}function P(){return(P=Object(d.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l&&R.current.focus(),H.f.collection("rooms").doc(f).set(Object(B.a)({},L.uid,!1),{merge:!0}),clearInterval(k.current),t=E.current.stop(),N.current.style.opacity="0",e.next=7,oe(300);case 7:return w(!1),R.current.style.width="calc(100% - 112px)",n=S,I("00:00"),e.abrupt("return",[t,n]);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){return(A=Object(d.a)(u.a.mark((function e(){var t,n,a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T();case 2:return t=e.sent,n=Object(o.a)(t,2),a=n[0],c=n[1],e.next=8,a;case 8:M((a=e.sent).audioFile,c,a.audioName);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){var t=e+"";return t.length<2?"0"+t:t}function W(){var e=Date.now();k.current=setInterval((function(){var t=Date.now()-e,n=Math.floor(t/1e3);I(F(parseInt(n/60))+":"+F(n%60))}),100)}Object(a.useEffect)((function(){x&&function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(10);case 2:return N.current.style.opacity="1",e.next=5,oe(100);case 5:W(),H.f.collection("rooms").doc(f).set(Object(B.a)({},L.uid,"recording"),{merge:!0}),E.current.start();case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[x]);var z=Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(q.a,{in:""!==t||""===t&&s,timeout:{enter:400,exit:200},classNames:"send__animate2",children:Object(v.jsx)(ae.a,{style:{width:20,height:20,color:"white"}})}),Object(v.jsx)(q.a,{in:!(""!==t||""===t&&s),timeout:{enter:400,exit:200},classNames:"send__animate",children:Object(v.jsx)(m.a,{style:{width:24,height:24,color:"white"}})})]});return Object(v.jsxs)("div",{className:"chat__footer",onBlur:function(e){e.currentTarget.contains(e.relatedTarget)||x||i(!1)},children:[Object(v.jsxs)("form",{children:[Object(v.jsx)("input",{ref:R,value:t,onClick:n,onChange:x?null:c,onKeyPress:x?function(){return!1}:null,onFocus:function(){return i(!0)},placeholder:"\u041f\u0438\u0448\u0438\u0442\u0435"}),navigator.mediaDevices.getUserMedia&&window.MediaRecorder?Object(v.jsx)("button",{type:"submit",className:"send__btn",onClick:""!==t||""===t&&s?r:function(e){return C.apply(this,arguments)},children:z}):Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)("label",{for:"capture",className:"send__btn",children:z}),Object(v.jsx)("input",{style:{display:"none"},type:"file",id:"capture",accept:"audio/*",capture:!0,onChange:function(e){if(window.navigator.onLine){var t=e.target.files[0];if(t){b(null);var n=new Audio(URL.createObjectURL(t));n.addEventListener("loadedmetadata",(function(){var e=Math.floor(n.duration),a=F(parseInt(e/60))+":"+F(e%60);M(t,a,Object(ie.a)())}))}}else alert("\u041d\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0443!")}})]})]}),x?Object(v.jsxs)("div",{ref:N,className:"record",children:[Object(v.jsx)(ce.a,{style:{width:30,height:30,color:"#F20519"},onClick:T}),Object(v.jsxs)("div",{children:[Object(v.jsx)("div",{className:"record__redcircle"}),Object(v.jsx)("div",{className:"record__duration",children:S})]}),Object(v.jsx)(re.a,{style:{width:30,height:30,color:"#41BF49"},onClick:function(){return A.apply(this,arguments)}})]}):null]})})),ue=n(105),de=n.n(ue),he=n(79),je=n(107),me=n.n(je),fe=n(106),be=n.n(fe),ge=n(108),pe=n.n(ge),Oe=(n(147),Object(a.memo)((function(e){var t=e.sender,n=e.roomID,c=e.audioUrl,r=e.id,i=e.setAudioID,s=e.audioID,l=e.animState,h=e.audioPlayed,j=Object(a.useState)(!1),m=Object(o.a)(j,2),f=m[0],b=m[1],g=Object(a.useState)(!1),O=Object(o.a)(g,2),x=O[0],w=O[1],y=Object(a.useState)(!1),_=Object(o.a)(y,2),S=_[0],I=_[1],D=Object(a.useState)(!1),L=Object(o.a)(D,2),N=L[0],R=L[1],k=Object(a.useState)(!1),E=Object(o.a)(k,2),M=E[0],U=E[1],C=Object(a.useState)(0),T=Object(o.a)(C,2),P=T[0],A=T[1],F=Object(a.useState)("0%"),W=Object(o.a)(F,2),B=W[0],q=W[1],z=Object(a.useState)(""),G=Object(o.a)(z,2),X=G[0],Y=G[1],V=Object(a.useRef)(""),J=Object(a.useRef)(new Audio(c)),K=Object(a.useRef)(),Z=Object(a.useRef)("uploading"===c);function $(){var e=0;isNaN(J.current.duration)||(e=J.current.currentTime*(100/J.current.duration),A(e),q(e+"%"),Y(function(){var e=Math.floor(J.current.currentTime/60),t=Math.floor(J.current.currentTime-60*e);return t<10&&(t="0"+t),e<10&&(e="0"+e),e+":"+t}()))}return Object(a.useEffect)((function(){!0===Z.current&&"uploading"!==c?(J.current=new Audio(c),J.current.load(),I(!0)):!1===Z.current&&I(!0)}),[c]),Object(a.useEffect)((function(){var e;S&&(J.current.addEventListener("error",(function(){U(!0)})),(e=J.current,new Promise((function(t,n){e.onloadedmetadata=function(){e.currentTime=Number.MAX_SAFE_INTEGER,e.ontimeupdate=function(){e.ontimeupdate=function(){},e.currentTime=.1,e.currentTime=0,t(e.duration)}}}))).then((function(){R(!0)})))}),[S]),Object(a.useEffect)((function(){N&&(J.current.addEventListener("canplaythrough",Object(d.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:""===V.current&&(w(!0),t=Math.floor(J.current.duration/60),(n=Math.floor(J.current.duration-60*t))<10&&(n="0"+n),t<10&&(t="0"+t),V.current=t+":"+n,Y(V.current));case 1:case"end":return e.stop()}}),e)})))),J.current.addEventListener("ended",(function(){clearInterval(K.current),Y(V.current),A(0),q("0%"),b(!1)})))}),[N]),Object(a.useEffect)((function(){"exiting"===l&&J.current.pause()}),[l]),Object(a.useEffect)((function(){s!==r&&(J.current.pause(),b(!1))}),[s]),Object(v.jsxs)(v.Fragment,{children:[Object(v.jsxs)("div",{className:"".concat(t?"audioplayer":"audioplayer audioplayer2"," ").concat(h?"audioplayer__played":""),children:[x||M?f&&!M?Object(v.jsx)(be.a,{className:"pause",onClick:function(){J.current.pause(),clearInterval(K.current),b(!1),Y(V.current)}}):f||M?Object(v.jsx)(pe.a,{onClick:function(){J.current.load(),U(!1)}}):Object(v.jsx)(me.a,{onClick:function(){J.current.play(),h||t||H.f.collection("rooms").doc(n).collection("messages").doc(r).set({audioPlayed:!0},{merge:!0}),s!==r&&i(r),K.current=setInterval($,50),b(!0)}}):Object(v.jsx)(p.a,{}),Object(v.jsxs)("div",{children:[Object(v.jsx)("span",{style:{width:B},className:"audioplayer__slider--played"}),Object(v.jsx)("input",{type:"range",min:"1",max:"100",value:P,onChange:function(e){var t=e.target.value;if(x){var n=J.current.duration*(t/100);J.current.currentTime=n,A(t),q("".concat(t-t/100*5.7,"%"))}},className:"audioplayer__slider"})]})]}),Object(v.jsx)("span",{className:"chat__timestamp audioplayer__time",children:X})]})}))),ve=(n(148),n.p+"static/media/message_sent.3957aabd.mp3"),xe=n.p+"static/media/message_received.7170470c.mp3",we=n(206),ye=n(207),_e=n(208);function Se(e){var t,n,c,r,i=e.animState,l=e.unreadMessages,j=e.b,m=Object(a.useState)(""),f=Object(o.a)(m,2),b=f[0],x=f[1],w=Object(C.i)().roomID,_=Object(C.h)(),S=Object(C.j)(),I=Object(O.b)(),D=Object(o.a)(I,3),L=D[0],N=L.dispatchMessages,R=L.user,k=L.roomsData,E=L.page,M=D[1],U=D[2],T=Object(a.useState)({}),P=Object(o.a)(T,2),A=P[0],F=P[1],Q=Object(a.useState)([]),ee=Object(o.a)(Q,2),ae=ee[0],ce=ee[1],re=Object(a.useState)(null),se=Object(o.a)(re,2),oe=se[0],ue=se[1],je=Object(a.useState)(!1),me=Object(o.a)(je,2),fe=me[0],be=me[1],ge=Object(a.useState)(!1),pe=Object(o.a)(ge,2),Se=pe[0],Ie=pe[1],De=Object(a.useState)(""),Le=Object(o.a)(De,2),Ne=Le[0],Re=Le[1],ke=Object(a.useState)(_.state?_.state:{}),Ee=Object(o.a)(ke,2),Me=Ee[0],Ue=Ee[1],Ce=Object(a.useState)(!1),Te=Object(o.a)(Ce,2),Pe=Te[0],He=Te[1],Ae=Object(a.useState)(!1),Fe=Object(o.a)(Ae,2),We=Fe[0],Be=Fe[1],qe=Object(a.useState)(""),ze=Object(o.a)(qe,2),Ge=ze[0],Xe=ze[1],Ye=Object(a.useState)(null),Ve=Object(o.a)(Ye,2),Je=Ve[0],Ke=Ve[1],Ze=Object(a.useState)(0),$e=Object(o.a)(Ze,2),Qe=$e[0],et=$e[1],tt=Object(a.useState)(!1),nt=Object(o.a)(tt,2),at=nt[0],ct=nt[1],rt=Object(a.useState)(!1),it=Object(o.a)(rt,2),st=it[0],ot=it[1],lt=Object(a.useState)(null),ut=Object(o.a)(lt,2),dt=ut[0],ht=ut[1],jt=Object(a.useState)(!1),mt=Object(o.a)(jt,2),ft=mt[0],bt=mt[1],gt=Object(a.useState)(!1),pt=Object(o.a)(gt,2),Ot=pt[0],vt=pt[1],xt=Object(a.useState)(Boolean(null===(t=N[w])||void 0===t?void 0:t.limitReached)),wt=Object(o.a)(xt,2),yt=wt[0],_t=wt[1],St=Object(C.g)(),It=Object(a.useRef)(),Dt=Object(a.useRef)(),Lt=Object(a.useRef)(),Nt=Object(a.useRef)(),Rt=Object(a.useRef)(),kt=Object(a.useRef)([]),Et=Object(a.useRef)(30),Mt=Object(a.useRef)(null),Ut=Object(a.useState)(null),Ct=Object(o.a)(Ut,2),Tt=Ct[0],Pt=Ct[1],Ht=Object(a.useRef)(null),At=Object(a.useRef)(null),Ft=Object(a.useState)(!1),Wt=Object(o.a)(Ft,2),Bt=Wt[0],qt=Wt[1],zt=new Audio(ve),Gt=new Audio(xe),Xt=Object(a.useRef)([]),Yt=Object(a.useRef)(!1),Vt=function(){Rt.current.style.animation="opacity-out 300ms ease forwards",setTimeout((function(){Ke(null),Xe("")}),310)};function Jt(e){if(e){var t=e.offsetHeight,n=getComputedStyle(e);return t+=parseInt(n.marginTop)+parseInt(n.marginBottom)}return null}var Kt=function(){var e=Object(d.a)(u.a.mark((function e(t){var n,a,c,r,i,s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),Se&&document.querySelector(".chat__footer > form > input").focus(),!(""!==b||""===b&&Je)){e.next=16;break}return n=b,(a=Je)&&Vt(),x(""),c={lastMessage:a?{message:n,audio:!1}:n,seen:!1},H.f.collection("rooms").doc(w).set(c,{merge:!0}),a&&(r=a.name.split("."),i=r[0]+Object(ie.a)()+"."+r[1]),s=a?{name:R.displayName,message:b,uid:R.uid,timestamp:Object(H.c)(),time:(new Date).toLocaleString("ru",{year:"numeric",month:"long",day:"numeric",weekday:"long",timezone:"UTC",hour:"numeric",minute:"numeric"}),imageUrl:"uploading",imageName:i,ratio:at}:{name:R.displayName,message:b,uid:R.uid,timestamp:Object(H.c)(),time:(new Date).toLocaleString("ru",{year:"numeric",month:"long",day:"numeric",weekday:"long",timezone:"UTC",hour:"numeric",minute:"numeric"})},Me.userID?(H.f.collection("users").doc(Me.userID).collection("chats").doc(w).set({timestamp:Object(H.c)(),photoURL:R.photoURL?R.photoURL:null,name:R.displayName,userID:R.uid,unreadMessages:Object(H.g)(1)},{merge:!0}),H.f.collection("users").doc(R.uid).collection("chats").doc(w).set({timestamp:Object(H.c)(),photoURL:Me.photoURL?Me.photoURL:null,name:Me.name,userID:Me.userID},{merge:!0}),""===Ne||a||H.f.collection("notifications").add({userID:R.uid,title:R.displayName,body:n,photoURL:R.photoURL,token:Ne})):H.f.collection("users").doc(R.uid).collection("chats").doc(w).set({timestamp:Object(H.c)(),photoURL:Me.photoURL?Me.photoURL:null,name:Me.name}),e.next=14,H.f.collection("rooms").doc(w).collection("messages").add(s);case 14:o=e.sent,a&&new de.a(a,{quality:.8,maxWidth:1920,success:function(e){return Object(d.a)(u.a.mark((function t(){var a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Xe(""),Ke(null),t.next=4,H.j.child(i).put(e);case 4:return t.next=6,H.j.child(i).getDownloadURL();case 6:a=t.sent,H.f.collection("rooms").doc(w).collection("messages").doc(o.id).update({imageUrl:a}),Me.userID&&""!==Ne&&H.f.collection("notifications").add({userID:R.uid,title:R.displayName,body:n,photoURL:R.photoURL,token:Ne,image:a});case 9:case"end":return t.stop()}}),t)})))()}});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Zt=function(){var e=Object(d.a)(u.a.mark((function e(){var t,n,a,c,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.navigator.onLine){e.next=24;break}return ue(!1),be(!0),e.prev=3,t=H.f.collection("rooms").doc(w),e.next=7,t.collection("messages").get();case 7:return n=e.sent,a=[],c=[],n.docs.forEach((function(e){e.data().audioName?a.push(e.data().audioName):e.data().imageName&&c.push(e.data().imageName)})),r=[],r=Me.userID?[Me.userID,R.uid]:Object(W.a)(new Set(n.docs.map((function(e){return e.data().uid})))),e.next=15,Promise.all([].concat(Object(W.a)(n.docs.map((function(e){return e.ref.delete()}))),Object(W.a)(c.map((function(e){return H.j.child(e).delete()}))),Object(W.a)(a.map((function(e){return H.a.child(e).delete()}))),Object(W.a)(r.map((function(e){return H.f.collection("users").doc(e).collection("chats").doc(w).delete()}))),[t.delete()]));case 15:E.width<=760?St.goBack():St.replace("/chats"),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(3),console.log(e.t0.message),E.width<=760?St.goBack():St.replace("/chats");case 22:e.next=25;break;case 24:alert("\u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u043e\u043c!!!");case 25:case"end":return e.stop()}}),e,null,[[3,18]])})));return function(){return e.apply(this,arguments)}}();function $t(e){var t=H.f.collection("rooms").doc(w).collection("messages").orderBy("timestamp","desc");e?j.current[w]=t.limit(5).onSnapshot((function(t){var n=t.docs.map((function(e){var t,n=e.data(),a=n.time?n.time:new Date(null===(t=n.timestamp)||void 0===t?void 0:t.toDate()).toUTCString();return Object(s.a)(Object(s.a)({},n),{},{timestamp:a,id:e.id})}));n.reverse(),M({type:U.SET_MESSAGES,id:w,messages:n,update:e})})):t.limit(Et.current).get().then((function(t){var n=[];t.forEach((function(e){var t,a=e.data(),c=a.time?a.time:new Date(null===(t=a.timestamp)||void 0===t?void 0:t.toDate()).toUTCString();n.push(Object(s.a)(Object(s.a)({},a),{},{timestamp:c,id:e.id}))})),n.reverse(),M({type:U.SET_MESSAGES,id:w,messages:n,update:e})}))}function Qt(){var e;0!==(null===(e=Lt.current)||void 0===e?void 0:e.scrollTop)||yt||Ht.current?At.current&&(Mt.current=Lt.current.scrollHeight-Lt.current.scrollTop):(qt(!0),Mt.current=Lt.current.scrollHeight,Ht.current=!0,At.current=!0,Et.current=ae.length+Et.current,$t(!1))}function en(e){return H.f.collection("rooms").doc(w).collection("messages").doc(e).onSnapshot((function(t){var n=t.data().imageUrl;"uploading"!==n&&(M({type:"update_media",roomID:w,id:e,data:{imageUrl:n}}),Xt.current=Xt.current.filter((function(t){return t.id!==e||(t.snap(),!1)})))}))}function tn(e){return H.f.collection("rooms").doc(w).collection("messages").doc(e).onSnapshot((function(t){var n=t.data(),a=n.audioUrl,c=n.audioPlayed;"uploading"===a&&!0!==c||M({type:"update_media",roomID:w,id:e,data:{audioUrl:a,audioPlayed:c}}),"uploading"!==a&&!0===c&&(Xt.current=Xt.current.filter((function(t){return t.id!==e||(t.snap(),!1)})))}))}Object(a.useEffect)((function(){var e,t,n;ae.length>0&&!fe&&(ae[ae.length-1].id!==(null===(e=kt.current[(null===(t=kt.current)||void 0===t?void 0:t.length)-1])||void 0===e?void 0:e.id)&&(null===(n=N[w])||void 0===n?void 0:n.audio)&&(ae[ae.length-1].uid===R.uid||At.current||"uploading"!==ae[ae.length-1].imageUrl&&ae[ae.length-1].imageUrl?ae[ae.length-1].uid!==R.uid||At.current||"uploading"!==ae[ae.length-1].imageUrl&&ae[ae.length-1].imageUrl||"uploading"!==ae[ae.length-1].audioUrl&&ae[ae.length-1].audioUrl||zt.play():Gt.play()))}),[ae,fe,N[w]]),Object(a.useEffect)((function(){ft&&!yt&&Lt.current.addEventListener("scroll",Qt);var e=Lt.current;return function(){e.removeEventListener("scroll",Qt)}}),[ft,yt]),Object(a.useEffect)((function(){var e,t;yt!==(null===(e=N[w])||void 0===e?void 0:e.limitReached)&&_t(Boolean(null===(t=N[w])||void 0===t?void 0:t.limitReached))}),[N[w]],yt),Object(a.useLayoutEffect)((function(){var e;ae.length>0&&Ht.current&&(Ht.current&&ae.length>(null===(e=kt.current)||void 0===e?void 0:e.length)&&(Lt.current.scrollTop=Lt.current.scrollHeight-Mt.current,Ht.current=!1,qt(!1)))}),[ae]),Object(a.useEffect)((function(){ae.length>0&&(ft||Lt.current.scrollHeight-Lt.current.offsetHeight===0?At.current||function(){var e=Array.from(document.querySelectorAll(".chat__message")),t=Jt(e[e.length-2])+Jt(e[e.length-3])+Jt(e[e.length-4]),n=t<E.height/2?t:E.height/2;Lt.current.scrollHeight-Lt.current.offsetHeight===0?(setTimeout((function(){It.current&&(It.current.style.opacity="1"),bt(!0)}),"entering"===i?350:50),setTimeout((function(){var e=document.querySelector(".chat .chat__lastMessage");e&&(e.style.animation="none",e.style.opacity="1")}),50)):Lt.current.scrollTop+Jt(e[e.length-1])>=Lt.current.scrollHeight-Lt.current.offsetHeight-n&&ae[ae.length-1].uid!==R.uid||ae[ae.length-1].uid===R.uid?Lt.current.scrollTop!==Lt.current.scrollHeight&&(vt(!0),Object(he.a)({targets:Lt.current,scrollTop:Lt.current.scrollHeight,duration:800,easing:"linear",complete:function(){vt(!1)}})):ot(!0)}():(Lt.current.scrollTop=Lt.current.scrollHeight,setTimeout((function(){var e=document.querySelector(".chat .chat__lastMessage");e&&(e.style.animation="none",e.style.opacity="1"),setTimeout((function(){bt(!0)}),200)}),50)))}),[ae]),Object(a.useEffect)((function(){return function(){M({type:"set_audio_false",id:w})}}),[w]),Object(a.useEffect)((function(){if(ae.length>0&&ft&&!Yt.current)ae.forEach((function(e){if("uploading"===e.imageUrl){var t=en(e.id);Xt.current.push({snap:t,id:e.id})}else if("uploading"===e.audioUrl||!1===e.audioPlayed){var n=tn(e.id);Xt.current.push({snap:n,id:e.id})}})),Yt.current=!0;else if(ae.length>kt.current.length&&ft&&Yt.current){var e,t=0,n=ae.length-kt.length;(null===(e=kt.current[0])||void 0===e?void 0:e.id)===ae[0].id&&(t=kt.current.length,n=ae.length);for(var a=t;a<n;a++)if("uploading"===ae[a].imageUrl){var c=en(ae[a].id);Xt.current.push({snap:c,id:ae[a].id})}else if("uploading"===ae[a].audioUrl||!1===ae[a].audioPlayed){var r=tn(ae[a].id);Xt.current.push({snap:r,id:ae[a].id})}}}),[ae,ft]),Object(a.useEffect)((function(){return function(){Xt.current.forEach((function(e){return e.snap()})),bt(!1)}}),[w]),Object(a.useEffect)((function(){At.current=Ht.current,kt.current=Object(W.a)(ae)}),[ae]),Object(a.useEffect)((function(){var e;w&&!fe&&(j.current[w]&&j.current[w](),(null===(e=N[w])||void 0===e?void 0:e.firstMessageID)?$t(!0):H.f.collection("rooms").doc(w).collection("messages").orderBy("timestamp","asc").limit(1).get().then((function(e){e.empty?M({type:"set_firstMessage",id:w,firstMessageID:"no id"}):e.forEach((function(e){M({type:"set_firstMessage",id:w,firstMessageID:e.id})})),$t(!1),$t(!0)})))}),[w,fe]),Object(a.useEffect)((function(){if(""!==Ge){var e=document.querySelector(".mediaPreview img").clientWidth,t=document.querySelector(".mediaPreview img").clientHeight;ct(t/e)}}),[Ge]),Object(a.useEffect)((function(){ht(document.querySelector(".chat__body--container").clientWidth)}),[]),Object(a.useEffect)((function(){"entering"===i&&E.width<=760?setTimeout((function(){document.querySelector(".chat").classList.add("chat-animate")}),0):"entered"===i&&(null===Me||void 0===Me?void 0:Me.name)&&E.width<=760?setTimeout((function(){document.querySelector(".sidebar").classList.remove("side")}),50):"exiting"===i&&E.width<=760&&setTimeout((function(){document.querySelector(".chat").classList.remove("chat-animate"),setTimeout((function(){document.querySelector(".sidebar").classList.add("side")}),10)}),0)}),[i]),Object(a.useEffect)((function(){if(!_.state&&w){var e=null===w||void 0===w?void 0:w.replace(R.uid,"");H.f.collection("users").doc(e).get().then((function(t){var n=t.data();Ue((null===n||void 0===n?void 0:n.name)?{name:n.name,photoURL:n.photoURL,userID:e}:{userID:e})}))}else Ue(_.state)}),[_.state,w]),Object(a.useEffect)((function(){(null===Me||void 0===Me?void 0:Me.userID)&&H.f.collection("users").doc(Me.userID).onSnapshot((function(e){var t;(null===(t=e.data())||void 0===t?void 0:t.token)&&Re(e.data().token)}))}),[Me]),Object(a.useEffect)((function(){if(w&&(null===Me||void 0===Me?void 0:Me.userID))var e=H.f.collection("rooms").doc(w).onSnapshot((function(e){e.data()&&Be(e.data()[Me.userID])}));return function(){e&&e()}}),[w,Me]),Object(a.useEffect)((function(){if(w)var e=H.f.collection("rooms").doc(w).onSnapshot((function(e){var t;He(null===(t=e.data())||void 0===t?void 0:t.seen)}));return function(){e&&e()}}),[w]),Object(a.useEffect)((function(){var e=function(){var e,t,n,a=Array.from(document.querySelectorAll(".chat__message")),c=Jt(a[a.length-1])+Jt(a[a.length-2])+Jt(a[a.length-3])+Jt(a[a.length-4]),r=c<E.height/2?c:E.height/2;(null===(e=Lt.current)||void 0===e?void 0:e.scrollTop)<=(null===(t=Lt.current)||void 0===t?void 0:t.scrollHeight)-(null===(n=Lt.current)||void 0===n?void 0:n.offsetHeight)-r?ot(!0):ot(!1);var s=Math.round(Lt.current.scrollTop),o=Lt.current.scrollHeight-Lt.current.offsetHeight;s!==o&&s+1!==o&&s-1!==o||"0"!==It.current.style.opacity&&""!==It.current.style.opacity||setTimeout((function(){It.current&&(It.current.style.opacity="1")}),"entering"===i?350:50),ae.length>0&&(Lt.current.scrollTop>Lt.current.scrollHeight-Lt.current.offsetHeight-180&&Me.userID&&!Pe&&ae[ae.length-1].uid!==R.uid&&(console.log("setting seen true with event"),H.f.collection("rooms").doc(w).set({seen:!0},{merge:!0})),Lt.current.scrollTop>Lt.current.scrollHeight-Lt.current.offsetHeight-180&&Me.userID&&H.f.collection("users").doc(R.uid).collection("chats").doc(w).set({unreadMessages:0},{merge:!0}))};Lt.current.addEventListener("scroll",e);var t=Lt.current;return function(){t.removeEventListener("scroll",e)}}),[ae,Me,R.uid,w,Pe]),Object(a.useEffect)((function(){ae.length>0&&Lt.current.scrollHeight-Lt.current.offsetHeight===0&&ae[ae.length-1].uid!==R.uid&&H.f.collection("rooms").doc(w).set({seen:!0},{merge:!0})}),[ae]),Object(a.useEffect)((function(){ae.length>0&&Lt.current.scrollHeight-Lt.current.offsetHeight===0&&Me.userID&&H.f.collection("users").doc(R.uid).collection("chats").doc(w).set({unreadMessages:0},{merge:!0})}),[ae,Me]),Object(a.useEffect)((function(){var e;(null===(e=N[w])||void 0===e?void 0:e.messages)&&ce(N[w].messages)}),[N[w]]);var nn=.7;return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsxs)("div",{style:w?{}:{display:"none"},ref:Nt,className:"chat",children:[Object(v.jsx)("div",{style:{height:E.height},className:"chat__background"}),Object(v.jsxs)("div",{className:"chat__header",children:[E.width<=760?Object(v.jsxs)(y.a,{onClick:function(){return setTimeout((function(){return St.goBack()}),150)},children:[Object(v.jsx)(X.a,{}),Object(v.jsxs)("div",{className:"avatar__container",children:[Object(v.jsx)(h.a,{src:null===Me||void 0===Me?void 0:Me.photoURL}),"online"===(null===(n=k[w])||void 0===n?void 0:n.onlineState)?Object(v.jsx)("div",{className:"online"}):null]})]}):Object(v.jsxs)("div",{className:"avatar__container",children:[Object(v.jsx)(h.a,{src:null===Me||void 0===Me?void 0:Me.photoURL}),"online"===(null===(c=k[w])||void 0===c?void 0:c.onlineState)?Object(v.jsx)("div",{className:"online"}):null]}),Object(v.jsxs)("div",{className:"chat__header--info",children:[Object(v.jsxs)("h3",{style:E.width<=760?{width:E.width-165}:{},children:[null===Me||void 0===Me?void 0:Me.name," fdsfsdfsdf65465456",null===Me||void 0===Me?void 0:Me.about]}),Object(v.jsxs)("p",{style:E.width<=760?{width:E.width-165}:{},children:["recording"===We?"\u0417\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f ...":We?"\u041f\u0438\u0448\u0435\u0442 ...":(null===ae||void 0===ae?void 0:ae.length)>0?"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e "+(null===(r=ae[ae.length-1])||void 0===r?void 0:r.timestamp):""," "]})]}),Object(v.jsxs)("div",{className:"chat__header--right",children:[Object(v.jsx)("input",{id:"attach-media",style:{display:"none"},accept:"image/*",type:"file",onChange:function(e){if(window.navigator.onLine){if(e.target.files[0]){var t=new FileReader;t.onload=function(){Xe(t.result)},t.readAsDataURL(e.target.files[0]),Ke(e.target.files[0])}}else alert("\u041d\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0443!")}}),Object(v.jsx)(y.a,{children:Object(v.jsx)("label",{style:{cursor:"pointer",height:24},htmlFor:"attach-media",children:Object(v.jsx)(Y.a,{})})}),Object(v.jsx)(y.a,{"aria-controls":"menu","aria-haspopup":"true",onClick:function(e){return ue(e.currentTarget)},children:Object(v.jsx)(V.a,{})}),Object(v.jsxs)(Z.a,{anchorEl:oe,id:"menu",open:Boolean(oe),onClose:function(){return ue(null)},keepMounted:!0,children:[Object(v.jsxs)($.a,{onClick:Zt,children:[Object(v.jsx)(we.a,{})," \u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f"]}),Object(v.jsxs)($.a,{onClick:function(){H.b.signOut(),H.f.doc("/users/"+R.uid).set({state:"offline"},{merge:!0}),St.replace("/chats"),setTimeout((function(){window.location.reload()}),1e3)},children:[Object(v.jsx)(ye.a,{})," \u0412\u044b\u0439\u0442\u0438"]}),Object(v.jsxs)($.a,{onClick:function(){H.b.signOut(),H.f.doc("/users/"+R.uid).set({state:"offline"},{merge:!0}),St.replace("/chats"),setTimeout((function(){window.location.reload()}),1e3)},children:[Object(v.jsx)(_e.a,{})," \u0412\u044b\u0439\u0442\u0438 \u0432 \u043e\u0444\u0444\u043b\u0430\u0439\u043d"]})]})]})]}),Object(v.jsx)("div",{className:"chat__body--container",ref:Lt,children:Object(v.jsxs)("div",{className:"chat__body",ref:It,children:[Object(v.jsx)("div",{className:"loader__container paginateLoader",style:{height:yt?30:70},children:Bt&&!yt?Object(v.jsx)(p.a,{}):null}),ae.map((function(e,t,n){var a=(e.imageUrl,{marginBottom:n[t+1]?e.uid!==n[t+1].uid?30:8:0,width:dt*nn+20,maxWidth:320});return Object(v.jsxs)("div",{style:a,ref:t!==ae.length-1||Pe&&ae[ae.length-1].uid===R.uid?null:Dt,className:"chat__message ".concat(e.uid===R.uid&&"chat__reciever"," ").concat(t===ae.length-1?"chat__lastMessage":""),children:[Object(v.jsx)("span",{className:"chat__name",children:e.name}),"uploading"===e.imageUrl?Object(v.jsx)("div",{style:{width:dt*nn,height:e.ratio<=1?dt*nn>300?300*e.ratio:dt*nn*e.ratio:dt*nn<300?dt*nn:300},className:"image-container",children:Object(v.jsx)("div",{className:"image__container--loader",children:Object(v.jsx)(p.a,{style:{width:E.width<=760?40:80,height:E.width<=760?40:80}})})}):e.imageUrl?Object(v.jsx)("div",{className:"image-container",style:{width:dt*nn,height:e.ratio<=1?dt*nn>300?300*e.ratio:dt*nn*e.ratio:dt*nn<300?dt*nn:300},children:Object(v.jsx)(g.b,{to:{pathname:S.url+"/image",state:Me},children:Object(v.jsx)("img",{onClick:function(t){return function(e,t,n){var a=e.target,c=a.parentNode.parentNode,r=c.getBoundingClientRect();F({ratio:n,top:"scale(1)"===E.transform?r.top:r.top/(window.innerHeight/E.height),left:"scale(1)"===E.transform?r.left:r.left/(window.innerWidth/E.width),width:c.offsetWidth,height:c.offsetHeight,imgW:a.offsetWidth,imgH:a.offsetHeight,src:t})}(t,e.imageUrl,e.ratio)},src:e.imageUrl,alt:""})})}):null,e.audioName?Object(v.jsx)(Oe,{sender:e.uid===R.uid,roomID:w,animState:i,setAudioID:Pt,audioID:Tt,id:e.id,audioUrl:e.audioUrl,audioPlayed:e.audioPlayed}):Object(v.jsx)("span",{className:"chat__message--message",children:e.message}),Object(v.jsx)("span",{className:"chat__timestamp",children:e.timestamp})]},e.id)})),ae.length>0?Object(v.jsx)(q.a,{in:Pe&&ae[ae.length-1].uid===R.uid,timeout:200,classNames:"seen-animate",appear:!0,children:Object(v.jsx)("p",{className:"seen",children:Object(v.jsx)("p",{children:Object(v.jsxs)("span",{children:["\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e ",Object(v.jsx)(J.a,{})]})})})}):null]})}),""!==Ge?Object(v.jsx)(te,{close:Vt,mediaPreview:Rt,setSRC:Xe,setImage:Ke,imageSRC:Ge}):null,Object(v.jsx)(le,{input:b,handleFocus:function(){Lt.current.scrollTop>Lt.current.scrollHeight-Lt.current.offsetHeight-120&&(Lt.current.scrollTop=Lt.current.scrollHeight)},change:function(e){clearTimeout(Qe),x(e.target.value),(null===Me||void 0===Me?void 0:Me.userID)&&H.f.collection("rooms").doc(w).set(Object(B.a)({},R.uid,!0),{merge:!0}).then((function(){et(setTimeout((function(){H.f.collection("rooms").doc(w).set(Object(B.a)({},R.uid,!1),{merge:!0})}),1e3))}))},sendMessage:Kt,setFocus:Ie,image:Je,focus:Se,state:Me,token:Ne,roomID:w,setAudioID:Pt}),Object(v.jsx)("div",{}),Object(v.jsx)(q.a,{in:ft&&st&&!Ot,classNames:"scroll",timeout:310,unmountOnExit:!0,children:Object(v.jsxs)("div",{className:"scroll",onClick:function(){return Object(he.a)({targets:Lt.current,scrollTop:Lt.current.scrollHeight,duration:1e3,easing:"linear"})},children:[Object(v.jsx)(K.a,{style:{width:22,height:22,color:"black"}}),l?Object(v.jsx)("div",{children:Object(v.jsx)("span",{children:l})}):null]})}),fe?Object(v.jsx)("div",{className:"chat__deleting",children:Object(v.jsx)(p.a,{})}):null]}),Object(v.jsx)(z.a,{component:null,children:Object(v.jsx)(G.a,{timeout:{appear:310,enter:310,exit:410},classNames:"page",children:function(e){return Object(v.jsx)(C.b,{path:S.url+"/image",location:_,children:Object(v.jsx)(ne,{imagePreview:A,animState:e})})}},_.pathname)})]})}var Ie=Object(a.memo)(Se);n(149);function De(){return Object(v.jsxs)("div",{className:"login",children:[Object(v.jsxs)("div",{className:"nono",children:[" ",Object(v.jsx)(R,{})]}),Object(v.jsxs)("div",{className:"login__container",children:[Object(v.jsx)("img",{src:"/logo.png",alt:"UberClone"}),Object(v.jsx)("div",{className:"login__text",children:Object(v.jsx)("h1",{children:"\u0412\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 UberClone"})}),Object(v.jsx)(_.a,{onClick:function(){H.b.signInWithRedirect(H.i).catch((function(e){return alert(e.message)}))},children:"\u0432\u043c\u0435\u0441\u0442\u0435 \u0441 \u0413\u0443\u0433\u043b"})]})]})}var Le=Object(a.memo)(De);n(150);var Ne=n(72);function Re(e,t,n,c,r){var i=Object(a.useRef)(0),s=Object(a.useRef)(),l=Object(a.useState)(null),u=Object(o.a)(l,2),d=u[0],h=u[1],j=Object(a.useRef)(0);return[d,function a(o){if(i.current||0===i.current){"limit attended"===i.current?(o(!1),i.current=null):(o(!0),i.current=i.current+e),s.current&&s.current(),n&&(j.current=0);var l=null,u=i.current?t.limit(i.current):t;s.current=u.onSnapshot((function(e){var t,n;j.current++;var s=function(){var t=c(e);h(t),o(!1),("users"===r&&t.length<i.current-1||"users"!==r&&t.length<i.current)&&(i.current="limit attended",a(o))};(null===(t=e.docs)||void 0===t?void 0:t.length)>0?j.current>=2?(l&&(clearTimeout(l),l=null),s()):l=setTimeout(s,1500):0===(null===(n=e.docs)||void 0===n?void 0:n.length)&&(h([]),o(!1))}))}return s},h]}var ke=c.a.lazy((function(){return Promise.all([n.e(3),n.e(4)]).then(n.bind(null,253))}));localStorage.setItem("gps","47.6758555, 38.0625965"),localStorage.setItem("gps_sum","85"),localStorage.setItem("lng","38.0625965"),localStorage.setItem("lat","47.6758555"),navigator.geolocation.getCurrentPosition((function(e){var t=e.coords.latitude,n=e.coords.longitude,a=t+", "+n,c=t+n;localStorage.setItem("lat",t),localStorage.setItem("lng",n),localStorage.setItem("gps",a),localStorage.setItem("gps_sum",c);var r=e.coords.accuracy;localStorage.setItem("accuracy",r)}));function Ee(){var e=Object(O.b)(),t=Object(o.a)(e,3),n=t[0],c=n.user,r=n.path,i=n.pathID,l=n.roomsData,u=n.page,d=t[1],h=t[2],j=Object(a.useState)(!0),m=Object(o.a)(j,2),f=m[0],b=m[1],g=Object(a.useState)(void 0),x=Object(o.a)(g,2),w=x[0],y=x[1],_=Object(a.useState)(!1),S=Object(o.a)(_,2),I=S[0],D=(S[1],Object(a.useState)(!0)),L=Object(o.a)(D,2),N=(L[0],L[1],Object(a.useState)(null)),R=Object(o.a)(N,2),k=R[0],E=R[1],M=Object(a.useState)(),U=Object(o.a)(M,2),T=U[0],P=U[1],A=Object(C.h)(),W=function(){var e=Object(O.b)(),t=Object(o.a)(e,2),n=t[0].roomsData,c=t[1],r=Object(a.useRef)(n);return Object(a.useEffect)((function(){r.current=n}),[n]),[function(e,t){if(!r.current[t]){var n=H.f.collection("rooms").doc(t).onSnapshot((function(e){var n;c({type:"update_rooms_data",dataType:"lastMessage",data:null===(n=e.data())||void 0===n?void 0:n.lastMessage,roomID:t})})),a=H.f.collection("users").doc(e).onSnapshot((function(e){var n;c({type:"update_rooms_data",dataType:"onlineState",data:null===(n=e.data())||void 0===n?void 0:n.state,roomID:t})}));c({type:"add_rooms_data",roomID:t,lastMessageListener:n,onlineStatelistener:a})}}]}(),B=Object(o.a)(W,1)[0],X=Object(a.useRef)([]),Y=["/rooms","/search","/users","/chats"],V=Re(30,H.f.collection("rooms").orderBy("timestamp","desc"),!0,(function(e){return e.docs.map((function(e){return Object(s.a)({id:e.id},e.data())}))}),"rooms"),J=Object(o.a)(V,2),K=J[0],Z=J[1],$=Re(30,H.f.collection("users").where("state","==","online"),!0,(function(e){var t=[];return e.docs.length>0&&e.docs.forEach((function(e){var n=e.id>c.uid?e.id+c.uid:c.uid+e.id;e.id!==c.uid&&(t.push(Object(s.a)(Object(s.a)({},e.data()),{},{id:n,userID:e.id})),B(e.id,n))})),t}),"users"),Q=Object(o.a)($,2),ee=Q[0],te=Q[1];return console.log(ee),Object(a.useEffect)((function(){H.b.onAuthStateChanged((function(e){if(e){d({type:h.SET_USER,user:e}),b(!1),"serviceWorker"in navigator&&"PushManager"in window&&(n=e.uid,H.h.requestPermission().then((function(){return H.h.getToken()})).then((function(e){H.f.collection("users").doc(n).set({token:e},{merge:!0})})).catch((function(e){H.f.collection("users").doc(n).set({token:""},{merge:!0})})));var t=H.f.collection("users").doc(e.uid);t.get().then((function(n){var a=n.data();return a&&a.timestamp?t.set({name:e.displayName,photoURL:e.photoURL,about:"",phone:"",role:localStorage.getItem("role"),searchrole:localStorage.getItem("searchrole")},{merge:!0}):t.set({name:e.displayName,photoURL:e.photoURL,timestamp:Object(H.c)(),about:"",phone:"",role:localStorage.getItem("role"),searchrole:localStorage.getItem("searchrole")},{merge:!0})}))}else d({type:h.SET_USER,user:null});var n}))}),[]),Object(a.useEffect)((function(){window.addEventListener("beforeinstallprompt",(function(e){e.preventDefault(),y(e)})),window.addEventListener("resize",(function(){d({type:"set_scale_page",page:Object(Ne.a)()})}))}),[]),Object(a.useEffect)((function(){c&&(H.f.collection("users").doc(c.uid).collection("chats").orderBy("timestamp","desc").onSnapshot({includeMetadataChanges:!0},(function(e){var t;(null===(t=e.docs)||void 0===t?void 0:t.length)>0?(e.docChanges().forEach((function(e){"added"===e.type&&B(e.doc.data().userID,e.doc.id)})),(!e.metadata.fromCache||!window.navigator.onLine&&e.metadata.fromCache)&&E(e.docs.map((function(e){return Object(s.a)(Object(s.a)({},e.data()),{},{id:e.id})})))):E([])})),Z((function(){return null})),te((function(){return null})))}),[c]),Object(a.useEffect)((function(){(null===k||void 0===k?void 0:k.length)>0?k.every((function(e){var t;return null===(t=l[e.id])||void 0===t?void 0:t.lastMessage}))&&P(!0):0===(null===k||void 0===k?void 0:k.length)&&P(!0)}),[k,l]),Object(a.useEffect)((function(){var e;return c&&function(e){try{console.log(localStorage.getItem("gps_sum").substring(4,-4)),console.log(localStorage.getItem("gps_sum"));var t={state:"offline",last_changed:H.d,id:e,latitude:localStorage.getItem("lat"),longitude:localStorage.getItem("lng"),coord:localStorage.getItem("gps"),coord_sum:localStorage.getItem("gps_sum").substring(4,-4),role:localStorage.getItem("role"),searchrole:localStorage.getItem("searchrole")},n={state:"online",last_changed:H.d,id:e,latitude:localStorage.getItem("lat"),longitude:localStorage.getItem("lng"),coord:localStorage.getItem("gps"),coord_sum:localStorage.getItem("gps_sum").substring(4,-4),role:localStorage.getItem("role"),searchrole:localStorage.getItem("searchrole")},a=H.f.doc("/users/"+e),c=H.e.ref("/status/"+e),r={state:"offline",last_changed:Object(H.c)(),latitude:localStorage.getItem("lat"),longitude:localStorage.getItem("lng"),coord:localStorage.getItem("gps"),coord_sum:localStorage.getItem("gps_sum").substring(4,-4),role:localStorage.getItem("role"),searchrole:localStorage.getItem("searchrole")},i={state:"online",last_changed:Object(H.c)(),latitude:localStorage.getItem("lat"),longitude:localStorage.getItem("lng"),coord:localStorage.getItem("gps"),coord_sum:localStorage.getItem("gps_sum").substring(4,-4),role:localStorage.getItem("role"),searchrole:localStorage.getItem("searchrole")};H.e.ref(".info/connected").on("value",(function(e){!1!==e.val()?c.onDisconnect().set(t).then((function(){c.set(n),a.set(i,{merge:!0})})):a.set(r,{merge:!0})}))}catch(s){console.log("error setting onlins status: ",s)}}(c.uid),function(){e}}),[c]),Object(a.useEffect)((function(){var e=A.pathname.replace("/room/","");Y.forEach((function(t){return e=e.replace(t,"")})),d({type:"set_path_id",id:e})}),[A.pathname]),Object(v.jsxs)("div",{className:"app",children:[u.width<=760?Object(v.jsx)(C.a,{to:"/chats"}):Object(v.jsx)(C.a,{to:"/"}),c||!f||I?c&&!I&&T?Object(v.jsxs)("div",{className:"app__body",children:[Object(v.jsx)(F,{chats:k,pwa:w,rooms:K,fetchRooms:Z,users:ee,fetchUsers:te}),Object(v.jsx)(a.Suspense,{fallback:Object(v.jsx)("div",{children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."}),children:Object(v.jsx)(ke,{users:ee,fetchUsers:te})}),Object(v.jsx)(z.a,{component:null,children:u.width<=760?Object(v.jsx)(G.a,{timeout:260,children:function(e){var t;return Object(v.jsx)(C.b,{location:A,path:"".concat(r,"/room/:roomID"),children:Object(v.jsx)(Ie,{b:X,unreadMessages:(null===k||void 0===k?void 0:k.length)>0?null===(t=k.find((function(e){return e.id===i})))||void 0===t?void 0:t.unreadMessages:0,animState:e})})}},A.pathname.replace("/image","")):Object(v.jsx)(q.a,{timeout:1010,classNames:"page",children:function(e){var t;return Object(v.jsx)(C.b,{location:A,path:"".concat(r,"/room/:roomID"),children:Object(v.jsx)(Ie,{b:X,unreadMessages:(null===k||void 0===k?void 0:k.length)>0?null===(t=k.find((function(e){return e.id===i})))||void 0===t?void 0:t.unreadMessages:0,animState:e})})}},A.pathname.replace("/image",""))})]}):Object(v.jsx)("div",{className:"loader__container",children:Object(v.jsx)(p.a,{})}):Object(v.jsx)(Le,{})]})}var Me=Object(a.memo)(Ee),Ue=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ce(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var Te=n(62);void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((function(n,a){t.call(navigator,e,n,a)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),i.a.render(Object(v.jsx)(c.a.StrictMode,{children:Object(v.jsx)(g.a,{children:Object(v.jsx)(O.a,{initialState:Te.c,reducer:Te.b,children:Object(v.jsx)(Me,{})})})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");Ue?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Ce(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):Ce(t,e)}))}}()},25:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return l}));var a=n(36),c=n(0),r=n(62),i=n(1),s=Object(c.createContext)(),o=function(e){var t=e.reducer,n=e.initialState,o=e.children;return Object(i.jsx)(s.Provider,{value:[].concat(Object(a.a)(Object(c.useReducer)(t,n)),[r.a]),children:o})},l=function(){return Object(c.useContext)(s)}},5:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"i",(function(){return o})),n.d(t,"c",(function(){return l})),n.d(t,"h",(function(){return d})),n.d(t,"g",(function(){return h})),n.d(t,"j",(function(){return j})),n.d(t,"k",(function(){return m})),n.d(t,"a",(function(){return f})),n.d(t,"e",(function(){return i})),n.d(t,"d",(function(){return u}));var a=n(39),c=(n(139),n(154),n(141),n(152),n(153),a.a.initializeApp({apiKey:"AIzaSyBEEA2tvNgeHIYxDRJgkxDfZIBguDnybPc",authDomain:"whatsapp2-a5f92.firebaseapp.com",databaseURL:"https://whatsapp2-a5f92-default-rtdb.firebaseio.com",projectId:"whatsapp2-a5f92",storageBucket:"whatsapp2-a5f92.appspot.com",messagingSenderId:"1023177696506",appId:"1:1023177696506:web:a180739d1dd334d1f7d543",measurementId:"G-XG4H351X5E"})),r=c.firestore(),i=c.database(),s=c.auth(),o=new a.a.auth.GoogleAuthProvider,l=a.a.firestore.FieldValue.serverTimestamp,u=a.a.database.ServerValue.TIMESTAMP,d="serviceWorker"in navigator&&"PushManager"in window?a.a.messaging():null,h=a.a.firestore.FieldValue.increment,j=(a.a.firestore.FieldValue.arrayUnion,a.a.storage().ref("images")),m=a.a.storage(),f=a.a.storage().ref("audios");t.f=r},62:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return o}));var a=n(41),c=n(36),r=n(10),i=n(72),s={user:null,path:"",pathID:"",dispatchMessages:{},audioID:null,roomsData:{},page:Object(i.a)()},o={SET_USER:"SET_USER",SET_MESSAGES:"SET_MESSAGES"};t.b=function(e,t){var n;switch(t.type){case"set_scale_page":return Object(r.a)(Object(r.a)({},e),{},{page:t.page});case o.SET_USER:return Object(r.a)(Object(r.a)({},e),{},{user:t.user});case"SET_PATH":return Object(r.a)(Object(r.a)({},e),{},{path:t.path});case"set_path_id":return Object(r.a)(Object(r.a)({},e),{},{pathID:t.id});case o.SET_MESSAGES:var i=e.dispatchMessages;if(t.update){if(i[t.id].messages)if(0===i[t.id].messages.length)t.messages.length>0&&(i[t.id]={messages:t.messages,limitReached:i[t.id].limitReached,firstMessageID:i[t.id].firstMessageID,audio:e.pathID===t.id});else if(i[t.id].messages.length>0&&0===t.messages.length)i[t.id]={messages:[],limitReached:!0,firstMessageID:void 0,audio:!1};else{var s,l=i[t.id].messages.length-t.messages.length,u=0!==l;if(l>=0)for(var d=0;d<t.messages.length-2&&(u=t.messages[d].id===i[t.id].messages[l+d+1].id);d++);else for(d=0;d<i[t.id].messages.length-2&&(u=t.messages[d].id===i[t.id].messages[d].id);d++);if(u)s=l>=0?[].concat(Object(c.a)(i[t.id].messages.slice(0,l+1)),Object(c.a)(t.messages)):Object(c.a)(t.messages),i[t.id]={messages:s,limitReached:i[t.id].limitReached,firstMessageID:i[t.id].firstMessageID,audio:e.pathID===t.id&&u}}return Object(r.a)(Object(r.a)({},e),{},{dispatchMessages:i})}return i[t.id]={messages:t.messages,limitReached:"no id"===i[t.id].firstMessageID||(null===(n=t.messages[0])||void 0===n?void 0:n.id)===i[t.id].firstMessageID,firstMessageID:i[t.id].firstMessageID,audio:!1},Object(r.a)(Object(r.a)({},e),{},{dispatchMessages:i});case"set_audio_false":var h=e.dispatchMessages;return h[t.id]=Object(r.a)(Object(r.a)({},h[t.id]),{},{audio:!1}),Object(r.a)(Object(r.a)({},e),{},{dispatchMessages:h});case"set_firstMessage":var j=e.dispatchMessages;return j[t.id]?j[t.id].firstMessageID=t.firstMessageID:j[t.id]={firstMessageID:t.firstMessageID},Object(r.a)(Object(r.a)({},e),{},{dispatchMessages:j});case"update_media":var m=e.dispatchMessages,f=m[t.roomID].messages,b=f.findIndex((function(e){return e.id===t.id}));return f[b]=Object(r.a)(Object(r.a)({},f[b]),t.data),m[t.roomID]={messages:f,limitReached:m[t.roomID].limitReached,firstMessageID:m[t.roomID].firstMessageID},Object(r.a)(Object(r.a)({},e),{},{dispatchMessages:m});case"add_rooms_data":var g=Object(r.a)({},e.roomsData);return g[t.roomID]={lastMessageListener:t.lastMessageListener,onlineStatelistener:t.onlineStatelistener,roomID:t.roomID},Object(r.a)(Object(r.a)({},e),{},{roomsData:g});case"update_rooms_data":var p=Object(r.a)({},e.roomsData);return t.data!==p[t.roomID][t.dataType]?(p[t.roomID]=Object(r.a)(Object(r.a)({},p[t.roomID]),{},Object(a.a)({},t.dataType,t.data)),Object(r.a)(Object(r.a)({},e),{},{roomsData:p})):e;default:return e}}},72:function(e,t,n){"use strict";function a(){if(window.innerHeight>768&&window.innerWidth>1366){var e=window.innerHeight/window.innerWidth,t=768/1366;return t<e?{width:1366,height:window.innerHeight*(1366/window.innerWidth),transform:"scale(".concat(window.innerWidth/1366,")")}:t>e?{width:window.innerWidth*(768/window.innerHeight),height:768,transform:"scale(".concat(window.innerHeight/768,")")}:{width:1366,height:768,transform:"scale(".concat(window.innerHeight/768,")")}}return{width:window.innerWidth,height:window.innerHeight,transform:"scale(1)"}}n.d(t,"a",(function(){return a}))},96:function(e,t,n){"use strict";var a=n(14),c=n.n(a),r=n(23),i=n(6),s=n(0),o=n(25),l=n(211),u=n(215),d=n(1);var h=function(e){var t=e.menuLists,n=e.menu,a=e.handleMenuClose;return Object(d.jsx)("div",{children:Object(d.jsx)(l.a,{id:"simple-menu",anchorEl:n,keepMounted:!0,open:Boolean(n),onClose:a,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},getContentAnchorEl:null,children:t.map((function(e){return Object(d.jsx)(u.a,{onClick:e.onClick,children:e.title},e.id)}))})})},j=n(101),m=function(e,t,n){j.a.info(e,{toastId:t,position:n,autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})},f=n(194),b=n(216),g=n(189),p=n(217),O=n(190),v=n(193),x=n(95),w=n.n(x);n(136);var y=function(e){var t=e.open,n=e.close,a=e.user,c=e.photo;return Object(d.jsxs)(g.a,{open:t,fullScreen:!0,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(d.jsxs)(p.a,{id:"alert-dialog-title-dialogCustom",children:[Object(d.jsx)("div",{children:Object(d.jsx)(b.a,{src:a.photoURL})}),Object(d.jsx)("div",{children:Object(d.jsx)(v.a,{edge:"end",color:"inherit",onClick:n,"aria-label":"close",children:Object(d.jsx)(w.a,{})})})]}),Object(d.jsx)(O.a,{children:Object(d.jsx)(f.a,{in:t,style:{transitionDelay:t?"300ms":"0ms"},children:Object(d.jsx)("img",{src:c,alt:"",className:"DialogCustom__photo"})})})]})},_=n(218),S=n(191),I=n(195),D=n(103),L=n.n(D),N=n(102),R=n.n(N),k=n(78),E=n.n(k),M=n(65),U=n.n(M),C=(n(138),Object(I.a)((function(e){return{root:{display:"flex"},drawerPaper:{position:"absolute"}}})));t.a=function(e){var t=e.drawerLeft,n=e.setDrawerLeft,a=e.db,l=e.auth,u=e.storage,j=C(),x=Object(o.b)(),w=Object(i.a)(x,1)[0].user,I=Object(s.useState)(""),D=Object(i.a)(I,2),N=D[0],k=D[1],M=Object(s.useState)(""),T=Object(i.a)(M,2),P=T[0],H=T[1],A=Object(s.useState)(""),F=Object(i.a)(A,2),W=F[0],B=F[1],q=Object(s.useState)(!1),z=Object(i.a)(q,2),G=z[0],X=z[1],Y=Object(s.useState)(!1),V=Object(i.a)(Y,2),J=V[0],K=V[1],Z=Object(s.useState)(!1),$=Object(i.a)(Z,2),Q=$[0],ee=$[1],te=Object(s.useState)(!1),ne=Object(i.a)(te,2),ae=ne[0],ce=ne[1],re=Object(s.useState)(null),ie=Object(i.a)(re,2),se=ie[0],oe=ie[1],le=Object(s.useState)(!1),ue=Object(i.a)(le,2),de=ue[0],he=ue[1],je=Object(s.useState)(null),me=Object(i.a)(je,2),fe=me[0],be=me[1],ge=Object(s.useState)(""),pe=Object(i.a)(ge,2),Oe=pe[0],ve=pe[1];Object(s.useEffect)((function(){k(w.displayName),a.collection("users").doc(w.uid).onSnapshot((function(e){var t,n,a;ve(null===(t=e.data())||void 0===t?void 0:t.photoURL),H(null===(n=e.data())||void 0===n?void 0:n.about),B(null===(a=e.data())||void 0===a?void 0:a.phone)}))}),[w.uid,w.displayName,a]);var xe=function(){var e=Object(r.a)(c.a.mark((function e(t){var n,a,r,i,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("imageFileSizeToastId",!((n=t.target.files[0]).size>3145728)){e.next=6;break}m("\u0424\u043e\u0442\u043a\u0430 \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 3Mb","imageFileSizeToastId","top-center"),e.next=30;break;case 6:if(a=u.ref(),!0!==w.isAnonymous){e.next=20;break}return r=a.child("user/anonymous/".concat(w.uid)),i=r.child(n.name),e.next=12,i.put(n);case 12:return e.t0=oe,e.next=15,i.getDownloadURL();case 15:e.t1=e.sent,(0,e.t0)(e.t1),console.log("uploading image",se),e.next=30;break;case 20:return s=a.child("user/regular/".concat(w.uid)),o=s.child(n.name),e.next=24,o.put(n);case 24:return e.t2=oe,e.next=27,o.getDownloadURL();case 27:e.t3=e.sent,(0,e.t2)(e.t3),console.log("uploading image",se);case 30:be(null),he(!0);case 32:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),we=function(){se?(l.currentUser.updateProfile({photoURL:se}),a.collection("rooms").doc(w.uid).set({photoURL:se},{merge:!0}),he(!1)):m("Select photo to upload!","uploadPhotoError","top-center")},ye=[{title:"\u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c",onClick:function(){return w?ce(!0):m("\u041d\u0435\u0442 \u0444\u043e\u0442\u043e!","viewPhoto","top-center"),void be(null)},id:1e5*Math.random()},{title:Object(d.jsxs)("div",{className:"profileMenu_uploadPhoto",children:[Object(d.jsx)("label",{htmlFor:"file-input",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0444\u043e\u0442\u043e"}),Object(d.jsx)("input",{id:"file-input",type:"file",onChange:xe,accept:"image/*"})]}),onClick:function(){return we()},id:1e5*Math.random()}];return Object(d.jsx)("div",{children:Object(d.jsxs)(_.a,{anchor:"left",variant:"persistent",open:t,classes:{paper:j.drawerPaper},children:[Object(d.jsx)("div",{className:"drawerLeft__header",children:Object(d.jsxs)("div",{className:"drawerLeft__header_container",children:[Object(d.jsx)(v.a,{onClick:function(){n(!1),X(!1),K(!1),ee(!1)},children:Object(d.jsx)(R.a,{})}),Object(d.jsx)("p",{children:"\u0412\u0430\u0448 \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u0438 \u0432\u0430\u0448\u0430 \u0437\u0430\u044f\u0432\u043a\u0430"})]})}),Object(d.jsxs)("div",{className:"drawerLeft__content",children:[Object(d.jsxs)("div",{className:"drawerLeft__content_photo",children:[Object(d.jsxs)("div",{className:"profilePhoto",children:[Object(d.jsx)(f.a,{in:t,style:{transitionDelay:t?"300ms":"0ms"},children:Oe?Object(d.jsx)(b.a,{src:Oe,className:"profilePhoto__layer_bottom"}):Object(d.jsx)(b.a,{})}),Object(d.jsx)("div",{className:"profilePhoto__layer_top",onClick:function(e){be(e.currentTarget)},children:Object(d.jsxs)("div",{className:"profilePhoto__text",children:[Object(d.jsx)(L.a,{}),Object(d.jsx)("p",{children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"}),Object(d.jsx)("p",{children:"\u0424\u043e\u0442\u043e"})]})})]}),Object(d.jsx)(h,{menuLists:ye,menu:fe,handleMenuClose:function(){be(null)}}),Object(d.jsx)(y,{open:ae,close:function(){ce(!1)},photo:Oe,user:w})]}),Object(d.jsx)("div",{className:"profileMenu__diaglog",children:Object(d.jsxs)(g.a,{open:de,onClose:function(){he(!1)},"aria-labelledby":"form-dialog-title",children:[Object(d.jsx)(p.a,{id:"form-dialog-title-drawerLeft",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0444\u043e\u0442\u043e(\u0435\u0441\u043b\u0438 \u0432\u044b \u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c, \u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0444\u043e\u0442\u043e \u043c\u0430\u0448\u0438\u043d\u044b)"}),Object(d.jsx)(O.a,{id:"form-dialog-content",children:Object(d.jsx)("div",{className:"profileMenu__uploadPhoto_dialog",children:Object(d.jsx)("img",{src:se,alt:""})})}),Object(d.jsx)(S.a,{children:Object(d.jsx)("div",{className:"profileMenu_uploadPhoto_iconButton",children:Object(d.jsx)(v.a,{onClick:we,children:Object(d.jsx)(U.a,{})})})})]})}),Object(d.jsxs)("div",{className:"drawerLeft__content_name",children:[Object(d.jsxs)("p",{children:["\u0412\u0430\u0448\u0435 \u0438\u043c\u044f \u0438 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435","\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u044c"==localStorage.getItem("role")?Object(d.jsx)("span",{className:"span_namer",children:"\u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u0412\u0430\u0441\u044f, \u0435\u0437\u0436\u0443 \u043a\u0430\u0436\u0434\u044b\u0439 \u0434\u0435\u043d\u044c \u0432 \u041c\u0430\u043a\u0435\u0435\u0432\u043a\u0443, \u0432 10 \u0443\u0442\u0440\u0430"}):Object(d.jsx)("span",{className:"span_namer",children:"\u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u0410\u043d\u044f, \u043f\u0430\u0441\u0441\u0430\u0436\u0438\u0440, \u0435\u0437\u0436\u0443 \u043a\u0430\u0436\u0434\u044b\u0439 \u0434\u0435\u043d\u044c \u0432 \u0446\u0435\u043d\u0442\u0440 \u0414\u043e\u043d\u0435\u0446\u043a\u0430 \u0441 \u0422\u0435\u043a\u0441\u0442\u0438\u043b\u044c\u0449\u0438\u043a\u0430 \u0432 8 \u0443\u0442\u0440\u0430, \u043a\u0442\u043e \u043f\u043e\u0434\u0432\u0435\u0437\u0435\u0442?"})]}),Object(d.jsx)("form",{children:G?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("input",{value:N,onChange:function(e){return k(e.target.value)},type:"text",styles:{borderBottom:"1px solid green !important"}}),Object(d.jsx)(U.a,{onClick:function(e){e.preventDefault(),w.uid&&(a.collection("users").doc(w.uid).update({name:N}).then((function(){console.log("\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043e!")})).catch((function(e){console.error("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c: ",e)})),l.currentUser.updateProfile({displayName:N})),X(!1)}})]}):Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("span",{children:N}),Object(d.jsx)(E.a,{onClick:function(){X(!0)}})]})})]}),Object(d.jsx)("div",{className:"drawerLeft__note",children:Object(d.jsx)("span",{children:"\u041d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u0438\u043c\u044f \u0438 \u043e\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u0441\u0432\u043e\u0435 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435"})}),Object(d.jsxs)("div",{className:"drawerLeft__content_name",children:[Object(d.jsx)("p",{children:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"}),Object(d.jsx)("form",{children:Q?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("input",{value:W,onChange:function(e){return B(e.target.value)},type:"text"}),Object(d.jsx)(U.a,{onClick:function(e){e.preventDefault(),w.uid&&a.collection("users").doc(w.uid).update({phone:W}).then((function(){console.log("\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043e phone!")})).catch((function(e){console.error("\u041d\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u043e\u0441\u044c \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c phone: ",e)})),ee(!1)}})]}):Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("span",{children:W}),Object(d.jsx)(E.a,{onClick:function(){ee(!0)}})]})})]}),Object(d.jsxs)("div",{className:"drawerLeft__content_name",children:[Object(d.jsx)("p",{children:"\u041e\u0431\u043e \u043c\u043d\u0435"}),Object(d.jsx)("form",{children:J?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("input",{value:P,onChange:function(e){return H(e.target.value)},type:"text"}),Object(d.jsx)(U.a,{onClick:function(e){e.preventDefault(),w.uid&&a.collection("users").doc(w.uid).update({about:P}).then((function(){console.log("\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043e!")})).catch((function(e){console.error("\u041d\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u043e\u0441\u044c \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c: ",e)})),K(!1)}})]}):Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("span",{children:P}),Object(d.jsx)(E.a,{onClick:function(){K(!0)}})]})})]})]})]})})}}},[[151,1,2]]]);
//# sourceMappingURL=main.4bcf563f.chunk.js.map