{"version":3,"sources":["SidebarChat.js","tablets.png","YourRole.js","notification.mp3","Sidebar.js","MediaPreview.js","ImagePreview.js","recorder.js","ChatFooter.js","AudioPlayer.js","message_sent.mp3","message_received.mp3","Chat.js","Login.js","useFetchData.js","App.js","useRoomsData.js","setOnlineStatus.js","serviceWorkerRegistration.js","index.js","StateProvider.js","firebase.js","reducer.js","scalePage.js","DropdownMenu.js","toastInfo.js","DialogCustom.js","DrawerLeft.js"],"names":["SidebarChat","dataList","title","path","fetchList","useStateValue","roomsData","page","pathID","dispatch","useState","scrollFetch","setScrollFetch","list","setList","sidebarChatContainer","useRef","useEffect","a","parseInt","current","scrollTop","scrollHeight","offsetHeight","length","addEventListener","clean","removeEventListener","setTimeout","Array","from","document","querySelectorAll","forEach","cur","i","classList","remove","arr","data","onlineState","id","state","lastMessage","push","className","to","pathname","photoURL","name","userID","Avatar","style","width","height","src","dangerouslySetInnerHTML","__html","_highlightResult","value","marginBottom","message","about","Photo","audio","MicRounded","time","unreadMessages","type","ref","CircularProgress","SearchOutlined","CancelOutlined","memo","YourRole","localStorage","getItem","open","setOpen","role","setRole","handleYourRoleOpen","cursor","onClick","Tablet","alt","maxWidth","paddingTop","Dialog","aria-labelledby","DialogTitle","DialogContent","DialogActions","justifyContent","Button","e","preventDefault","setItem","color","Sidebar","Nav","chats","pwa","rooms","fetchRooms","users","fetchUsers","usersSearch","fetchUsersSearch","drawerLeft","setDrawerLeft","setSearchList","searchListy","setSearchListy","searchRole","setSearchRole","searchInput","setSearchInput","menu","setMenu","mounted","setMounted","user","history","useHistory","notification","Audio","prevUnreadMessages","querySelector","blur","filtered","filter","element","index","array","toLowerCase","indexOf","props","classSelected","click","children","NavLink","filteredRole","searchrole","play","add","minHeight","displayName","DrawerLeft","db","auth","storage","storage1","IconButton","console","log","prompt","GetAppRounded","uid","onChange","target","placeholder","display","activeClassName","Home","PeopleAlt","DriveEta","imageSRC","mediaPreview","close","setHeight","imagePreview","animState","loaded","setLoaded","animW","animH","ratio","el","imageRatio","imgH","imgW","backgroundColor","borderRadius","transformOrigin","transform","left","top","imgStyle","minWidth","createPortal","toggle","goBack","onLoad","record","Promise","resolve","navigator","mediaDevices","getUserMedia","then","stream","mediaRecorder","MediaRecorder","audioChunks","event","start","stop","audioName","uuidv4","audioFile","File","audioUrl","URL","createObjectURL","wait","input","handleFocus","change","sendMessage","setFocus","image","focus","token","roomID","setAudioID","recording","setRecording","recordingTimer","setRecordingTimer","recordingEl","inputRef","timerInterval","sendAudio","timer","collection","doc","set","merge","seen","timestamp","createTimestamp","fieldIncrement","Date","toUTCString","audioPlayed","audioStorage","child","put","getDownloadURL","url","update","body","window","onLine","recorder","alert","stopRecording","clearInterval","stopped","opacity","pad","val","valString","now","setInterval","delta","totalSeconds","Math","floor","btnIcons","CSSTransition","in","timeout","enter","exit","classNames","Send","onBlur","currentTarget","contains","relatedTarget","onKeyPress","onFocus","for","accept","capture","file","files","duration","CancelRounded","CheckCircleRounded","sender","audioID","isPlaying","setIsPlaying","mediaLoaded","setMediaLoaded","metadataLoaded","setMetadataLoaded","error","setError","sliderValue","setSliderValue","sliderPlayedWidth","setSliderPlayedWidth","setDuration","totalDuration","interval","uploading","seekUpdate","seekPosition","isNaN","currentTime","currentMinutes","currentSeconds","getCurrentTime","load","media","reject","onloadedmetadata","Number","MAX_SAFE_INTEGER","ontimeupdate","durationMinutes","durationSeconds","pause","min","max","seekto","Chat","b","setInput","useParams","location","useLocation","match","useRouteMatch","dispatchMessages","actionTypes","setImagePreview","messages","setMessages","openMenu","setOpenMenu","deleting","setDeleting","setToken","setState","setSeen","typing","setTyping","setSRC","setImage","writeState","setWriteState","setRatio","scrollArrow","setScrollArrow","clientWidth","setClientWidth","firstRender","setFirstRender","sendAnim","setSendAnim","Boolean","limitReached","setLimitReached","chatBodyRef","lastMessageRef","chatBodyContainer","chatAnim","prevMessages","limit","prevScrollHeight","paginating","paginating2","paginateLoader","setPaginateLoader","messageSentAudio","audio2","messageReceivedAudio","audio1","mediaSnap","mediaChecked","animation","outerHeight","getComputedStyle","marginTop","inputText","imageToUpload","roomInfo","split","imageName","messageToSend","toLocaleString","year","month","day","weekday","timezone","hour","minute","imageUrl","Compressor","quality","success","result","deleteRoom","room","get","fetchedMessages","fetchedAudios","fecthedImages","docs","usersChats","Set","map","all","delete","img","aud","userChat","replace","fetchMessages","orderBy","onSnapshot","snapshot","newMessages","toDate","reverse","SET_MESSAGES","paginate","listenToImg","docID","snap","listenToAudio","useLayoutEffect","nodeArr","lastMHeight","node","anime","targets","easing","complete","scrollChatBody","x","init","firstMessageID","empty","clientHeight","h","z","round","widthRatio","ArrowBack","reader","FileReader","onload","readAsDataURL","htmlFor","AddPhotoAlternate","aria-controls","aria-haspopup","MoreVert","Menu","anchorEl","onClose","keepMounted","MenuItem","Delete","signOut","reload","VisibilityOff","messageArr","parentNode","obj","getBoundingClientRect","innerHeight","innerWidth","offsetWidth","clickImagePreview","appear","DoneAllRounded","clearTimeout","unmountOnExit","ArrowDownward","TransitionGroup","component","Transition","Login","signInWithRedirect","provider","catch","useFetchData","limitNumber","initCount","snapHandler","dataUnsub","setData","snapCount","fetchData","getData","s","DestinationSearch","React","lazy","geolocation","getCurrentPosition","position","lat","coords","latitude","lng","longitude","gpska","gps_suma","accuracy","App","loader","setLoader","undefined","pwaEvent","setPwaEvent","updating","setChats","chatsFetched","setChatsFetched","initRoomsData","lastMessageListener","dataType","onlineStateListener","onlineStatelistener","useRoomsData","setRoomsData","menus","where","onAuthStateChanged","authUser","SET_USER","messaging","requestPermission","getToken","phone","scalePage","includeMetadataChanges","docChanges","metadata","fromCache","every","substring","isOfflineForDatabase","last_changed","createTimestamp2","coord","coord_sum","isOnlineForDatabase","userStatusFirestoreRef","userStatusDatabaseRef","db2","isOfflineForFirestore","isOnlineForFirestore","on","onDisconnect","setOnlineStatus","fallback","find","isLocalhost","hostname","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","constraints","webkitGetUserMedia","mozGetUserMedia","call","Error","ReactDOM","render","StrictMode","StateProvider","initialState","reducer","getElementById","process","href","origin","fetch","headers","response","contentType","status","ready","unregister","checkValidServiceWorker","serviceWorkerRegistration","StateContext","createContext","Provider","useReducer","useContext","firebaseApp","firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","measurementId","firestore","database","GoogleAuthProvider","FieldValue","serverTimestamp","ServerValue","TIMESTAMP","increment","arrayUnion","action","isSame","slice","f","updatedMessages","findIndex","newRoomsData","currentRatio","DropdownMenu","menuLists","handleMenuClose","anchorOrigin","vertical","horizontal","getContentAnchorEl","menuList","toastInfo","toastTitle","toastId","toast","info","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","progress","DialogCustom","photo","fullScreen","aria-describedby","edge","aria-label","Zoom","transitionDelay","useStyles","makeStyles","theme","root","drawerPaper","classes","setName","setAbout","setPhone","showEditName","setShowEditName","showEditAbout","setShowEditAbout","showEditPhone","setShowEditPhone","showProfilePhoto","setShowProfilePhoto","uploadPhotoLink","setUploadPhotoLink","showDialogUpload","setShowDialogUpload","menuProfile","setMenuProfile","setPhoto","onFileChangeImage","size","storageRef","isAnonymous","imagesRef","fileRef","handleUploadPhoto","currentUser","updateProfile","random","Drawer","anchor","variant","paper","styles","borderBottom"],"mappings":"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","file":"static/js/main.4bcf563f.chunk.js","sourcesContent":["import {useEffect,  memo, useRef, useState} from 'react';\nimport { Avatar } from '@material-ui/core';\nimport { CancelOutlined, SearchOutlined, Photo, MicRounded } from '@material-ui/icons';\nimport './SidebarChat.css';\nimport { Link } from 'react-router-dom';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { useStateValue } from './StateProvider';\n//window\nfunction SidebarChat({ dataList, title, path, fetchList}) {\n    const [{roomsData, page, pathID}, dispatch] = useStateValue();\n    const [scrollFetch, setScrollFetch] = useState(false);\n    const [list, setList] = useState(null);\n    const sidebarChatContainer = useRef();\n\n    useEffect(() => {\n        var a = null;\n        if (fetchList) {\n            a = function () {\n                if (parseInt(sidebarChatContainer.current.scrollTop) === sidebarChatContainer.current.scrollHeight - sidebarChatContainer.current.offsetHeight) {\n                    fetchList(setScrollFetch);\n                };\n            };\n            if (dataList?.length > 0) {\n                sidebarChatContainer.current.addEventListener(\"scroll\", a);\n            };\n        };\n        const clean = sidebarChatContainer.current;\n        return () => {\n            if (a) {\n                //console.log(\"removing event\");\n                clean.removeEventListener(\"scroll\", a);\n                \n            };\n        };\n    }, [dataList, fetchList]);\n    \n    useEffect(() => {\n        //console.log(dataList);\n        //console.log(list)\n        if (dataList?.length === list?.length) {\n            setTimeout(() => {\n                Array.from(document.querySelectorAll('.animate')).forEach((cur,i) => {\n                    setTimeout(() => {\n                        cur.classList.remove(\"animate\");\n                    }, 50 * i);\n                });\n            }, 10);\n        };\n    }, [dataList, list]);\n\n    useEffect(() => {\n        if (dataList) {\n            const arr = [];\n            dataList.forEach(data => {\n           //     console.log(\"data: \", data);\n          //      console.log(\"rooms data: \", roomsData[data.id]);\n                if (data) {\n                    const onlineState = roomsData[data.id]?.onlineState ? roomsData[data.id].onlineState : data.state;\n                    const lastMessage = title === \"Search Result\" ? null : roomsData[data.id]?.lastMessage ? roomsData[data.id].lastMessage : data.lastMessage;\n                    if (title === \"Rooms\" || title === \"Search Result\" || title === \"Chats\" && roomsData[data.id].lastMessage || title !== \"Chats\" && roomsData[data.id]) {\n                        arr.push(<Link className=\"link\" key={data.id} to={{\n                            pathname: path ? `${path}/room/${data.id}` : `/room/${data.id}`,\n                            state: {\n                                photoURL: `${data.photoURL ? data.photoURL : `https://avatars.dicebear.com/api/human/${data.id}.svg`}`,\n                                name: data.name,\n                                userID: data.userID ? data.userID : null,\n                                state: data.state\n                            }\n                        }} >\n                            <div \n                                className={`sidebar__chat animate`}\n                            >\n                              {/*  <p > sidebarchat.js animate</p>*/}\n                                <div className=\"avatar__container\">\n                                    <Avatar style={{width: 45,height: 45}} src={`${data.photoURL ? data.photoURL : `https://avatars.dicebear.com/api/human/${data.id}.svg`}`} />\n                                    {onlineState=== \"online\" ? <div className=\"online\"></div> : null}\n                                </div>\n                                <div className=\"sidebar__chat--info\">\n                                    <h2 \n                                        dangerouslySetInnerHTML={{__html: title === \"Результат поиска\" ? data._highlightResult.name.value : data.name}}\n                                        style={{\n                                            width: page.width <= 760 ? page.width - 126 : page.width * 0.315 - 126,\n                                            marginBottom: lastMessage?.message || lastMessage ? 8 : 0,\n                                        }}\n                                    ></h2>\n                                    <p style={{width: page.width <= 760 ? page.width - 126 : page.width * 0.315 - 126}}\n                                    dangerouslySetInnerHTML={{__html:  data.about}}\n                                    >\n                                    </p>\n                                    <p style={{width: page.width <= 760 ? page.width - 126 : page.width * 0.315 - 126}}\n                                   \n                                    >\n                                        {lastMessage?.message ? \n                                            <><Photo style={{width: 19,height: 19}} /> <span style={{width: page.width <= 760 ? page.width - 150 : page.width * 0.315 - 150}}>{lastMessage.message}</span> </>\n                                            : lastMessage?.audio ?\n                                            <><MicRounded style={{width: 19,height: 19}} /><span style={{width: page.width <= 760 ? page.width - 150 : page.width * 0.315 - 150}}>{lastMessage.time}</span></>\n                                            : lastMessage?.message === \"\" ?\n                                            <><Photo style={{width: 19,height: 19}} /> <span style={{width: page.width <= 760 ? page.width - 150 : page.width * 0.315 - 150}}>Photo</span> </>\n                                        :lastMessage}\n                                    </p>\n                                </div>\n                                {data?.unreadMessages && pathID !== data.id ?\n                                    <div className=\"sidebar__chat--unreadMessages\">\n                                        <div>\n                                            {data.unreadMessages}\n                                        </div>\n                                    </div>\n                                :null}\n                            </div>\n                        </Link>);\n                    }\n                } else {\n                    arr.push(null);\n                }\n            });\n            setList(arr)\n        }\n    }, [dataList, roomsData, page, pathID]);\n\n    useEffect(() => {\n        if (page.width <= 760) {\n            dispatch({type: \"SET_PATH\", path: path});\n        } else {\n            dispatch({type: \"SET_PATH\", path: \"\"})\n        }\n    }, [path, page]);\n\n    return (\n        <div ref={sidebarChatContainer} className=\"sidebar__chat--container\">\n            {/* <p>SidebarChat.js</p>*/}\n            <h2 className=\"animate\">{title} </h2>\n            {dataList?.length > 0 ? list : dataList === null && title !== \"Chats\" ?\n                <div className=\"loader__container sidebar__loader\">\n                    <CircularProgress />\n                </div>\n                :\n                <div className=\"no-result\">\n                    <div>\n                        <SearchOutlined />\n                        <div className=\"cancel-root\">\n                            <CancelOutlined />\n                        </div>\n                    </div>\n                    <h2> {title} не найдено </h2>\n                </div>\n                \n            }\n            <div className=\"loader__container scrollFetch\">\n                {scrollFetch ? <CircularProgress /> : null}\n            </div>\n        </div>\n    )\n}\n\nexport default memo(SidebarChat);\n","export default __webpack_public_path__ + \"static/media/tablets.13043575.png\";","import React, { useState } from \"react\";\n//import TooltipCustom from '../shared/TooltipCustom';\n// import db from '../firebase';\nimport Button from \"@material-ui/core/Button\";\n// import TextField from '@material-ui/core/TextField';\nimport Dialog from \"@material-ui/core/Dialog\";\nimport DialogActions from \"@material-ui/core/DialogActions\";\nimport DialogContent from \"@material-ui/core/DialogContent\";\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\n//import ChatIcon from '@material-ui/icons/Chat';\nimport Tablet from \"../src/tablets.png\";\n\nfunction YourRole() {\n  const [open, setOpen] = useState(\n    !localStorage.getItem(\"role\") ? true : false\n  );\n  const [role, setRole] = useState(localStorage.getItem(\"role\"));\n\n  const handleYourRoleOpen = () => {\n    setOpen(true);\n  };\n\n  const handleYourRoleClose = () => {\n    setOpen(false);\n    //  setRoomName(\"\");\n  };\n\n  const createYourRoleRider = (e) => {\n    e.preventDefault();\n    localStorage.setItem(\"role\", \"Пассажир\");\n    localStorage.setItem(\"searchrole\", \"Водитель\");\n    setOpen(false);\n    setRole(\"Пассажир\");\n  };\n\n  const createYourRoleDriver = (e) => {\n    e.preventDefault();\n    localStorage.setItem(\"role\", \"Водитель\");\n    localStorage.setItem(\"searchrole\", \"Пассажир\");\n    setOpen(false);\n    setRole(\"Водитель\");\n  };\n\n  return (\n    <div>\n      {/*}  <TooltipCustom \n                name=\"New YourRole\" \n                onClick={() => handleYourRoleOpen()} \n                icon={<ChatIcon />}\n            />*/}\n      <span style={{ cursor: \"pointer\" }} onClick={() => handleYourRoleOpen()}>\n        <img\n          src={Tablet}\n          alt=\"YouLrole\"\n          style={{ maxWidth: 40, paddingTop: 20, cursor: \"pointer\" }}\n          onClick={() => handleYourRoleOpen()}\n        />\n        {role}\n      </span>\n      <Dialog open={open} aria-labelledby=\"form-dialog-title\">\n        <DialogTitle id=\"form-dialog-title\">\n          Выберите кто вы сегодня:{\" \"}\n        </DialogTitle>\n        <DialogContent>\n          {/* <TextField\n                        autoFocus\n                        margin=\"dense\"\n                        id=\"name\"\n                        label=\"Room Name\"\n                        type=\"text\"\n                        fullWidth\n                        value={roomName}\n                        onChange={e => setRoomName(e.target.value)}\n                   />*/}\n          <img src={Tablet} alt=\"YouLrole\" style={{ maxWidth: \"100%\" }} />\n        </DialogContent>\n        <DialogActions style={{ justifyContent: \"space-around\" }}>\n          <Button onClick={createYourRoleDriver} color=\"primary\">\n            Водитель\n          </Button>\n          <Button onClick={createYourRoleRider} color=\"primary\">\n            Пассажир\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </div>\n  );\n}\n\nexport default YourRole;\n","export default __webpack_public_path__ + \"static/media/notification.34e1d6f8.mp3\";","import { useEffect, useState, memo, useRef } from \"react\";\nimport SidebarChat from \"./SidebarChat\";\nimport { Avatar, IconButton } from \"@material-ui/core\";\n\nimport YourRole from \"./YourRole\";\nimport {\n  Message,\n  PeopleAlt,\n  Home,\n  ExitToApp as LogOut,\n  SearchOutlined,\n  GetAppRounded,\n  Add,\n  DriveEta,\n} from \"@material-ui/icons\";\nimport { useStateValue } from \"./StateProvider\";\nimport { NavLink, Route, useHistory, Switch } from \"react-router-dom\";\n//import algoliasearch from \"algoliasearch\";\nimport \"./Sidebar.css\";\nimport audio from \"./notification.mp3\";\nimport DrawerLeft from \"./DrawerLeft\";\nimport db, {\n  auth,\n  storage1,\n  provider,\n  createTimestamp,\n  messaging,\n} from \"./firebase\";\nimport firebase from \"firebase/app\";\n\n/*\nconst index = algoliasearch(\n  \"3NMH9UCFLC\",\n  \"deb2bbef10859ca91461463cd6730232\"\n).initIndex(\"muizzchats\");\n*/\nfunction Sidebar({\n  chats,\n  pwa,\n  rooms,\n  fetchRooms,\n  users,\n  fetchUsers,\n  usersSearch,\n  fetchUsersSearch,\n}) {\n  const [drawerLeft, setDrawerLeft] = useState(false);\n  const [menuSidebar, setMenuSidebar] = useState(null);\n\n  const [searchList, setSearchList] = useState(null);\n  const [searchListy, setSearchListy] = useState(null);\n  const [searchRole, setSearchRole] = useState(null);\n\n  const [searchInput, setSearchInput] = useState(\"\");\n  const [menu, setMenu] = useState(1);\n  const [mounted, setMounted] = useState(false);\n  const [{ user, page, pathID }] = useStateValue();\n  let history = useHistory();\n  const notification = new Audio(audio);\n  const prevUnreadMessages = useRef(\n    (() => {\n      const data = {};\n      chats.forEach((cur) =>\n        cur.unreadMessages || cur.unreadMessages === 0\n          ? (data[cur.id] = cur.unreadMessages)\n          : null\n      );\n      return data;\n    })()\n  );\n\n  var Nav;\n  if (page.width > 760) {\n    Nav = (props) => (\n      <div\n        className={`${props.classSelected ? \"sidebar__menu--selected\" : \"\"}`}\n        onClick={props.click}\n      >\n        {props.children}\n      </div>\n    );\n  } else {\n    Nav = NavLink;\n  }\n\n  var filtered;\n  async function search(e) {\n    if (e) {\n      document.querySelector(\".sidebar__search input\").blur();\n      e.preventDefault();\n    }\n    if (page.width <= 760) {\n      history.push(\"/search?\" + searchInput);\n    }\n    setSearchList(null);\n    if (menu !== 4) {\n      setMenu(4);\n    }\n    // console.log(searchInput);\n    //   console.log(users);\n    // console.log(fetchUsers);\n\n    /*   const result = (await index.search(searchInput)).hits.map((cur) =>\n      cur.objectID !== user.uid\n        ? {\n            ...cur,\n            id: cur.photoURL\n              ? cur.objectID > user.uid\n                ? cur.objectID + user.uid\n                : user.uid + cur.objectID\n              : cur.objectID,\n            userID: cur.photoURL ? cur.objectID : null,\n          }\n        : null\n    );\n    console.log(result);\n    setSearchList(result);*/\n\n    var filtered = users.filter(function (element, index, array) {\n      return element.name.toLowerCase().indexOf(searchInput.toLowerCase()) > -1;\n    });\n    // console.log(filtered);\n\n    setSearchListy(filtered);\n\n    /*  const findMessage = function (users) { \n          return users; \n      };\n      const result = (users.filter(findMessage(searchInput)).map((user) => \n        user.photoURL,\n        user.uid\n        ))\n      setSearchList(result);*/\n\n    //const count = 65;\n  }\n\n  //  debugger;\n  const createChat = () => {\n    const roomName = prompt(\"Type the name of your room\");\n    if (roomName) {\n      db.collection(\"rooms\").add({\n        name: roomName,\n        timestamp: createTimestamp(),\n        lastMessage: \"\",\n      });\n    }\n  };\n\n  // Открытие левого бара\n  const handleDrawerLeftOpen = () => {\n    //   setMenuSidebar(null);\n    setDrawerLeft(true);\n  };\n  useEffect(() => {\n    const data = {};\n    chats.forEach((cur) => {\n      if (cur.unreadMessages || cur.unreadMessages === 0) {\n        if (\n          (cur.unreadMessages > prevUnreadMessages.current[cur.id] ||\n            (!prevUnreadMessages.current[cur.id] &&\n              prevUnreadMessages.current[cur.id] !== 0)) &&\n          pathID !== cur.id\n        ) {\n          notification.play();\n        }\n        data[cur.id] = cur.unreadMessages;\n      }\n    });\n    prevUnreadMessages.current = data;\n  }, [chats, pathID]);\n\n  useEffect(() => {\n    if (page.width <= 760 && chats && !mounted) {\n      setMounted(true);\n      setTimeout(() => {\n        document.querySelector(\".sidebar\").classList.add(\"side\");\n      }, 10);\n    }\n  }, [chats, mounted]);\n\n  async function searchDr() {\n    if (menu !== 3) {\n      setMenu(3);\n    }\n\n    var filteredRole = users.filter(function (element, index, array) {\n      return (\n        element.searchrole\n          .toLowerCase()\n         // .indexOf(localStorage.getItem(\"role\").toLowerCase()) > -1\n          .indexOf(\"Пассажир\".toLowerCase()) > -1\n      );\n    });\n\n   // console.log(filteredRole);\n\n    setSearchRole(filteredRole);\n  }\n\n  async function searchPas() {\n    if (menu !== 2) {\n      setMenu(2);\n    }\n\n    var filteredRole = users.filter(function (element, index, array) {\n      return (\n        element.searchrole\n          .toLowerCase()\n          .indexOf(\"Водитель\".toLowerCase()) > -1\n      );\n    });\n\n    //console.log(filteredRole);\n\n    setSearchRole(filteredRole);\n  }\n  async function searchHome() {\n    if (menu !== 1) {\n      setMenu(1);\n    } \n    history.push(\"/\");\n  }\n  return (\n    <div\n      className=\"sidebar\"\n      style={{\n        minHeight: page.width <= 760 ? page.height : \"auto\",\n      }}\n    >\n      {/*<p>Sidebar.js</p>*/}\n      <div className=\"sidebar__header\">\n        <div className=\"sidebar__header--left\">\n          <Avatar src={user?.photoURL} onClick={() => handleDrawerLeftOpen()} />\n          <h4>{user?.displayName} </h4>\n        </div>\n\n        <DrawerLeft\n          drawerLeft={drawerLeft}\n          setDrawerLeft={setDrawerLeft}\n          db={db}\n          auth={auth}\n          storage={storage1}\n        />\n        <div className=\"sidebar__header--right\">\n          <IconButton\n            onClick={() => {\n              if (pwa) {\n                console.log(\"prompting the pwa event\");\n                pwa.prompt();\n              } else {\n                console.log(\"pwa event is undefined\");\n              }\n            }}\n          >\n            <GetAppRounded />\n          </IconButton>\n          <YourRole uid={user.uid} />\n          {/* <IconButton\n            onClick={() => {\n              auth.signOut();\n              db.doc(\"/users/\" + user.uid).set(\n                { state: \"offline\" },\n                { merge: true }\n              );\n              history.replace(\"/chats\");\n              setTimeout(() => {\n                window.location.reload();\n              }, 1000);\n            }}\n          >\n            <LogOut />\n          </IconButton>*/}\n        </div>\n      </div>\n\n      <div className=\"sidebar__search\">\n        <form className=\"sidebar__search--container\">\n          <SearchOutlined />\n          <input\n            value={searchInput}\n            onChange={(e) => setSearchInput(e.target.value)}\n            placeholder=\"Поиск\"\n            type=\"text\"\n          />\n          <button\n            style={{ display: \"none\" }}\n            type=\"submit\"\n            onClick={search}\n          ></button>\n        </form>\n      </div>\n\n      <div className=\"sidebar__menu\">\n        <Nav\n          classSelected={menu === 1 ? true : false}\n          to=\"/\"\n          click={() => setMenu(1), searchHome}\n          activeClassName=\"sidebar__menu--selected\"\n        >\n          <div className=\"sidebar__menu--users\">\n            <Home />\n            <div className=\"sidebar__menu--line\"></div>\n          </div>\n        </Nav>\n        <Nav\n          classSelected={menu === 2 ? true : false}\n          to=\"/users\"\n          click={() => setMenu(2), searchPas}\n          activeClassName=\"sidebar__menu--selected\"\n        >\n          <div className=\"sidebar__menu--users\">\n            <PeopleAlt />\n            <div className=\"sidebar__menu--line\"></div>\n          </div>\n        </Nav>\n        <Nav\n          classSelected={menu === 3 ? true : false}\n          to=\"/users\"\n          click={() => setMenu(3), searchDr}\n          activeClassName=\"sidebar__menu--selected\"\n        >\n          <div className=\"sidebar__menu--users\">\n            <DriveEta />\n            <div className=\"sidebar__menu--line\"></div>\n          </div>\n        </Nav>\n      </div>\n\n      {page.width <= 760 ? (\n        <>\n          <Switch>\n            <Route path=\"/users\">\n              <SidebarChat\n                key=\"users\"\n                fetchList={fetchUsers}\n                dataList={users}\n                title=\"Users\"\n                path=\"/users\"\n              />\n            </Route>\n            <Route path=\"/rooms\">\n              <SidebarChat\n                key=\"rooms\"\n                fetchList={fetchRooms}\n                dataList={rooms}\n                title=\"Rooms\"\n                path=\"/rooms\"\n              />\n            </Route>\n            <Route path=\"/search\">\n              <SidebarChat\n                key=\"search\"\n                fetchList={fetchUsers}\n                dataList={searchListy}\n                title=\"Search Result\"\n                path=\"/search\"\n              />\n            </Route>\n            <Route path=\"/chats\">\n              <SidebarChat\n                key=\"chats\"\n                dataList={chats}\n                title=\"Chats\"\n                path=\"/chats\"\n              />\n            </Route>\n          </Switch>\n        </>\n      ) : menu === 1 ? (\n        <SidebarChat\n        key=\"users\"\n        fetchList={fetchUsers}\n        dataList={users}\n   //   title=\"Все\"\n      />\n      ) : menu === 2 ? (\n        <SidebarChat\n          key=\"usersPas\"\n          fetchList={fetchUsers}\n          dataList={searchRole}\n          title=\"Пассажиры\"\n        />\n      ) : menu === 3 ? (\n        <SidebarChat\n          key=\"usersDr\"\n          fetchList={fetchUsers}\n          dataList={searchRole}\n          title=\"Водители\"\n        />\n      ) : menu === 4 ? (\n        <SidebarChat\n          key=\"search\"\n          fetchList={fetchUsers}\n          dataList={searchListy}\n          title=\"Поиск\"\n          //   key=\"search\"\n          // dataList={searchList}\n          // title=\"Результат поиска\"\n        />\n      ) : null}\n    </div>\n  );\n}\n\nexport default memo(Sidebar);\n","import {memo, useEffect, useState} from \"react\";\nimport CloseRoundedIcon from '@material-ui/icons/CloseRounded';\nimport \"./MediaPreview.css\";\n\nexport default memo(function MediaPreview({imageSRC, mediaPreview, close}) {\n\tconst [height, setHeight] = useState(\"\");\n\n\tuseEffect(() => {\n\t\tsetHeight(document.querySelector('.chat__body--container').offsetHeight);\n\t}, [])\n\n\treturn(\n\t\t<div \n\t\t\tref={mediaPreview} \n\t\t\tclassName=\"mediaPreview\"\n\t\t\tstyle={{\n\t\t\t\theight: height,\n\t\t\t}}\n\t\t>\n\t\t\t<CloseRoundedIcon onClick={close} />\n\t\t\t<img key={imageSRC} src={imageSRC} alt=\"\" />\n\t\t</div>\n\t)\n})","import { useEffect, memo, useState } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { useHistory } from 'react-router-dom';\nimport { useStateValue } from './StateProvider';\nimport CloseRoundedIcon from '@material-ui/icons/CloseRounded';\nimport \"./ImagePreview.css\"\n\nexport default memo(function ImagePreview({ imagePreview, animState }) {\n    const history = useHistory();\n    const [loaded, setLoaded] = useState(false);\n    const [{page}] = useStateValue();\n    \n    useEffect(() => {\n        if (loaded) {\n            const ratio = page.height / page.width;\n            const el = document.querySelector('.imagePreview-container');\n            var animW, animH, a;\n            const imageRatio = imagePreview.ratio ? imagePreview.ratio : (imagePreview.imgH / imagePreview.imgW);\n            if (ratio  < imageRatio) {\n                a = true;\n                animW = (1 / imageRatio) * page.height;\n                animH = page.height;\n            } else {\n                a = false;\n                animH = imageRatio * page.width;\n                animW = page.width;\n            }\n            if (animState === \"entering\" || animState === \"entered\") {\n                setTimeout(() => {\n                    document.querySelector(\".imagePreview\").style.backgroundColor = \"black\";\n                    el.style.borderRadius = \"0px\"\n                    el.style.transformOrigin = a ? \"0% 0%\" : \"0% 0%\";\n                    el.style.height = imagePreview.imgH + \"px\";\n                    el.style.transform = a ? `translateX(${(page.width / 2) - (animW / 2)}px) translateY(0px) scale(${page.height / imagePreview.imgH})` : \n                            `translateX(0px) translateY(${(page.height / 2) - (animH / 2)}px) scale(${page.width / imagePreview.width})`\n                    setTimeout(() => {\n                        document.querySelector('.imagePreview .MuiSvgIcon-root').classList.add(\"close-animate\")\n                    }, 300)\n                }, 10)\n            } else if (animState === \"exiting\") {\n                setTimeout(() => {\n                    document.querySelector('.imagePreview .MuiSvgIcon-root').classList.remove(\"close-animate\")\n                    setTimeout(() => {\n                        document.querySelector(\".imagePreview\").style.backgroundColor = \"transparent\"\n                    }, 200)\n                    el.style.borderRadius = \"10px\"\n                    el.style.height = imagePreview.height + \"px\";\n                    el.style.transform = `translateX(${imagePreview.left}px) translateY(${imagePreview.top}px) scale(1)`;\n                }, 10)\n            }\n        }\n    }, [animState, loaded]);\n\n    const style = {\n        transform:`translateX(${imagePreview.left}px) translateY(${imagePreview.top}px) scale(1)`,\n        width: imagePreview.width,\n        height: imagePreview.height,\n    }\n\n    const imgStyle = {}\n\n    if (page.height / page.width > imagePreview.ratio || page.height / page.width === imagePreview.ratio) {\n        imgStyle.minWidth = \"100%\";\n    } else {\n        imgStyle.minHeight = \"100%\";\n        if (imagePreview.imgW < imagePreview.width) {\n            imgStyle.minWidth = \"100%\";\n        }\n    }\n       \n    return createPortal(\n        <div className=\"imagePreview\" onClick={() => document.querySelector('.imagePreview .MuiSvgIcon-root').classList.toggle(\"close-animate\")}>\n            <CloseRoundedIcon onClick={() => history.goBack()} />\n            <div\n                className=\"imagePreview-container\"\n                style={style}\n            >\n                <img style={imgStyle} onLoad={() => setLoaded(true)} src={imagePreview.src} alt=\"\" />\n            </div>\n        </div>\n    , document.querySelector(\".app\"))\n})","import { v4 as uuidv4 } from 'uuid';\n\nexport default function record (){\n  return new Promise(resolve => {\n    navigator.mediaDevices.getUserMedia({ audio: true })\n      .then(stream => {\n        const mediaRecorder = new MediaRecorder(stream);\n        const audioChunks = [];\n\n        mediaRecorder.addEventListener(\"dataavailable\", event => {\n          audioChunks.push(event.data);\n        });\n\n        const start = () => {\n          mediaRecorder.start();\n        };\n\n        const stop = () => {\n          return new Promise(resolve => {\n            mediaRecorder.addEventListener(\"stop\", () => {\n              const audioName = uuidv4();\n              const audioFile = new File(audioChunks, audioName, {type: \"audio/mpeg\"});\n              const audioUrl = URL.createObjectURL(audioFile);\n              const audio = new Audio(audioUrl);\n              const play = () => {\n                audio.play();\n              };\n\n              resolve({ audioFile, audioUrl, play, audioName });\n            });\n\n            mediaRecorder.stop();\n          });\n        };\n\n        resolve({ start, stop });\n      });\n  });\n};","import { memo, useState, useEffect, useRef } from 'react';\nimport { Send, MicRounded, CancelRounded, CheckCircleRounded } from '@material-ui/icons';\nimport db, { createTimestamp, fieldIncrement, audioStorage } from \"./firebase\";\nimport { useStateValue } from './StateProvider';\nimport { CSSTransition } from \"react-transition-group\";\nimport recorder from \"./recorder.js\";\nimport { v4 as uuidv4 } from 'uuid';\nimport \"./ChatFooter.css\";\nconst wait = time => new Promise(resolve => setTimeout(resolve, time));\n\nexport default memo(function ChatFooter({input, handleFocus, change, sendMessage, setFocus, image, focus, state, token, roomID, setAudioID}) {\n\tconst [recording, setRecording] = useState(false);\n\tconst [recordingTimer, setRecordingTimer] = useState(\"00:00\");\n\tconst [{ user }] = useStateValue();\n\tconst recordingEl = useRef();\n\tconst inputRef = useRef();\n\tconst timerInterval = useRef();\n\tconst record = useRef();\n\n\tfunction handleBlur(event) {\n\t    if (!event.currentTarget.contains(event.relatedTarget) && !recording) {\n\t    \tsetFocus(false)\n\t    }\n\t}\n\n\tasync function sendAudio(audioFile, timer, audioName) {\n\t\tdb.collection(\"rooms\").doc(roomID).set({\n            [user.uid]: false,\n        }, { merge: true });\n\t\tdb.collection(\"rooms\").doc(roomID).set({\n\t\t\tlastMessage:{\n\t\t\t\taudio: true,\n\t\t\t\ttime: timer,\n\t\t\t},\n\t\t\tseen: false\n\t\t}, { merge: true });\n        if (state.userID) {\n        \tdb.collection(\"users\").doc(state.userID).collection(\"chats\").doc(roomID).set({\n                timestamp: createTimestamp(),\n                photoURL: user.photoURL ? user.photoURL : null,\n                name: user.displayName,\n                userID: user.uid,\n                unreadMessages: fieldIncrement(1),\n            }, { merge: true });\n            db.collection(\"users\").doc(user.uid).collection(\"chats\").doc(roomID).set({\n                timestamp: createTimestamp(),\n                photoURL: state.photoURL ? state.photoURL : null,\n                name: state.name,\n                userID: state.userID\n            }, { merge: true });\n        } else {\n        \tdb.collection(\"users\").doc(user.uid).collection(\"chats\").doc(roomID).set({\n                timestamp: createTimestamp(),\n                photoURL: state.photoURL ? state.photoURL : null,\n                name: state.name,\n            });\n        };\n        const doc = await db.collection(\"rooms\").doc(roomID).collection(\"messages\").add({\n        \tname: user.displayName,\n            uid: user.uid,\n            timestamp: createTimestamp(),\n            time: new Date().toUTCString(),\n            audioUrl: \"uploading\",\n            audioName,\n            audioPlayed: false\n        });\n        await audioStorage.child(audioName).put(audioFile);\n        const url = await audioStorage.child(audioName).getDownloadURL();\n        db.collection(\"rooms\").doc(roomID).collection(\"messages\").doc(doc.id).update({\n            audioUrl: url\n        });\n        if (state.userID && token !== \"\") {\n        \tdb.collection(\"notifications\").add({\n\t            userID: user.uid,\n\t            title: user.displayName,\n\t            body: \"🎙️ \" + timer,\n\t            photoURL: user.photoURL,\n\t            token: token\n\t        });\n        };\n\t};\n\n\tasync function startRecording(e) {\n\t\te.preventDefault();\n\t\tif (window.navigator.onLine) {\n\t\t\tif (focus) {\n\t\t\t\tinputRef.current.focus();\n\t\t\t}\n\t\t\tawait wait(150);\n\t\t\trecord.current = await recorder(roomID);\n\t\t\tsetAudioID(null);\n\t\t\tinputRef.current.style.width = \"calc(100% - 56px)\"\n\t\t\tawait wait(305);\n\t\t\tsetRecording(true);\n\t\t} else {\n\t\t\talert(\"No access to internet !!!\");\n\t\t}\n\t}\n\n\tasync function stopRecording() {\n\t\tif (focus) {\n\t\t\tinputRef.current.focus();\n\t\t}\n\t\tdb.collection(\"rooms\").doc(roomID).set({\n            [user.uid]: false,\n        }, { merge: true });\n\t\tclearInterval(timerInterval.current);\n\t\tconst stopped = record.current.stop();\n\t\trecordingEl.current.style.opacity = \"0\";\n\t\tawait wait(300);\n\t\tsetRecording(false);\n\t\tinputRef.current.style.width = \"calc(100% - 112px)\";\n\t\tconst time = recordingTimer;\n\t\tsetRecordingTimer(\"00:00\");\n\t\treturn [stopped, time];\n\t}\n\n\tasync function finishRecording() {\n\t\tvar [audio, time] = await stopRecording();\n\t\taudio = await audio;\n\t\tsendAudio(audio.audioFile, time, audio.audioName);\n\t}\n\n\tfunction pad(val) {\n        var valString = val + \"\";\n        if(valString.length < 2) {\n            return \"0\" + valString;\n        } else {\n            return valString;\n        }\n    }\n\n\tfunction timer() {\n        const start = Date.now();\n        timerInterval.current = setInterval(setTime, 100);\n\n        function setTime() {\n            const delta = Date.now() - start; // milliseconds elapsed since start\n            const totalSeconds = Math.floor(delta / 1000);\n            setRecordingTimer(pad(parseInt(totalSeconds/60)) + \":\" + pad(totalSeconds%60))\n        }\n\t}\n\n\tfunction audioInputChange(e) {\n\t\tif (window.navigator.onLine) {\n\t\t\tconst file = e.target.files[0];\n\t\t\tif (file) {\n\t\t\t\tsetAudioID(null);\n\t\t\t\tconst audioFile = new Audio(URL.createObjectURL(file));\n\t\t\t\taudioFile.addEventListener(\"loadedmetadata\", () => {\n\t\t\t\t\tconst totalSeconds = Math.floor(audioFile.duration);\n\t\t\t\t\tconst time = pad(parseInt(totalSeconds/60)) + \":\" + pad(totalSeconds%60);\n\t\t\t\t\tsendAudio(file,time, uuidv4());\n\t\t\t\t});\n\t\t\t};\n\t\t} else {\n\t\t\talert(\"Нет подключения к интернету!\");\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tconst a = async () => {\n\t\t\tawait wait(10);\n\t\t\trecordingEl.current.style.opacity = \"1\";\n\t\t\tawait wait(100);\n\t\t\ttimer();\n\t\t\tdb.collection(\"rooms\").doc(roomID).set({\n                [user.uid]: \"recording\",\n            }, { merge: true })\n\t\t\trecord.current.start();\n\t\t}\n\t\tif (recording) {\n\t\t\ta();\n\t\t}\n\t}, [recording]);\n\n\tconst btnIcons = <>\n\t\t<CSSTransition\n        \tin={input !== \"\" || (input === \"\" && image)}\n        \ttimeout={{\n        \t\tenter: 400,\n        \t\texit: 200,\n        \t}}\n        \tclassNames=\"send__animate2\"\n        >\n        \t<Send \n            \tstyle={{\n                    width: 20,\n                    height: 20,\n                    color: \"white\"\n                }}\n            />\n        </CSSTransition>\n        <CSSTransition\n        \tin={!(input !== \"\" || (input === \"\" && image))}\n        \ttimeout={{\n        \t\tenter: 400,\n        \t\texit: 200,\n        \t}}\n        \tclassNames=\"send__animate\"\n        >\n        \t<MicRounded \n            \tstyle={{\n            \t\twidth: 24,\n                    height: 24,\n                    color: \"white\"\n            \t}}\n            />\n    \t</CSSTransition>\n\t</>;\n\n\treturn (\n\t\t<div className=\"chat__footer\" onBlur={handleBlur} > \n\t\t\t   {/* <p>ChatFooter.js</p>*/}\n\t        <form>\n\t            <input\n\t            \tref={inputRef}\n\t                value={input}\n\t                onClick={handleFocus}\n\t                onChange={!recording ? change : null}\n\t                onKeyPress={recording ? () => false : null}\n\t                onFocus={() => setFocus(true)}\n\t                placeholder=\"Пишите\"\n\t            />\n\t            {navigator.mediaDevices.getUserMedia && window.MediaRecorder ?\n\t            \t<button \n\t\t            \ttype=\"submit\" \n\t\t            \tclassName=\"send__btn\" \n\t\t            \tonClick={input !== \"\" || (input === \"\" && image) ? sendMessage : startRecording}\n\t\t            >\n\t\t                {btnIcons}\n\t\t            </button>\t\n\t\t        :\n\t\t        \t<>\n\t\t        \t\t<label\n\t\t\t        \t\tfor=\"capture\"  \n\t\t\t            \tclassName=\"send__btn\" \n\t\t\t            >\n\t\t\t                {btnIcons}\n\t\t\t            </label> \n\t\t\t        \t<input\n\t\t\t        \t\tstyle={{display: \"none\"}} \n\t\t\t\t        \ttype=\"file\" \n\t\t\t\t            id=\"capture\" \n\t\t\t\t            accept=\"audio/*\" \n\t\t\t\t            capture\n\t\t\t\t            onChange={audioInputChange}  \n\t\t\t            />\n\t\t        \t</>\n\t\t        }\n\t            \n\t        </form>\n\t        {recording ?\n\t\t        <div ref={recordingEl} className=\"record\">\n\t\t        \t<CancelRounded\n\t\t        \t\tstyle={{\n\t                \t\twidth: 30,\n\t\t                    height: 30,\n\t\t                    color: \"#F20519\"\n\t                \t}}\n\t                \tonClick={stopRecording}\n\t\t        \t/>\n\t\t        \t<div>\n\t\t        \t\t<div className=\"record__redcircle\"></div>\n\t\t        \t\t<div className=\"record__duration\">{recordingTimer}</div>\n\t\t        \t</div>\n\t\t        \t<CheckCircleRounded\n\t\t        \t\tstyle={{\n\t                \t\twidth: 30,\n\t\t                    height: 30,\n\t\t                    color: \"#41BF49\"\n\t                \t}}\n\t                \tonClick={finishRecording} \n\t\t        \t/>\n\t\t        </div> : null\n\t\t    }\n\t    </div>\n\t)\n})","import { useState, useEffect, memo, useRef } from 'react';\nimport PlayArrowRoundedIcon from '@material-ui/icons/PlayArrowRounded';\nimport PauseRoundedIcon from '@material-ui/icons/PauseRounded';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport PlayForWorkRoundedIcon from '@material-ui/icons/PlayForWorkRounded';\nimport db from \"./firebase\";\nimport \"./AudioPlayer.css\"\n\nexport default memo(function AudioPlayer({sender, roomID, audioUrl, id, setAudioID, audioID, animState, audioPlayed}) {\n\tconst [isPlaying, setIsPlaying] = useState(false);\n\tconst [mediaLoaded, setMediaLoaded] = useState(false);\n\tconst [loaded, setLoaded] = useState(false);\n\tconst [metadataLoaded, setMetadataLoaded] = useState(false);\n\tconst [error, setError] = useState(false);\n\tconst [sliderValue, setSliderValue] = useState(0);\n\tconst [sliderPlayedWidth, setSliderPlayedWidth] = useState(\"0%\");\n\tconst [duration, setDuration] = useState(\"\");\n\tconst totalDuration = useRef(\"\");\n\tconst audio = useRef(new Audio(audioUrl));\n\tconst interval = useRef();\n\tconst uploading = useRef(audioUrl === \"uploading\");\n\n\tfunction play () {\n\t\taudio.current.play();\n\t\tif (!audioPlayed && !sender) {\n\t\t\tdb.collection(\"rooms\").doc(roomID).collection(\"messages\").doc(id).set({\n\t\t\t\taudioPlayed: true\n\t\t\t}, {merge: true});\n\t\t}\n\t\tif (audioID !== id) {\n\t\t\tsetAudioID(id);\n\t\t}\n\t\tinterval.current = setInterval(seekUpdate, 50);\n\t\tsetIsPlaying(true);\n\t}\n\n\tfunction pause() {\n\t\taudio.current.pause();\n\t\tclearInterval(interval.current);\n\t\tsetIsPlaying(false);\n\t\tsetDuration(totalDuration.current);\n\t}\n\n\tfunction inputChange(e) {\n\t\tconst value = e.target.value;\n\t\tif (mediaLoaded) {\n\t\t\tconst seekto = audio.current.duration * (value / 100);\n\t\t\taudio.current.currentTime = seekto;\n\t\t\tsetSliderValue(value);\n\t\t\tsetSliderPlayedWidth(`${value - 5.7 * (value / 100)}%`);\n\t\t}\n\t}\n\n\tfunction getCurrentTime() {\n\t\t// Calculate the time left and the total duration \n\t\tlet currentMinutes = Math.floor(audio.current.currentTime / 60); \n\t\tlet currentSeconds = Math.floor(audio.current.currentTime - currentMinutes * 60); \n\n\t\t// Add a zero to the single digit time values \n\t\tif (currentSeconds < 10) { currentSeconds = \"0\" + currentSeconds; } \n\t\tif (currentMinutes < 10) { currentMinutes = \"0\" + currentMinutes; } \n\n\t\t// Display the updated duration \n\t\treturn  currentMinutes + \":\" + currentSeconds; \n\t}\n\n\tfunction seekUpdate() { \n\t\tlet seekPosition = 0; \n\t\t// Check if the current track duration is a legible number \n\t\tif (!isNaN(audio.current.duration)) { \n\t\t\tseekPosition = audio.current.currentTime * (100 / audio.current.duration); \n\t\t\tsetSliderValue(seekPosition);\n\t\t\tsetSliderPlayedWidth(seekPosition + \"%\"); \n\t\t\tsetDuration(getCurrentTime());\n\t\t} \n\t}\n\n\tfunction loadAudioAgain() {\n\t\taudio.current.load();\n\t\tsetError(false);\n\t}\n\n\tfunction calculateMediaDuration(media){\n\t  return new Promise( (resolve,reject)=>{\n\t    media.onloadedmetadata = function(){\n\t      // set the mediaElement.currentTime  to a high value beyond its real duration\n\t      media.currentTime = Number.MAX_SAFE_INTEGER;\n\t      // listen to time position change\n\t      media.ontimeupdate = function(){\n\t        media.ontimeupdate = function(){};\n\t        // setting player currentTime back to 0 can be buggy too, set it first to .1 sec\n\t        media.currentTime = 0.1;\n\t        media.currentTime = 0;\n\t        // media.duration should now have its correct value, return it...\n\t        resolve(media.duration);\n\t      }\n\t    }\n\t  });\n\t};\n\t\n\tuseEffect(() => {\n\t\tif (uploading.current === true && audioUrl !== \"uploading\") {\n\t\t\taudio.current = new Audio(audioUrl);\n\t\t\taudio.current.load();\n\t\t\tsetLoaded(true);\n\t\t} else if (uploading.current === false) {\n\t\t\tsetLoaded(true);\n\t\t}\n\t}, [audioUrl]);\n\n\tuseEffect(() => {\n\t\tif (loaded) {\n\t\t\taudio.current.addEventListener(\"error\", () => {\n\t\t\t\tsetError(true);\n\t\t\t});\n\t\t\tcalculateMediaDuration(audio.current).then(() => {\n\t\t\t\tsetMetadataLoaded(true);\n\t\t\t})\n\t\t}\n\t}, [loaded]); \n\n\tuseEffect(() => {\n\t\tif (metadataLoaded) {\n\t\t\taudio.current.addEventListener(\"canplaythrough\", async () => {\n\t\t\t\tif (totalDuration.current === \"\") {\n\t\t\t\t\tsetMediaLoaded(true);\n\t\t\t\t\tlet durationMinutes = Math.floor(audio.current.duration / 60); \n\t\t\t\t\tlet durationSeconds = Math.floor(audio.current.duration - durationMinutes * 60); \n\t\t\t\t\t// Add a zero to the single digit time values \n\t\t\t\t\tif (durationSeconds < 10) { durationSeconds = \"0\" + durationSeconds; } \n\t\t\t\t\tif (durationMinutes < 10) { durationMinutes = \"0\" + durationMinutes; } \n\t\t\t\t\t// Display the updated duration \n\t\t\t\t\ttotalDuration.current = durationMinutes + \":\" + durationSeconds;\n\t\t\t\t\tsetDuration(totalDuration.current);\n\t\t\t\t}\n\t\t\t});\n\t\t\taudio.current.addEventListener(\"ended\", () => {\n\t\t\t\tclearInterval(interval.current);\n\t\t\t\tsetDuration(totalDuration.current);\n\t\t\t\tsetSliderValue(0);\n\t\t\t\tsetSliderPlayedWidth(\"0%\");\n\t\t\t\tsetIsPlaying(false);\n\t\t\t});\n\t\t}\n\t}, [metadataLoaded]);\n\n\tuseEffect(() => {\n\t\tif (animState === \"exiting\") {\n\t\t\taudio.current.pause();\n\t\t}\n\t}, [animState]);\n\n\tuseEffect(() => {\n\t\tif (audioID !== id) {\n\t\t\taudio.current.pause();\n\t\t\tsetIsPlaying(false);\n\t\t}\n\t}, [audioID])\n\n\treturn (\n\t\t<>\n\t\t\t<div className={`${sender ? \"audioplayer\" : \"audioplayer audioplayer2\"} ${audioPlayed ? \"audioplayer__played\" : \"\"}`}>\n\t\t\t\t{!mediaLoaded && !error ?\n\t\t\t\t\t<CircularProgress />\n\t\t\t\t: isPlaying && !error? \n\t\t\t\t\t<PauseRoundedIcon className=\"pause\" onClick={pause} /> \n\t\t\t\t: !isPlaying && !error ?\n\t\t\t\t\t<PlayArrowRoundedIcon onClick={play} />\n\t\t\t\t: \n\t\t\t\t\t<PlayForWorkRoundedIcon onClick={loadAudioAgain} />\n\t\t\t\t}\n\t\t\t\t<div>\n\t\t\t\t\t<span \n\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\twidth: sliderPlayedWidth,\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tclassName=\"audioplayer__slider--played\" \n\t\t\t\t\t></span>\n\t\t\t\t\t<input\t\n\t\t\t\t\t\ttype=\"range\" min=\"1\" max=\"100\" value={sliderValue}\n\t\t\t\t\t\tonChange={inputChange} className=\"audioplayer__slider\"\n\t\t\t\t\t></input>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<span className=\"chat__timestamp audioplayer__time\">{duration}</span>\n\t\t</>\n\t)\n})","export default __webpack_public_path__ + \"static/media/message_sent.3957aabd.mp3\";","export default __webpack_public_path__ + \"static/media/message_received.7170470c.mp3\";","import { useState, useEffect, useLayoutEffect, useRef, memo } from \"react\";\nimport { Avatar, IconButton } from \"@material-ui/core\";\nimport {\n  TransitionGroup,\n  Transition,\n  CSSTransition,\n} from \"react-transition-group\";\nimport {\n  AddPhotoAlternate,\n  MoreVert,\n  DoneAllRounded,\n  ArrowDownward,\n  ArrowBack,\n} from \"@material-ui/icons\";\nimport {\n  useParams,\n  useRouteMatch,\n  useLocation,\n  Link,\n  Route,\n  useHistory,\n} from \"react-router-dom\";\nimport db, {\n  auth,\n  createTimestamp,\n  fieldIncrement,\n  storage,\n  audioStorage,\n} from \"./firebase\";\nimport { useStateValue } from \"./StateProvider\";\nimport Menu from \"@material-ui/core/Menu\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport MediaPreview from \"./MediaPreview\";\nimport ImagePreview from \"./ImagePreview\";\nimport ChatFooter from \"./ChatFooter\";\nimport Compressor from \"compressorjs\";\nimport anime from \"animejs/lib/anime.es.js\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport AudioPlayer from \"./AudioPlayer.js\";\nimport \"./Chat.css\";\nimport audio2 from \"./message_sent.mp3\";\nimport audio1 from \"./message_received.mp3\";\n\nimport {\n  Message,\n  PeopleAlt,\n  Home,\n  ExitToApp as LogOut,\n  SearchOutlined,\n  GetAppRounded,\n  Delete, \n  VisibilityOff\n} from \"@material-ui/icons\";\n//import PublicOffIcon from '@mui/icons-material/PublicOff';\n\nfunction Chat({ animState, unreadMessages, b }) {\n  const [input, setInput] = useState(\"\");\n  const { roomID } = useParams();\n  const location = useLocation();\n  const match = useRouteMatch();\n  const [{ dispatchMessages, user, roomsData, page }, dispatch, actionTypes] =\n    useStateValue();\n  const [imagePreview, setImagePreview] = useState({});\n  const [messages, setMessages] = useState([]);\n  const [openMenu, setOpenMenu] = useState(null);\n  const [deleting, setDeleting] = useState(false);\n  const [focus, setFocus] = useState(false);\n  const [token, setToken] = useState(\"\");\n  const [state, setState] = useState(location.state ? location.state : {});\n  const [seen, setSeen] = useState(false);\n  const [typing, setTyping] = useState(false);\n  const [src, setSRC] = useState(\"\");\n  const [image, setImage] = useState(null);\n  const [writeState, setWriteState] = useState(0);\n  const [ratio, setRatio] = useState(false);\n  const [scrollArrow, setScrollArrow] = useState(false);\n  const [clientWidth, setClientWidth] = useState(null);\n  const [firstRender, setFirstRender] = useState(false);\n  const [sendAnim, setSendAnim] = useState(false);\n  const [limitReached, setLimitReached] = useState(\n    Boolean(dispatchMessages[roomID]?.limitReached)\n  );\n  const history = useHistory();\n  const chatBodyRef = useRef();\n  const lastMessageRef = useRef();\n  const chatBodyContainer = useRef();\n  const chatAnim = useRef();\n  const mediaPreview = useRef();\n  const prevMessages = useRef([]);\n  const limit = useRef(30);\n  const prevScrollHeight = useRef(null);\n  const [audioID, setAudioID] = useState(null);\n  const paginating = useRef(null);\n  const paginating2 = useRef(null);\n  const [paginateLoader, setPaginateLoader] = useState(false);\n  const messageSentAudio = new Audio(audio2);\n  const messageReceivedAudio = new Audio(audio1);\n  const mediaSnap = useRef([]);\n  const mediaChecked = useRef(false);\n\n  //console.log(match)\n  const change = (e) => {\n    clearTimeout(writeState);\n    setInput(e.target.value);\n    if (state?.userID) {\n      db.collection(\"rooms\")\n        .doc(roomID)\n        .set(\n          {\n            [user.uid]: true,\n          },\n          { merge: true }\n        )\n        .then(() => {\n          setWriteState(\n            setTimeout(() => {\n              db.collection(\"rooms\")\n                .doc(roomID)\n                .set(\n                  {\n                    [user.uid]: false,\n                  },\n                  { merge: true }\n                );\n            }, 1000)\n          );\n        });\n    }\n  };\n\n  const clickImagePreview = (event, src, ratio) => {\n    const target = event.target;\n    const node = target.parentNode.parentNode;\n    const obj = node.getBoundingClientRect();\n    setImagePreview({\n      ratio: ratio,\n      top:\n        page.transform === \"scale(1)\"\n          ? obj.top\n          : obj.top / (window.innerHeight / page.height),\n      left:\n        page.transform === \"scale(1)\"\n          ? obj.left\n          : obj.left / (window.innerWidth / page.width),\n      width: node.offsetWidth,\n      height: node.offsetHeight,\n      imgW: target.offsetWidth,\n      imgH: target.offsetHeight,\n      src,\n    });\n  };\n\n  const close = () => {\n    mediaPreview.current.style.animation = \"opacity-out 300ms ease forwards\";\n    setTimeout(() => {\n      setImage(null);\n      setSRC(\"\");\n    }, 310);\n  };\n\n  const handleFile = (event) => {\n    if (window.navigator.onLine) {\n      if (event.target.files[0]) {\n        var reader = new FileReader();\n        reader.onload = function () {\n          setSRC(reader.result);\n        };\n        reader.readAsDataURL(event.target.files[0]);\n        setImage(event.target.files[0]);\n      }\n    } else {\n      alert(\"Нет подключения к интернету!\");\n    }\n  };\n  //window\n  const scrollChatBody = () => {\n    const nodeArr = Array.from(document.querySelectorAll(\".chat__message\"));\n    const height =\n      outerHeight(nodeArr[nodeArr.length - 2]) +\n      outerHeight(nodeArr[nodeArr.length - 3]) +\n      outerHeight(nodeArr[nodeArr.length - 4]);\n    const lastMHeight = height < page.height / 2 ? height : page.height / 2;\n    if (\n      chatBodyContainer.current.scrollHeight -\n        chatBodyContainer.current.offsetHeight ===\n      0\n    ) {\n      setTimeout(\n        () => {\n          if (chatBodyRef.current) {\n            chatBodyRef.current.style.opacity = \"1\";\n          }\n          setFirstRender(true);\n        },\n        animState === \"entering\" ? 350 : 50\n      );\n      setTimeout(() => {\n        const node = document.querySelector(\".chat .chat__lastMessage\");\n        if (node) {\n          node.style.animation = \"none\";\n          node.style.opacity = \"1\";\n        }\n      }, 50);\n    } else if (\n      chatBodyContainer.current.scrollTop +\n        outerHeight(nodeArr[nodeArr.length - 1]) >=\n        chatBodyContainer.current.scrollHeight -\n          chatBodyContainer.current.offsetHeight -\n          lastMHeight &&\n      messages[messages.length - 1].uid !== user.uid\n    ) {\n      if (\n        chatBodyContainer.current.scrollTop !==\n        chatBodyContainer.current.scrollHeight\n      ) {\n        //console.log(\"scrolling down 1\");\n        setSendAnim(true);\n        anime({\n          targets: chatBodyContainer.current,\n          scrollTop: chatBodyContainer.current.scrollHeight,\n          duration: 800,\n          easing: \"linear\",\n          complete: function () {\n            setSendAnim(false);\n          },\n        });\n      }\n    } else if (messages[messages.length - 1].uid === user.uid) {\n      if (\n        chatBodyContainer.current.scrollTop !==\n        chatBodyContainer.current.scrollHeight\n      ) {\n        //console.log(\"scrolling down 2\");\n        setSendAnim(true);\n        anime({\n          targets: chatBodyContainer.current,\n          scrollTop: chatBodyContainer.current.scrollHeight,\n          duration: 800,\n          easing: \"linear\",\n          complete: function () {\n            setSendAnim(false);\n          },\n        });\n      }\n    } else {\n      setScrollArrow(true);\n    }\n  };\n\n  function outerHeight(el) {\n    if (el) {\n      var height = el.offsetHeight;\n      var style = getComputedStyle(el);\n\n      height += parseInt(style.marginTop) + parseInt(style.marginBottom);\n      return height;\n    }\n    return null;\n  }\n\n  const sendMessage = async (event) => {\n    event.preventDefault();\n    if (focus) {\n      document.querySelector(\".chat__footer > form > input\").focus();\n    }\n    if (input !== \"\" || (input === \"\" && image)) {\n      const inputText = input;\n      const imageToUpload = image;\n      if (imageToUpload) {\n        close();\n      }\n      setInput(\"\");\n      const roomInfo = {\n        lastMessage: imageToUpload\n          ? {\n              message: inputText,\n              audio: false,\n            }\n          : inputText,\n        seen: false,\n      };\n      db.collection(\"rooms\").doc(roomID).set(roomInfo, { merge: true });\n      var split, imageName;\n      if (imageToUpload) {\n        split = imageToUpload.name.split(\".\");\n        imageName = split[0] + uuidv4() + \".\" + split[1];\n      }\n      const messageToSend = imageToUpload\n        ? {\n            name: user.displayName,\n            message: input,\n            uid: user.uid,\n            timestamp: createTimestamp(),\n            time: new Date().toLocaleString(\"ru\", {\n              year: \"numeric\",\n              month: \"long\",\n              day: \"numeric\",\n              weekday: \"long\",\n              timezone: \"UTC\",\n              hour: \"numeric\",\n              minute: \"numeric\",\n              //  second: 'numeric'\n            }),\n            imageUrl: \"uploading\",\n            imageName: imageName,\n            ratio: ratio,\n          }\n        : {\n            name: user.displayName,\n            message: input,\n            uid: user.uid,\n            timestamp: createTimestamp(),\n            time: new Date().toLocaleString(\"ru\", {\n              year: \"numeric\",\n              month: \"long\",\n              day: \"numeric\",\n              weekday: \"long\",\n              timezone: \"UTC\",\n              hour: \"numeric\",\n              minute: \"numeric\",\n              // second: 'numeric'\n            }),\n          };\n      if (state.userID) {\n        db.collection(\"users\")\n          .doc(state.userID)\n          .collection(\"chats\")\n          .doc(roomID)\n          .set(\n            {\n              timestamp: createTimestamp(),\n              photoURL: user.photoURL ? user.photoURL : null,\n              name: user.displayName,\n              userID: user.uid,\n              unreadMessages: fieldIncrement(1),\n            },\n            { merge: true }\n          );\n        db.collection(\"users\")\n          .doc(user.uid)\n          .collection(\"chats\")\n          .doc(roomID)\n          .set(\n            {\n              timestamp: createTimestamp(),\n              photoURL: state.photoURL ? state.photoURL : null,\n              name: state.name,\n              userID: state.userID,\n            },\n            { merge: true }\n          );\n        if (token !== \"\" && !imageToUpload) {\n          db.collection(\"notifications\").add({\n            userID: user.uid,\n            title: user.displayName,\n            body: inputText,\n            photoURL: user.photoURL,\n            token: token,\n          });\n        }\n      } else {\n        db.collection(\"users\")\n          .doc(user.uid)\n          .collection(\"chats\")\n          .doc(roomID)\n          .set({\n            timestamp: createTimestamp(),\n            photoURL: state.photoURL ? state.photoURL : null,\n            name: state.name,\n          });\n      }\n      const doc = await db\n        .collection(\"rooms\")\n        .doc(roomID)\n        .collection(\"messages\")\n        .add(messageToSend);\n      if (imageToUpload) {\n        new Compressor(imageToUpload, {\n          quality: 0.8,\n          maxWidth: 1920,\n          async success(result) {\n            setSRC(\"\");\n            setImage(null);\n            await storage.child(imageName).put(result);\n            const url = await storage.child(imageName).getDownloadURL();\n            db.collection(\"rooms\")\n              .doc(roomID)\n              .collection(\"messages\")\n              .doc(doc.id)\n              .update({\n                imageUrl: url,\n              });\n            if (state.userID && token !== \"\")\n              db.collection(\"notifications\").add({\n                userID: user.uid,\n                title: user.displayName,\n                body: inputText,\n                photoURL: user.photoURL,\n                token: token,\n                image: url,\n              });\n          },\n        });\n      }\n    }\n  };\n\n  const deleteRoom = async () => {\n    if (window.navigator.onLine) {\n      setOpenMenu(false);\n      setDeleting(true);\n      try {\n        const room = db.collection(\"rooms\").doc(roomID);\n        const fetchedMessages = await room.collection(\"messages\").get();\n        const fetchedAudios = [];\n        const fecthedImages = [];\n        fetchedMessages.docs.forEach((doc) => {\n          if (doc.data().audioName) {\n            fetchedAudios.push(doc.data().audioName);\n          } else if (doc.data().imageName) {\n            fecthedImages.push(doc.data().imageName);\n          }\n        });\n        var usersChats = [];\n        if (state.userID) {\n          usersChats = [state.userID, user.uid];\n        } else {\n          usersChats = [\n            ...new Set(fetchedMessages.docs.map((cur) => cur.data().uid)),\n          ];\n        }\n        await Promise.all([\n          ...fetchedMessages.docs.map((doc) => doc.ref.delete()),\n          ...fecthedImages.map((img) => storage.child(img).delete()),\n          ...fetchedAudios.map((aud) => audioStorage.child(aud).delete()),\n          ...usersChats.map((userChat) =>\n            db\n              .collection(\"users\")\n              .doc(userChat)\n              .collection(\"chats\")\n              .doc(roomID)\n              .delete()\n          ),\n          room.delete(),\n        ]);\n        page.width <= 760 ? history.goBack() : history.replace(\"/chats\");\n      } catch (e) {\n        console.log(e.message);\n        page.width <= 760 ? history.goBack() : history.replace(\"/chats\");\n      }\n    } else {\n      alert(\"Проверьте соединение с интернетом!!!\");\n    }\n  };\n\n  const handleFocus = () => {\n    if (\n      chatBodyContainer.current.scrollTop >\n      chatBodyContainer.current.scrollHeight -\n        chatBodyContainer.current.offsetHeight -\n        120\n    ) {\n      chatBodyContainer.current.scrollTop =\n        chatBodyContainer.current.scrollHeight;\n    }\n  };\n\n  function fetchMessages(update) {\n    const ref = db\n      .collection(\"rooms\")\n      .doc(roomID)\n      .collection(\"messages\")\n      .orderBy(\"timestamp\", \"desc\");\n    if (update) {\n      b.current[roomID] = ref.limit(5).onSnapshot((snapshot) => {\n        const newMessages = snapshot.docs.map((doc) => {\n          const data = doc.data();\n          const time = data.time\n            ? data.time\n            : new Date(data.timestamp?.toDate()).toUTCString();\n          return {\n            ...data,\n            timestamp: time,\n            id: doc.id,\n          };\n        });\n        newMessages.reverse();\n        dispatch({\n          type: actionTypes.SET_MESSAGES,\n          id: roomID,\n          messages: newMessages,\n          update,\n        });\n      });\n    } else {\n      ref\n        .limit(limit.current)\n        .get()\n        .then((docs) => {\n          const newMessages = [];\n          docs.forEach((doc) => {\n            const data = doc.data();\n            const time = data.time\n              ? data.time\n              : new Date(data.timestamp?.toDate()).toUTCString();\n            newMessages.push({\n              ...data,\n              timestamp: time,\n              id: doc.id,\n            });\n          });\n          newMessages.reverse();\n          dispatch({\n            type: actionTypes.SET_MESSAGES,\n            id: roomID,\n            messages: newMessages,\n            update,\n          });\n        });\n    }\n  }\n\n  function paginate() {\n    if (\n      chatBodyContainer.current?.scrollTop === 0 &&\n      !limitReached &&\n      !paginating.current\n    ) {\n      setPaginateLoader(true);\n      prevScrollHeight.current = chatBodyContainer.current.scrollHeight;\n      paginating.current = true;\n      paginating2.current = true;\n      limit.current = messages.length + limit.current;\n      fetchMessages(false);\n    } else if (paginating2.current) {\n      prevScrollHeight.current =\n        chatBodyContainer.current.scrollHeight -\n        chatBodyContainer.current.scrollTop;\n    }\n  }\n\n  useEffect(() => {\n    if (messages.length > 0 && !deleting) {\n      if (\n        messages[messages.length - 1].id !==\n          prevMessages.current[prevMessages.current?.length - 1]?.id &&\n        dispatchMessages[roomID]?.audio\n      ) {\n        if (\n          messages[messages.length - 1].uid !== user.uid &&\n          !paginating2.current &&\n          (messages[messages.length - 1].imageUrl === \"uploading\" ||\n            !messages[messages.length - 1].imageUrl)\n        ) {\n          messageReceivedAudio.play();\n        } else if (\n          messages[messages.length - 1].uid === user.uid &&\n          !paginating2.current &&\n          (messages[messages.length - 1].imageUrl === \"uploading\" ||\n            !messages[messages.length - 1].imageUrl) &&\n          (messages[messages.length - 1].audioUrl === \"uploading\" ||\n            !messages[messages.length - 1].audioUrl)\n        ) {\n          messageSentAudio.play();\n        }\n      }\n    }\n  }, [messages, deleting, dispatchMessages[roomID]]);\n\n  useEffect(() => {\n    if (firstRender && !limitReached) {\n      chatBodyContainer.current.addEventListener(\"scroll\", paginate);\n    }\n    const clean = chatBodyContainer.current;\n    return () => {\n      clean.removeEventListener(\"scroll\", paginate);\n    };\n  }, [firstRender, limitReached]);\n\n  useEffect(\n    () => {\n      if (limitReached !== dispatchMessages[roomID]?.limitReached) {\n        //console.log(\"setting limit reached: \", Boolean(dispatchMessages[roomID]?.limitReached));\n        setLimitReached(Boolean(dispatchMessages[roomID]?.limitReached));\n      }\n    },\n    [dispatchMessages[roomID]],\n    limitReached\n  );\n\n  useLayoutEffect(() => {\n    //console.log(\"paginating: \", paginating.current)\n    if (messages.length > 0 && paginating.current) {\n      if (\n        paginating.current &&\n        messages.length > prevMessages.current?.length\n      ) {\n        chatBodyContainer.current.scrollTop =\n          chatBodyContainer.current.scrollHeight - prevScrollHeight.current;\n        paginating.current = false;\n        setPaginateLoader(false);\n      }\n    }\n  }, [messages]);\n\n  useEffect(() => {\n    if (messages.length > 0) {\n      if (\n        !firstRender &&\n        chatBodyContainer.current.scrollHeight -\n          chatBodyContainer.current.offsetHeight !==\n          0\n      ) {\n        chatBodyContainer.current.scrollTop =\n          chatBodyContainer.current.scrollHeight;\n        setTimeout(() => {\n          const node = document.querySelector(\".chat .chat__lastMessage\");\n          if (node) {\n            node.style.animation = \"none\";\n            node.style.opacity = \"1\";\n          }\n          setTimeout(() => {\n            setFirstRender(true);\n          }, 200);\n        }, 50);\n      } else {\n        //console.log(\"messages: \", messages);\n        //console.log(\"previous messages: \", prevMessages.current);\n        //console.log(\"paginating2: \", paginating2.current)\n        if (!paginating2.current) {\n          scrollChatBody();\n        }\n      }\n    }\n  }, [messages]);\n\n  function listenToImg(docID) {\n    return db\n      .collection(\"rooms\")\n      .doc(roomID)\n      .collection(\"messages\")\n      .doc(docID)\n      .onSnapshot((doc) => {\n        //console.log(\"image snap set\");\n        //console.log(\"image data: \", doc.data());\n        const { imageUrl } = doc.data();\n        if (imageUrl !== \"uploading\") {\n          //console.log(\"dispatching the image\");\n          dispatch({\n            type: \"update_media\",\n            roomID: roomID,\n            id: docID,\n            data: { imageUrl },\n          });\n          //console.log(\"unsubscribing from image snap: \", docID);\n          mediaSnap.current = mediaSnap.current.filter((cur) => {\n            if (cur.id !== docID) {\n              return true;\n            }\n            cur.snap();\n            return false;\n          });\n        }\n      });\n  }\n\n  function listenToAudio(docID) {\n    //console.log(\"listen to audio function\")\n    const s = db\n      .collection(\"rooms\")\n      .doc(roomID)\n      .collection(\"messages\")\n      .doc(docID)\n      .onSnapshot((doc) => {\n        //console.log(\"audio snap set\");\n        //console.log(\"audio data: \", doc.data());\n        const { audioUrl, audioPlayed } = doc.data();\n        if (audioUrl !== \"uploading\" || audioPlayed === true) {\n          //console.log(\"dispatching audio\");\n          dispatch({\n            type: \"update_media\",\n            roomID: roomID,\n            id: docID,\n            data: {\n              audioUrl,\n              audioPlayed,\n            },\n          });\n        }\n        if (audioUrl !== \"uploading\" && audioPlayed === true) {\n          //console.log(\"unsubscribing from audio snap: \", docID);\n          mediaSnap.current = mediaSnap.current.filter((cur) => {\n            if (cur.id !== docID) {\n              return true;\n            }\n            cur.snap();\n            return false;\n          });\n        }\n      });\n    return s;\n  }\n\n  useEffect(() => {\n    return () => {\n      dispatch({ type: \"set_audio_false\", id: roomID });\n    };\n  }, [roomID]);\n\n  useEffect(() => {\n    if (messages.length > 0 && firstRender && !mediaChecked.current) {\n      //console.log(\"checking media\");\n      messages.forEach((cur) => {\n        if (cur.imageUrl === \"uploading\") {\n          //console.log(\"listening to an image\");\n          const x = listenToImg(cur.id);\n          mediaSnap.current.push({\n            snap: x,\n            id: cur.id,\n          });\n        } else if (cur.audioUrl === \"uploading\" || cur.audioPlayed === false) {\n          //console.log(\"listening to audio\");\n          const x = listenToAudio(cur.id);\n          mediaSnap.current.push({\n            snap: x,\n            id: cur.id,\n          });\n        }\n      });\n      mediaChecked.current = true;\n    } else if (\n      messages.length > prevMessages.current.length &&\n      firstRender &&\n      mediaChecked.current\n    ) {\n      //console.log(\"checking updates\")\n      let init = 0;\n      let stop = messages.length - prevMessages.length;\n      if (prevMessages.current[0]?.id === messages[0].id) {\n        init = prevMessages.current.length;\n        stop = messages.length;\n      }\n      for (var i = init; i < stop; i++) {\n        if (messages[i].imageUrl === \"uploading\") {\n          //console.log(\"listening to an image\");\n          const x = listenToImg(messages[i].id);\n          mediaSnap.current.push({\n            snap: x,\n            id: messages[i].id,\n          });\n        } else if (\n          messages[i].audioUrl === \"uploading\" ||\n          messages[i].audioPlayed === false\n        ) {\n          //console.log(\"listening to audio\");\n          const x = listenToAudio(messages[i].id);\n          mediaSnap.current.push({\n            snap: x,\n            id: messages[i].id,\n          });\n        }\n      }\n    }\n  }, [messages, firstRender]);\n\n  useEffect(() => {\n    return () => {\n      //console.log(\"cleaning media snap\");\n      mediaSnap.current.forEach((cur) => cur.snap());\n      setFirstRender(false);\n    };\n  }, [roomID]);\n\n  useEffect(() => {\n    paginating2.current = paginating.current;\n    prevMessages.current = [...messages];\n  }, [messages]);\n\n  useEffect(() => {\n    if (roomID && !deleting) {\n      if (b.current[roomID]) {\n        //console.log(\"snapshot listener already exists\");\n        b.current[roomID]();\n      }\n      //console.log(\"first message from fetch effect: \", dispatchMessages[roomID]?.firstMessageID);\n      if (dispatchMessages[roomID]?.firstMessageID) {\n        fetchMessages(true);\n      } else {\n        db.collection(\"rooms\")\n          .doc(roomID)\n          .collection(\"messages\")\n          .orderBy(\"timestamp\", \"asc\")\n          .limit(1)\n          .get()\n          .then((docs) => {\n            //console.log(\"doc: \", docs);\n            if (docs.empty) {\n              dispatch({\n                type: \"set_firstMessage\",\n                id: roomID,\n                firstMessageID: \"no id\",\n              });\n            } else {\n              docs.forEach((doc) => {\n                //console.log(\"doc.exists: \", doc.exists);\n                //console.log(\"first document id: \", doc.id);\n                //console.log(\"first document data: \", doc.data());\n                dispatch({\n                  type: \"set_firstMessage\",\n                  id: roomID,\n                  firstMessageID: doc.id,\n                });\n              });\n            }\n            fetchMessages(false);\n            fetchMessages(true);\n          });\n      }\n    }\n  }, [roomID, deleting]);\n\n  useEffect(() => {\n    if (src !== \"\") {\n      const width = document.querySelector(\".mediaPreview img\").clientWidth;\n      const height = document.querySelector(\".mediaPreview img\").clientHeight;\n      setRatio(height / width);\n    }\n  }, [src]);\n\n  useEffect(() => {\n    setClientWidth(\n      document.querySelector(\".chat__body--container\").clientWidth\n    );\n  }, []);\n  //window\n  useEffect(() => {\n    if (animState === \"entering\" && page.width <= 760) {\n      setTimeout(() => {\n        document.querySelector(\".chat\").classList.add(\"chat-animate\");\n      }, 0);\n    } else if (animState === \"entered\" && state?.name && page.width <= 760) {\n      setTimeout(() => {\n        document.querySelector(\".sidebar\").classList.remove(\"side\");\n      }, 50);\n    } else if (animState === \"exiting\" && page.width <= 760) {\n      setTimeout(() => {\n        document.querySelector(\".chat\").classList.remove(\"chat-animate\");\n        setTimeout(() => {\n          document.querySelector(\".sidebar\").classList.add(\"side\");\n        }, 10);\n      }, 0);\n    }\n  }, [animState]);\n\n  useEffect(() => {\n    if (!location.state && roomID) {\n      const userID = roomID?.replace(user.uid, \"\");\n      db.collection(\"users\")\n        .doc(userID)\n        .get()\n        .then((doc) => {\n          const data = doc.data();\n          setState(\n            data?.name\n              ? {\n                  name: data.name,\n                  photoURL: data.photoURL,\n                  userID,\n                }\n              : {\n                  userID,\n                }\n          );\n        });\n    } else {\n      setState(location.state);\n    }\n  }, [location.state, roomID]);\n\n  useEffect(() => {\n    if (state?.userID) {\n      db.collection(\"users\")\n        .doc(state.userID)\n        .onSnapshot((doc) => {\n          if (doc.data()?.token) {\n            setToken(doc.data().token);\n          }\n        });\n    }\n  }, [state]);\n\n  useEffect(() => {\n    if (roomID && state?.userID) {\n      var h = db\n        .collection(\"rooms\")\n        .doc(roomID)\n        .onSnapshot((snap) => {\n          if (snap.data()) {\n            setTyping(snap.data()[state.userID]);\n          }\n        });\n    }\n\n    return () => {\n      if (h) h();\n    };\n  }, [roomID, state]);\n\n  useEffect(() => {\n    if (roomID) {\n      var z = db\n        .collection(\"rooms\")\n        .doc(roomID)\n        .onSnapshot((snap) => {\n          setSeen(snap.data()?.seen);\n        });\n    }\n\n    return () => {\n      if (z) {\n        z();\n      }\n    };\n  }, [roomID]);\n\n  //setSender\n  //window\n  useEffect(() => {\n    var a = () => {\n      const nodeArr = Array.from(document.querySelectorAll(\".chat__message\"));\n      const height =\n        outerHeight(nodeArr[nodeArr.length - 1]) +\n        outerHeight(nodeArr[nodeArr.length - 2]) +\n        outerHeight(nodeArr[nodeArr.length - 3]) +\n        outerHeight(nodeArr[nodeArr.length - 4]);\n      const lastMHeight = height < page.height / 2 ? height : page.height / 2;\n      if (\n        chatBodyContainer.current?.scrollTop <=\n        chatBodyContainer.current?.scrollHeight -\n          chatBodyContainer.current?.offsetHeight -\n          lastMHeight\n      ) {\n        setScrollArrow(true);\n      } else {\n        setScrollArrow(false);\n      }\n      const scrollTop = Math.round(chatBodyContainer.current.scrollTop);\n      const scrollHeight =\n        chatBodyContainer.current.scrollHeight -\n        chatBodyContainer.current.offsetHeight;\n      if (\n        (scrollTop === scrollHeight ||\n          scrollTop + 1 === scrollHeight ||\n          scrollTop - 1 === scrollHeight) &&\n        (chatBodyRef.current.style.opacity === \"0\" ||\n          chatBodyRef.current.style.opacity === \"\")\n      ) {\n        setTimeout(\n          () => {\n            if (chatBodyRef.current) {\n              chatBodyRef.current.style.opacity = \"1\";\n            }\n          },\n          animState === \"entering\" ? 350 : 50\n        );\n      }\n      if (messages.length > 0) {\n        if (\n          chatBodyContainer.current.scrollTop >\n            chatBodyContainer.current.scrollHeight -\n              chatBodyContainer.current.offsetHeight -\n              180 &&\n          state.userID &&\n          !seen &&\n          messages[messages.length - 1].uid !== user.uid\n        ) {\n          console.log(\"setting seen true with event\");\n          db.collection(\"rooms\").doc(roomID).set(\n            {\n              seen: true,\n            },\n            { merge: true }\n          );\n        }\n        if (\n          chatBodyContainer.current.scrollTop >\n            chatBodyContainer.current.scrollHeight -\n              chatBodyContainer.current.offsetHeight -\n              180 &&\n          state.userID\n        ) {\n          db.collection(\"users\")\n            .doc(user.uid)\n            .collection(\"chats\")\n            .doc(roomID)\n            .set(\n              {\n                unreadMessages: 0,\n              },\n              { merge: true }\n            );\n        }\n      }\n    };\n    chatBodyContainer.current.addEventListener(\"scroll\", a);\n    const ref = chatBodyContainer.current;\n\n    return () => {\n      ref.removeEventListener(\"scroll\", a);\n    };\n  }, [messages, state, user.uid, roomID, seen]);\n\n  //setting seen and unreadMessages when chat is unscrollable\n  useEffect(() => {\n    if (messages.length > 0) {\n      if (\n        chatBodyContainer.current.scrollHeight -\n          chatBodyContainer.current.offsetHeight ===\n          0 &&\n        messages[messages.length - 1].uid !== user.uid\n      ) {\n        db.collection(\"rooms\").doc(roomID).set(\n          {\n            seen: true,\n          },\n          { merge: true }\n        );\n      }\n    }\n  }, [messages]);\n\n  useEffect(() => {\n    if (messages.length > 0) {\n      if (\n        chatBodyContainer.current.scrollHeight -\n          chatBodyContainer.current.offsetHeight ===\n          0 &&\n        state.userID\n      ) {\n        db.collection(\"users\")\n          .doc(user.uid)\n          .collection(\"chats\")\n          .doc(roomID)\n          .set(\n            {\n              unreadMessages: 0,\n            },\n            { merge: true }\n          );\n      }\n    }\n  }, [messages, state]);\n\n  useEffect(() => {\n    if (dispatchMessages[roomID]?.messages) {\n      setMessages(dispatchMessages[roomID].messages);\n    }\n  }, [dispatchMessages[roomID]]);\n\n  //window\n  const widthRatio = 0.7;\n\n  return (\n    <>\n      <div\n        style={!roomID ? { display: \"none\" } : {}}\n        ref={chatAnim}\n        className=\"chat\"\n      >\n        {/* <p>Chat.js</p>*/}\n        <div\n          style={{\n            height: page.height,\n          }}\n          className=\"chat__background\"\n        ></div>\n        <div className=\"chat__header\">\n          {page.width <= 760 ? (\n            <IconButton onClick={() => setTimeout(() => history.goBack(), 150)}>\n              <ArrowBack />\n              <div className=\"avatar__container\">\n                <Avatar src={state?.photoURL} />\n                {roomsData[roomID]?.onlineState === \"online\" ? (\n                  <div className=\"online\"></div>\n                ) : null}\n              </div>\n            </IconButton>\n          ) : (\n            <div className=\"avatar__container\">\n              <Avatar src={state?.photoURL} />\n              {roomsData[roomID]?.onlineState === \"online\" ? (\n                <div className=\"online\"></div>\n              ) : null}\n            </div>\n          )}\n          <div className=\"chat__header--info\">\n            <h3 style={page.width <= 760 ? { width: page.width - 165 } : {}}>\n              {state?.name}{\" fdsfsdfsdf65465456\"}{state?.about}\n            </h3>\n            <p style={page.width <= 760 ? { width: page.width - 165 } : {}}>\n              {typing === \"recording\"\n                ? \"Записывается ...\"\n                : typing\n                ? \"Пишет ...\"\n                : messages?.length > 0\n                ? \"Просмотрено \" + messages[messages.length - 1]?.timestamp\n                : \"\"}{\" \"}\n            </p>\n          </div>\n\n          <div className=\"chat__header--right\">\n            <input\n              id=\"attach-media\"\n              style={{ display: \"none\" }}\n              accept=\"image/*\"\n              type=\"file\"\n              onChange={handleFile}\n            />\n            <IconButton>\n              <label\n                style={{ cursor: \"pointer\", height: 24 }}\n                htmlFor=\"attach-media\"\n              >\n                <AddPhotoAlternate />\n              </label>\n            </IconButton>\n\n            <IconButton\n              aria-controls=\"menu\"\n              aria-haspopup=\"true\"\n              onClick={(event) => setOpenMenu(event.currentTarget)}\n            >\n              <MoreVert />\n            </IconButton>\n\n            <Menu\n              anchorEl={openMenu}\n              id={\"menu\"}\n              open={Boolean(openMenu)}\n              onClose={() => setOpenMenu(null)}\n              keepMounted\n            >\n              <MenuItem onClick={deleteRoom}>\n                <Delete /> Удалить все сообщения\n              </MenuItem>\n              <MenuItem\n                onClick={() => {\n                  auth.signOut();\n                  db.doc(\"/users/\" + user.uid).set(\n                    { state: \"offline\" },\n                    { merge: true }\n                  );\n                  history.replace(\"/chats\");\n                  setTimeout(() => {\n                    window.location.reload();\n                  }, 1000);\n                }}\n              >\n                <LogOut /> Выйти\n              </MenuItem>\n              <MenuItem\n                onClick={() => {\n                     auth.signOut();\n                  db.doc(\"/users/\" + user.uid).set(\n                    { state: \"offline\" },\n                    { merge: true }\n                  );\n                   history.replace(\"/chats\");\n                      setTimeout(() => {\n                       window.location.reload();\n                    }, 1000);\n                }}\n              >\n                <VisibilityOff /> Выйти в оффлайн\n              </MenuItem>\n            </Menu>\n          </div>\n        </div>\n\n        <div className=\"chat__body--container\" ref={chatBodyContainer}>\n          <div className=\"chat__body\" ref={chatBodyRef}>\n            <div\n              className=\"loader__container paginateLoader\"\n              style={{\n                height: !limitReached ? 70 : 30,\n              }}\n            >\n              {paginateLoader && !limitReached ? <CircularProgress /> : null}\n            </div>\n            {messages.map((message, i, messageArr) => {\n              const style = message.imageUrl\n                ? {\n                    marginBottom: !messageArr[i + 1]\n                      ? 0\n                      : message.uid !== messageArr[i + 1].uid\n                      ? 30\n                      : 8,\n                    width: clientWidth * widthRatio + 20,\n                    maxWidth: 320,\n                  }\n                : {\n                    marginBottom: !messageArr[i + 1]\n                      ? 0\n                      : message.uid !== messageArr[i + 1].uid\n                      ? 30\n                      : 8,\n                    width: clientWidth * widthRatio + 20,\n                    maxWidth: 320,\n                  };\n              return (\n                <div\n                  style={style}\n                  ref={\n                    i === messages.length - 1 &&\n                    !(seen && messages[messages.length - 1].uid === user.uid)\n                      ? lastMessageRef\n                      : null\n                  }\n                  key={message.id}\n                  className={`chat__message ${\n                    message.uid === user.uid && \"chat__reciever\"\n                  } ${i === messages.length - 1 ? \"chat__lastMessage\" : \"\"}`}\n                >\n                  <span className=\"chat__name\">{message.name}</span>\n                  {message.imageUrl === \"uploading\" ? (\n                    <div\n                      style={{\n                        width: clientWidth * widthRatio,\n                        height:\n                          message.ratio <= 1\n                            ? clientWidth * widthRatio > 300\n                              ? 300 * message.ratio\n                              : clientWidth * widthRatio * message.ratio\n                            : clientWidth * widthRatio < 300\n                            ? clientWidth * widthRatio\n                            : 300,\n                      }}\n                      className=\"image-container\"\n                    >\n                      <div className=\"image__container--loader\">\n                        <CircularProgress\n                          style={{\n                            width: page.width <= 760 ? 40 : 80,\n                            height: page.width <= 760 ? 40 : 80,\n                          }}\n                        />\n                      </div>\n                    </div>\n                  ) : message.imageUrl ? (\n                    <div\n                      className=\"image-container\"\n                      style={{\n                        width: clientWidth * widthRatio,\n                        height:\n                          message.ratio <= 1\n                            ? clientWidth * widthRatio > 300\n                              ? 300 * message.ratio\n                              : clientWidth * widthRatio * message.ratio\n                            : clientWidth * widthRatio < 300\n                            ? clientWidth * widthRatio\n                            : 300,\n                      }}\n                    >\n                      <Link\n                        to={{\n                          pathname: match.url + \"/image\",\n                          state: state,\n                        }}\n                      >\n                        <img\n                          onClick={(e) =>\n                            clickImagePreview(\n                              e,\n                              message.imageUrl,\n                              message.ratio\n                            )\n                          }\n                          src={message.imageUrl}\n                          alt=\"\"\n                        />\n                      </Link>\n                    </div>\n                  ) : null}\n                  {message.audioName ? (\n                    <AudioPlayer\n                      sender={message.uid === user.uid}\n                      roomID={roomID}\n                      animState={animState}\n                      setAudioID={setAudioID}\n                      audioID={audioID}\n                      id={message.id}\n                      audioUrl={message.audioUrl}\n                      audioPlayed={message.audioPlayed}\n                    />\n                  ) : (\n                    <span className=\"chat__message--message\">\n                      {message.message}\n                    </span>\n                  )}\n                  <span className=\"chat__timestamp\">{message.timestamp}</span>\n                </div>\n              );\n            })}\n            {messages.length > 0 ? (\n              <CSSTransition\n                in={seen && messages[messages.length - 1].uid === user.uid}\n                timeout={200}\n                classNames=\"seen-animate\"\n                appear={true}\n              >\n                <p className=\"seen\">\n                  <p>\n                    <span>\n                      Просмотрено <DoneAllRounded />\n                    </span>\n                  </p>\n                </p>\n              </CSSTransition>\n            ) : null}\n          </div>\n        </div>\n        {src !== \"\" ? (\n          <MediaPreview\n            close={close}\n            mediaPreview={mediaPreview}\n            setSRC={setSRC}\n            setImage={setImage}\n            imageSRC={src}\n          />\n        ) : null}\n\n        <ChatFooter\n          input={input}\n          handleFocus={handleFocus}\n          change={change}\n          sendMessage={sendMessage}\n          setFocus={setFocus}\n          image={image}\n          focus={focus}\n          state={state}\n          token={token}\n          roomID={roomID}\n          setAudioID={setAudioID}\n        />\n        <div></div>\n\n        <CSSTransition\n          in={firstRender && scrollArrow && !sendAnim}\n          classNames=\"scroll\"\n          timeout={310}\n          unmountOnExit\n        >\n          <div\n            className=\"scroll\"\n            onClick={() =>\n              anime({\n                targets: chatBodyContainer.current,\n                scrollTop: chatBodyContainer.current.scrollHeight,\n                duration: 1000,\n                easing: \"linear\",\n              })\n            }\n          >\n            <ArrowDownward\n              style={{\n                width: 22,\n                height: 22,\n                color: \"black\",\n              }}\n            />\n            {unreadMessages ? (\n              <div>\n                <span>{unreadMessages}</span>\n              </div>\n            ) : null}\n          </div>\n        </CSSTransition>\n        {deleting ? (\n          <div className=\"chat__deleting\">\n            <CircularProgress />\n          </div>\n        ) : null}\n      </div>\n      <TransitionGroup component={null}>\n        <Transition\n          timeout={{\n            appear: 310,\n            enter: 310,\n            exit: 410,\n          }}\n          classNames=\"page\"\n          key={location.pathname}\n        >\n          {(animState) => (\n            <Route path={match.url + \"/image\"} location={location}>\n              <ImagePreview imagePreview={imagePreview} animState={animState} />\n            </Route>\n          )}\n        </Transition>\n      </TransitionGroup>\n    </>\n  );\n}\n\nexport default memo(Chat);\n","import {memo} from 'react';\nimport { Button } from '@material-ui/core';\nimport { auth, provider } from './firebase';\nimport './Login.css'\n\nimport YourRole from \"./YourRole\";\n\n\nfunction Login() {\n    const signIn = () => {\n        auth.signInWithRedirect(provider).catch(e => alert(e.message))\n    }\n\n    return (\n        <div className=\"login\">\n             <div className=\"nono\"> <YourRole /></div>\n            <div className=\"login__container\">\n                <img\n                    src=\"/logo.png\"\n                    alt=\"UberClone\"\n                />\n                <div className=\"login__text\">\n                    <h1>Войдите в UberClone</h1>\n                </div>\n\n                <Button onClick={signIn}>\n                    вместе с Гугл\n                </Button>\n            </div>\n        </div>\n    )\n}\n\nexport default memo(Login)","import { useRef, useState } from \"react\";\n\nexport default function useFetchData(limitNumber, get,initCount, snapHandler, name) {\n\tconst limit = useRef(0);\n\tconst dataUnsub = useRef();\n\tconst [data, setData] = useState(null);\n\tconst snapCount = useRef(0);\n\n\treturn [data, function fetchData(setScrollFetch) {\n\t\tif (limit.current || limit.current === 0) {\n            if (limit.current === \"limit attended\") {\n                setScrollFetch(false);\n                limit.current = null;\n            } else {\n                setScrollFetch(true);\n                limit.current = limit.current + limitNumber;\n            };\n            if (dataUnsub.current) {\n                dataUnsub.current();\n            };\n            if (initCount) {\n            \tsnapCount.current = 0;\n            };\n            let timeout = null;\n            const getData = limit.current ? get.limit(limit.current) : get;\n            dataUnsub.current = getData.onSnapshot(snapshot => {\n                snapCount.current++;\n                const s = () => {\n                    const arr = snapHandler(snapshot);\n                    setData(arr);\n                    setScrollFetch(false);\n                    if ((name === \"users\" && arr.length < limit.current - 1) || (name !== \"users\" && arr.length < limit.current)) {\n                        limit.current = \"limit attended\";\n                        fetchData(setScrollFetch)\n                    };\n                };\n                if (snapshot.docs?.length > 0) {\n                    if (snapCount.current >= 2) {\n                    \tif (timeout) {\n                    \t\tclearTimeout(timeout);\n                    \t\ttimeout = null;\n                    \t}\n                    \ts();\n                    } else {\n                    \ttimeout = setTimeout(s, 1500)\n                    };\n                } else if (snapshot.docs?.length === 0) {\n                    setData([]);\n                    setScrollFetch(false);\n                };\n            });\n        };\n        return dataUnsub;\n\t}, setData];\n};","import React, { useState, useEffect, memo, useRef, Suspense } from \"react\";\nimport Sidebar from \"./Sidebar\";\nimport Chat from \"./Chat\";\nimport Login from \"./Login\";\nimport setOnlineStatus from \"./setOnlineStatus\";\nimport { Route, useLocation, Redirect } from \"react-router-dom\";\nimport { useStateValue } from \"./StateProvider\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport db, { auth, provider, createTimestamp, messaging } from \"./firebase\";\nimport {\n  TransitionGroup,\n  Transition,\n  CSSTransition,\n} from \"react-transition-group\";\nimport \"./App.css\";\nimport useRoomsData from \"./useRoomsData\";\nimport scalePage from \"./scalePage\";\nimport useFetchData from \"./useFetchData.js\";\n//import DestinationSearch from \"./DestinationSearch\";\nconst DestinationSearch = React.lazy(() => import(\"./DestinationSearch\"));\nlocalStorage.setItem(\"gps\", \"47.6758555, 38.0625965\");\nlocalStorage.setItem(\"gps_sum\", \"85\");\nlocalStorage.setItem(\"lng\", \"38.0625965\");\nlocalStorage.setItem(\"lat\", \"47.6758555\");\n\nnavigator.geolocation.getCurrentPosition(function (position) {\n  // Текущие координаты.\n  var lat = position.coords.latitude;\n  var lng = position.coords.longitude;\n  var gpska = lat + \", \" + lng;\n  var gps_suma = lat + lng;\n\n  localStorage.setItem(\"lat\", lat);\n  localStorage.setItem(\"lng\", lng);\n  localStorage.setItem(\"gps\", gpska);\n  localStorage.setItem(\"gps_sum\", gps_suma);\n  let accuracy = position.coords.accuracy;\n  localStorage.setItem(\"accuracy\", accuracy);\n  //console.log(\"lat доступна \" + lat); // Геолокация доступна\n  //console.log(\"lng доступна \" + lng); // Геолокация доступна\n  //console.log(\"accuracy доступна \" + accuracy); // Погрешность\n  // console.log(\"Cумма координат \" + gps_suma); // Погрешность\n  //\t  setGps_sum(gps_suma);\n  //  setGps_ka(gpska);\n});\n\nconst configureNotif = (docID) => {\n  messaging\n    .requestPermission()\n    .then(() => {\n      //console.log('permission granted');\n      return messaging.getToken();\n    })\n    .then((token) => {\n      //console.log(token);\n      db.collection(\"users\").doc(docID).set(\n        {\n          token: token,\n        },\n        { merge: true }\n      );\n    })\n    .catch((e) => {\n      //console.log(e.message);\n      db.collection(\"users\").doc(docID).set(\n        {\n          token: \"\",\n        },\n        { merge: true }\n      );\n    });\n};\n\nfunction App() {\n  const [{ user, path, pathID, roomsData, page }, dispatch, actionTypes] =\n    useStateValue();\n  const [loader, setLoader] = useState(true);\n  const [pwaEvent, setPwaEvent] = useState(undefined);\n  const [updating, setUpdating] = useState(false);\n  const [checkingVersion, setCheckingVerison] = useState(true);\n  const [chats, setChats] = useState(null);\n  const [chatsFetched, setChatsFetched] = useState();\n  const location = useLocation();\n  const [setRoomsData] = useRoomsData();\n  const b = useRef([]);\n  const menus = [\"/rooms\", \"/search\", \"/users\", \"/chats\"];\n\n  const [rooms, fetchRooms] = useFetchData(\n    30,\n    db.collection(\"rooms\").orderBy(\"timestamp\", \"desc\"),\n    true,\n    (snap) => {\n      return snap.docs.map((doc) => ({\n        id: doc.id,\n        ...doc.data(),\n      }));\n    },\n    \"rooms\"\n  );\n\n  const [users, fetchUsers] = useFetchData(\n    30,\n    db\n      .collection(\"users\")\n      // .orderBy(\"coord_sum\", \"desc\")\n      //.find({coord_sum: \"85.7360078\"})\n   //   .where('coord_sum', '==',  localStorage.getItem(\"gps_sum\").substring(4, -4))\n       .where('state', '==',  'online')\n      ,\n    /*  .where({\n        coord_sum: localStorage.getItem(\"gps_sum\").substring(4, -4),\n        state: 'online'\n      }),*/\n    // .orderBy(\"timestamp\", \"desc\")\n    //.where('coord_sum',\n    //  .isEqualTo(\"85.7360078\")\n    //.where('role', '==', 'Пассажир')\n    // db.collection(\"users\").orderBy(\"timestamp\", \"desc\").where('role', '==', 'Пассажир'),\n    true,\n    (snap) => {\n      const data = [];\n      if (snap.docs.length > 0) {\n        snap.docs.forEach((doc) => {\n          const id = doc.id > user.uid ? doc.id + user.uid : user.uid + doc.id;\n          if (doc.id !== user.uid) {\n            data.push({\n              ...doc.data(),\n              id,\n              userID: doc.id,\n            });\n            setRoomsData(doc.id, id);\n          }\n        });\n      }\n      return data;\n    },\n    \"users\"\n  );\n  console.log(users);\n  useEffect(() => {\n    auth.onAuthStateChanged((authUser) => {\n      //console.log(\"user change: \", authUser)\n      if (authUser) {\n        dispatch({ type: actionTypes.SET_USER, user: authUser });\n        setLoader(false);\n        if (\"serviceWorker\" in navigator && \"PushManager\" in window) {\n          //console.log(\"This browser supports notifications and service workers\")\n          configureNotif(authUser.uid);\n        }\n        //console.log(authUser);\n        /*    db.collection(\"version\").doc(\"version\").get().then(doc => {\n          const version = doc.data().version;\n          const previousVersion = localStorage.getItem(\"version\");\n          if (previousVersion) {\n            //console.log(\"previous version exists in local storage\")\n            if (version !== +previousVersion) {\n              //console.log(\"new version is not equal to previous version\")\n              localStorage.setItem(\"version\", version);\n              setUpdating(true);\n              auth.signOut();\n              auth.signInWithRedirect(provider).catch(e => alert(e.message))\n            } else {\n              setCheckingVerison(false)\n            }\n          } else {\n            //console.log(\"previous version doesn't exists in local storage\")\n            localStorage.setItem(\"version\", version);\n            setCheckingVerison(false)\n          }\n        });*/\n        const ref = db.collection(\"users\").doc(authUser.uid);\n        ref.get().then((doc) => {\n          const data = doc.data();\n          if (data) {\n            if (data.timestamp) {\n              //console.log(\"updating user\")\n              return ref.set(\n                {\n                  name: authUser.displayName,\n                  photoURL: authUser.photoURL,\n                  about: \"\",\n                  phone: \"\",\n                  role: localStorage.getItem(\"role\"),\n                  searchrole: localStorage.getItem(\"searchrole\"),\n                },\n                { merge: true }\n              );\n            }\n          }\n          //console.log(\"setting user\")\n          return ref.set(\n            {\n              name: authUser.displayName,\n              photoURL: authUser.photoURL,\n              timestamp: createTimestamp(),\n              about: \"\",\n              phone: \"\",\n              role: localStorage.getItem(\"role\"),\n              searchrole: localStorage.getItem(\"searchrole\"),\n            },\n            { merge: true }\n          );\n        });\n      } else {\n        dispatch({ type: actionTypes.SET_USER, user: null });\n        //console.log(user);\n        /*  setLoader(false);\n        db.collection(\"version\").doc(\"version\").get().then(doc => {\n          const version = doc.data().version;\n          const previousVersion = localStorage.getItem(\"version\");\n          if (previousVersion) {\n            //console.log(\"previous version exists in local storage\")\n            if (version !== +previousVersion) {\n              //console.log(\"new version is not equal to previous version\")\n              localStorage.setItem(\"version\", version);\n              setCheckingVerison(false)\n            } else {\n              setCheckingVerison(false)\n            }\n          } else {\n            //console.log(\"previous version doesn't exists in local storage\")\n            localStorage.setItem(\"version\", version);\n            setCheckingVerison(false)\n          }\n        })*/\n      }\n    });\n  }, []);\n\n  useEffect(() => {\n    window.addEventListener(\"beforeinstallprompt\", (e) => {\n      // Prevent the mini-infobar from appearing on mobile\n      //console.log(\"pwa event executed\");\n      e.preventDefault();\n      // Stash the event so it can be triggered later.\n      setPwaEvent(e);\n      // Update UI notify the user they can install the PWA\n    });\n    window.addEventListener(\"resize\", () => {\n      dispatch({ type: \"set_scale_page\", page: scalePage() });\n    });\n  }, []);\n\n  useEffect(() => {\n    if (user) {\n      db.collection(\"users\")\n        .doc(user.uid)\n        .collection(\"chats\")\n        .orderBy(\"timestamp\", \"desc\")\n        .onSnapshot({ includeMetadataChanges: true }, (snap) => {\n          if (snap.docs?.length > 0) {\n            snap.docChanges().forEach((change) => {\n              if (change.type === \"added\") {\n                setRoomsData(change.doc.data().userID, change.doc.id);\n              }\n            });\n            if (\n              !snap.metadata.fromCache ||\n              (!window.navigator.onLine && snap.metadata.fromCache)\n            ) {\n              setChats(\n                snap.docs.map((cur) => ({\n                  ...cur.data(),\n                  id: cur.id,\n                }))\n              );\n            }\n          } else {\n            setChats([]);\n          }\n        });\n      fetchRooms(() => null);\n      fetchUsers(() => null);\n    }\n  }, [user]);\n\n  useEffect(() => {\n    if (chats?.length > 0) {\n      if (chats.every((cur) => roomsData[cur.id]?.lastMessage)) {\n        setChatsFetched(true);\n      }\n    } else if (chats?.length === 0) {\n      setChatsFetched(true);\n    }\n  }, [chats, roomsData]);\n\n  useEffect(() => {\n    var s;\n    if (user) {\n      setOnlineStatus(user.uid);\n    }\n    return () => {\n      if (s) {\n        s();\n      }\n    };\n  }, [user]);\n\n  useEffect(() => {\n    var id = location.pathname.replace(\"/room/\", \"\");\n    menus.forEach((cur) => (id = id.replace(cur, \"\")));\n    dispatch({ type: \"set_path_id\", id });\n  }, [location.pathname]);\n\n  return (\n    <div className=\"app\">\n      {page.width <= 760 ? <Redirect to=\"/chats\" /> : <Redirect to=\"/\" />}\n      {!user && loader && !updating ? (\n        <Login />\n      ) : user && !updating && chatsFetched ? (\n        <div className=\"app__body\">\n          <Sidebar\n            chats={chats}\n            pwa={pwaEvent}\n            rooms={rooms}\n            fetchRooms={fetchRooms}\n            users={users}\n            fetchUsers={fetchUsers}\n          />\n          <Suspense fallback={<div>Загрузка...</div>}>\n            <DestinationSearch users={users} fetchUsers={fetchUsers} />\n          </Suspense>\n\n          <TransitionGroup component={null}>\n            {page.width <= 760 ? (\n              <Transition\n                key={location.pathname.replace(\"/image\", \"\")}\n                timeout={260}\n              >\n                {(state) => (\n                  <Route location={location} path={`${path}/room/:roomID`}>\n                    <Chat\n                      b={b}\n                      unreadMessages={\n                        chats?.length > 0\n                          ? chats.find((cur) => cur.id === pathID)\n                              ?.unreadMessages\n                          : 0\n                      }\n                      animState={state}\n                    />\n                  </Route>\n                )}\n              </Transition>\n            ) : (\n              <CSSTransition\n                key={location.pathname.replace(\"/image\", \"\")}\n                timeout={1010}\n                classNames=\"page\"\n              >\n                {(state) => (\n                  <Route location={location} path={`${path}/room/:roomID`}>\n                    <Chat\n                      b={b}\n                      unreadMessages={\n                        chats?.length > 0\n                          ? chats.find((cur) => cur.id === pathID)\n                              ?.unreadMessages\n                          : 0\n                      }\n                      animState={state}\n                    />\n                  </Route>\n                )}\n              </CSSTransition>\n            )}\n          </TransitionGroup>\n        </div>\n      ) : (\n        <div className=\"loader__container\">\n          <CircularProgress />\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default memo(App);\n","import {useEffect, useRef} from \"react\";\nimport { useStateValue } from \"./StateProvider\";\nimport db from \"./firebase\";\n\nexport default function useRoomsData() {\n    const [{ roomsData: initRoomsData }, dispatch] = useStateValue();\n    const roomsData = useRef(initRoomsData)\n\n    useEffect(() => {\n        roomsData.current = initRoomsData;\n    }, [initRoomsData])\n    \n    return [function setRoomsData(userID, roomID) {\n        if (!roomsData.current[roomID]) {\n            const lastMessageListener = db.collection(\"rooms\").doc(roomID).onSnapshot(doc => {\n                //console.log(\"last message listener executed with room id: \", roomID)\n                dispatch({\n                    type: \"update_rooms_data\",\n                    dataType: \"lastMessage\",\n                    data: doc.data()?.lastMessage,\n                    roomID\n                });\n            });\n            const onlineStateListener = db.collection(\"users\").doc(userID).onSnapshot(doc => {\n                //console.log(\"onlineState listener executed with room id: \", roomID)\n                dispatch({\n                    type: \"update_rooms_data\",\n                    dataType: \"onlineState\",\n                    data: doc.data()?.state,\n                    roomID\n                });\n            });\n            dispatch({\n                type: \"add_rooms_data\",\n                roomID,\n                lastMessageListener: lastMessageListener,\n                onlineStatelistener: onlineStateListener \n            });\n        };\n    }];\n};","import db, { createTimestamp, createTimestamp2, db2 } from \"./firebase\";\n\nexport default function setOnlineStatus(uid) {\n  try {\n    //const [gps_sum, setGps_sum] = useState(null);\n    //\tconst [gps, setGps_ka] = useState(null);\n  console.log( localStorage.getItem(\"gps_sum\").substring(4, -4));\n  console.log( localStorage.getItem(\"gps_sum\"));\n    const isOfflineForDatabase = {\n      state: \"offline\",\n      last_changed: createTimestamp2,\n      id: uid,\n      latitude: localStorage.getItem(\"lat\"),\n      longitude: localStorage.getItem(\"lng\"),\n      coord: localStorage.getItem(\"gps\"),\n      coord_sum: localStorage.getItem(\"gps_sum\").substring(4, -4),\n      role:localStorage.getItem(\"role\"),\n      searchrole:localStorage.getItem(\"searchrole\"),\n    \n    };\n\n    const isOnlineForDatabase = {\n      state: \"online\",\n      last_changed: createTimestamp2,\n      id: uid,\n      latitude: localStorage.getItem(\"lat\"),\n      longitude: localStorage.getItem(\"lng\"),\n      coord: localStorage.getItem(\"gps\"),\n      coord_sum: localStorage.getItem(\"gps_sum\").substring(4, -4),\n      role:localStorage.getItem(\"role\"),\n      searchrole:localStorage.getItem(\"searchrole\"),\n    };\n    const userStatusFirestoreRef = db.doc(\"/users/\" + uid);\n    const userStatusDatabaseRef = db2.ref(\"/status/\" + uid);\n\n    // Firestore uses a different server timestamp value, so we'll\n    // create two more constants for Firestore state.\n    const isOfflineForFirestore = {\n      state: \"offline\",\n      last_changed: createTimestamp(),\n      latitude: localStorage.getItem(\"lat\"),\n      longitude: localStorage.getItem(\"lng\"),\n      coord: localStorage.getItem(\"gps\"),\n      coord_sum: localStorage.getItem(\"gps_sum\").substring(4, -4),\n      role:localStorage.getItem(\"role\"),\n      searchrole:localStorage.getItem(\"searchrole\"),\n    };\n\n    const isOnlineForFirestore = {\n      state: \"online\",\n      last_changed: createTimestamp(),\n      latitude: localStorage.getItem(\"lat\"),\n      longitude: localStorage.getItem(\"lng\"),\n      coord: localStorage.getItem(\"gps\"),\n      coord_sum: localStorage.getItem(\"gps_sum\").substring(4, -4),\n      role:localStorage.getItem(\"role\"),\n      searchrole:localStorage.getItem(\"searchrole\"),\n    };\n\n    db2.ref(\".info/connected\").on(\"value\", function (snapshot) {\n      if (snapshot.val() === false) {\n        // Instead of simply returning, we'll also set Firestore's state\n        // to 'offline'. This ensures that our Firestore cache is aware\n        // of the switch to 'offline.'\n        userStatusFirestoreRef.set(isOfflineForFirestore, { merge: true });\n        return;\n      }\n\n      userStatusDatabaseRef\n        .onDisconnect()\n        .set(isOfflineForDatabase)\n        .then(function () {\n          userStatusDatabaseRef.set(isOnlineForDatabase);\n\n          // We'll also add Firestore set here for when we come online.\n          userStatusFirestoreRef.set(isOnlineForFirestore, { merge: true });\n        });\n    });\n  } catch (error) {\n    console.log(\"error setting onlins status: \", error);\n  }\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://cra.link/PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://cra.link/PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://cra.link/PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log('No internet connection found. App is running in offline mode.');\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorkerRegistration from './serviceWorkerRegistration';\nimport { StateProvider } from './StateProvider';\nimport reducer, { initialState } from \"./reducer\"\nimport { BrowserRouter as Router } from \"react-router-dom\"\n\nif (navigator.mediaDevices === undefined) {\n  navigator.mediaDevices = {};\n}\nif (navigator.mediaDevices.getUserMedia === undefined) {\n  navigator.mediaDevices.getUserMedia = function(constraints) {\n    var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\n    if (!getUserMedia) {\n      return Promise.reject(new Error('getUserMedia is not implemented in this browser'));\n    }\n    return new Promise(function(resolve, reject) {\n      getUserMedia.call(navigator, constraints, resolve, reject);\n    });\n  }\n}\n\n\nReactDOM.render(\n  <React.StrictMode>\n    <Router>\n      <StateProvider initialState={initialState} reducer={reducer}>\n        <App />\n      </StateProvider>\n    </Router>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://cra.link/PWA\nserviceWorkerRegistration.register();\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n//reportWebVitals();\n","import {createContext, useReducer, useContext} from \"react\";\nimport { actionTypes } from './reducer'\n\nexport const StateContext = createContext();\n\nexport const StateProvider = ({ reducer, initialState, children}) => (\n    <StateContext.Provider value={[...useReducer(reducer, initialState), actionTypes]}>\n        {children}\n    </StateContext.Provider>\n);\n\nexport const useStateValue = () => useContext(StateContext);","import firebase from \"firebase/app\";\nimport \"firebase/auth\";\nimport \"firebase/firestore\";\nimport \"firebase/database\"\nimport \"firebase/messaging\";\nimport \"firebase/storage\"\n\nconst firebaseConfig = { \n\napiKey: \"AIzaSyBEEA2tvNgeHIYxDRJgkxDfZIBguDnybPc\",\n  authDomain: \"whatsapp2-a5f92.firebaseapp.com\",\n  databaseURL: \"https://whatsapp2-a5f92-default-rtdb.firebaseio.com\",\n  projectId: \"whatsapp2-a5f92\",\n  storageBucket: \"whatsapp2-a5f92.appspot.com\",\n  messagingSenderId: \"1023177696506\",\n  appId: \"1:1023177696506:web:a180739d1dd334d1f7d543\",\n  measurementId: \"G-XG4H351X5E\"\n};/*use your own configuration*/ \n\nconst firebaseApp = firebase.initializeApp(firebaseConfig);\n/*you can enable persistence to allow the user to see previous data when he's offline but it will make your queries very slow which leads\nto bad user experience so I suggest you implement your own offline support by caching the data and retrieving them when the user is offline*/\n//firebaseApp.firestore().enablePersistence();\nconst db = firebaseApp.firestore();\nconst db2 = firebaseApp.database();\nconst auth = firebaseApp.auth();\nconst provider = new firebase.auth.GoogleAuthProvider();\nconst createTimestamp = firebase.firestore.FieldValue.serverTimestamp;\nconst createTimestamp2 = firebase.database.ServerValue.TIMESTAMP;\nconst messaging = \"serviceWorker\" in navigator && \"PushManager\" in window ?  firebase.messaging() : null;\nconst fieldIncrement = firebase.firestore.FieldValue.increment;\nconst arrayUnion = firebase.firestore.FieldValue.arrayUnion;\nconst storage = firebase.storage().ref(\"images\");\n\nconst storage1 = firebase.storage();\nconst audioStorage = firebase.storage().ref(\"audios\");\n\n//db.disableNetwork();\n\nexport { auth , provider, createTimestamp, messaging, fieldIncrement, arrayUnion, storage, storage1, audioStorage, db2, createTimestamp2};\nexport default db;\n","import scalePage from \"./scalePage\";\n\nexport const initialState = {\n    user: null,\n    path: \"\",\n    pathID: \"\",\n    dispatchMessages: {},\n    audioID: null,\n    roomsData: {},\n    page: scalePage()\n}\n\nexport const  actionTypes = {\n    SET_USER: \"SET_USER\",\n    SET_MESSAGES : \"SET_MESSAGES\",\n}\n\nconst reducer = (state, action) => {\n    //console.log(action)\n    switch (action.type) {\n        case \"set_scale_page\" :\n            return {\n                ...state,\n                page: action.page\n            }\n        case actionTypes.SET_USER :\n            return {\n                ...state,\n                user: action.user\n            }\n        case \"SET_PATH\" :\n            return {\n                ...state,\n                path: action.path\n            }\n        case \"set_path_id\" :\n            return {\n                ...state,\n                pathID: action.id\n            }\n        case actionTypes.SET_MESSAGES :\n            const dispatchMessages = state.dispatchMessages;\n            //console.log(\"dispatch messages: \", dispatchMessages[action.id]);\n            //console.log(\"action messages: \", action.messages);\n            if (action.update) {\n                //console.log(\"updating\");\n                if (dispatchMessages[action.id].messages) {\n                    //console.log(\"messages exist\")\n                    if (dispatchMessages[action.id].messages.length === 0) {\n                        //console.log(\"messages length is 0\");\n                        if (action.messages.length > 0) {\n                            //console.log(\"action messages length greater than 0\");\n                            dispatchMessages[action.id] = {\n                                messages: action.messages, \n                                limitReached: dispatchMessages[action.id].limitReached,\n                                firstMessageID: dispatchMessages[action.id].firstMessageID,\n                                audio: state.pathID === action.id,\n                            };\n                        }  \n                    } else if (dispatchMessages[action.id].messages.length > 0 && action.messages.length === 0) {\n                        //console.log(\"messages were deleted\");\n                        dispatchMessages[action.id] = {\n                            messages: [], \n                            limitReached: true,\n                            firstMessageID: undefined,\n                            audio: false,\n                        };\n                    } else {\n                        const s = dispatchMessages[action.id].messages.length - action.messages.length;\n                        var isSame = s === 0 ? false : true;\n                        if (s >= 0) {\n                            //console.log(\"difference greater or equal than 0\");\n                            for (var i = 0; i < action.messages.length - 2; i++) {\n                                //console.log(\"iterating at: \", i);\n                                //console.log(\"action message: \", action.messages[i]);\n                                //console.log(\"dispatch message: \", dispatchMessages[action.id].messages[s + i + 1]);\n                                isSame = action.messages[i].id === dispatchMessages[action.id].messages[s + i + 1].id;\n                                if (!isSame) {\n                                    //console.log(\"it's not the same\");\n                                    break;\n                                }\n                            }\n                        } else {\n                            //console.log(\"difference is less than 0\");\n                            for (i = 0; i < dispatchMessages[action.id].messages.length - 2; i++) {\n                                isSame = action.messages[i].id === dispatchMessages[action.id].messages[i].id;\n                                if (!isSame) {\n                                    //console.log(\"it's not the same\");\n                                    break;\n                                };\n                            };\n                        };\n                        if (isSame) {\n                            //console.log(\"it's the same\");\n                            //console.log(\"last action message: \", action.messages[action.messages.length - 1]);\n                            //console.log(\"s: \", s);\n                            var arr;\n                            if (s >= 0) {\n                                //console.log(\"sliced: \", dispatchMessages[action.id].messages.slice(0, s + 1));\n                                arr = [...dispatchMessages[action.id].messages.slice(0, s + 1), ...action.messages];\n                            } else {\n                                //console.log(\"sliced: \", dispatchMessages[action.id].messages.slice(0, -s + 1));\n                                arr = [...action.messages]; \n                            }\n                            dispatchMessages[action.id] = {\n                                messages: arr, \n                                limitReached: dispatchMessages[action.id].limitReached,\n                                firstMessageID: dispatchMessages[action.id].firstMessageID,\n                                audio: state.pathID === action.id && isSame,\n                            };\n                        };\n                    };\n                };\n                //console.log(\"returned dispatchMessages from updating: \", dispatchMessages[action.id]);\n                return {\n                    ...state,\n                    dispatchMessages,\n                };\n            };\n            //console.log(\"not updating\");\n            dispatchMessages[action.id] = {\n                messages: action.messages, \n                limitReached: dispatchMessages[action.id].firstMessageID === \"no id\" ? true : action.messages[0]?.id === dispatchMessages[action.id].firstMessageID,\n                firstMessageID: dispatchMessages[action.id].firstMessageID,\n                audio: false\n            }\n            return {\n                ...state,\n                dispatchMessages\n            }\n        case \"set_audio_false\" : \n            const newMessages = state.dispatchMessages;\n            newMessages[action.id] = {\n                ...newMessages[action.id],\n                audio: false\n            };\n            return {\n                ...state,\n                dispatchMessages: newMessages\n            };\n        case \"set_firstMessage\" :\n            const s = state.dispatchMessages;\n            if (s[action.id]) {\n                s[action.id].firstMessageID = action.firstMessageID;\n            } else {\n                s[action.id] = {\n                    firstMessageID: action.firstMessageID\n                };\n            };\n            return {\n                ...state,\n                dispatchMessages: s\n            };\n        case \"update_media\" :\n            const f = state.dispatchMessages;\n            const updatedMessages = f[action.roomID].messages;\n            const e = updatedMessages.findIndex(cur => cur.id === action.id);\n            updatedMessages[e] = {\n                ...updatedMessages[e],\n                ...action.data\n            };\n            //console.log(\"updated media: \", f[action.roomID]);\n            f[action.roomID] = {\n                messages: updatedMessages, \n                limitReached: f[action.roomID].limitReached,\n                firstMessageID: f[action.roomID].firstMessageID\n            }\n            return {\n                ...state,\n                dispatchMessages: f,\n            }\n        case \"add_rooms_data\" :\n            const newRoomsData = {...state.roomsData};\n            //console.log(\"rooms data: \", state.roomsData);\n            newRoomsData[action.roomID] = {\n                lastMessageListener: action.lastMessageListener,\n                onlineStatelistener: action.onlineStatelistener,\n                roomID: action.roomID\n            }\n            return {\n                ...state,\n                roomsData: newRoomsData\n            }\n        case \"update_rooms_data\" :\n            const roomsData = {...state.roomsData};\n            //console.log(\"rooms data: \", state.roomsData);\n            if (action.data !== roomsData[action.roomID][action.dataType]) {\n                roomsData[action.roomID] = {\n                    ...roomsData[action.roomID],\n                    [action.dataType] : action.data\n                }\n                return {\n                    ...state,\n                    roomsData: roomsData\n                }\n            }\n            return state;\n        default: \n            return state;\n    }\n}\n\nexport default reducer;","export default function scalePage() {\n    if (window.innerHeight > 768 && window.innerWidth > 1366) {\n        const currentRatio = window.innerHeight / window.innerWidth;\n        const ratio = 768 / 1366;\n        if (ratio < currentRatio) {\n            return {\n                width: 1366,\n                height: window.innerHeight * (1366 / window.innerWidth),\n                transform: `scale(${window.innerWidth / 1366})`\n            };\n        } else if (ratio > currentRatio) {\n            return {\n                width: window.innerWidth * (768 / window.innerHeight),\n                height: 768,\n                transform: `scale(${window.innerHeight / 768})`\n            };\n        } else {\n            return {\n                width: 1366,\n                height: 768,\n                transform: `scale(${window.innerHeight / 768})`\n            };\n        };\n    };\n    return {\n        width: window.innerWidth,\n        height: window.innerHeight,\n        transform: `scale(1)`\n    };\n};","import React from 'react';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\n\nfunction DropdownMenu ( { menuLists, menu, handleMenuClose }) {\n    return (\n        <div>\n      {/*  <p style={{fontSize:'10px'}}> DropdownMenu.js</p>*/}\n            <Menu id=\"simple-menu\"\n                anchorEl={menu}\n                keepMounted\n                open={Boolean(menu)}\n                onClose={handleMenuClose}\n                anchorOrigin={{\n                    vertical: \"bottom\",\n                    horizontal: \"right\"\n                }}\n                transformOrigin={{\n                    vertical: \"top\",\n                    horizontal: \"right\"\n                }}\n                getContentAnchorEl={null}\n                >\n                \n                {menuLists.map((menuList) =>\n                    <MenuItem key={menuList.id} onClick={menuList.onClick}>\n                        {menuList.title}\n                    </MenuItem> \n                )}\n            </Menu>\n        </div>\n    )\n}\n\nexport default DropdownMenu","import { toast } from 'react-toastify';\n\nexport const toastInfo = ( toastTitle, toastId, position ) => {\n    toast.info(toastTitle, {\n        toastId: toastId,\n        position: position,\n        autoClose: 5000,\n        hideProgressBar: true,\n        closeOnClick: true,\n        pauseOnHover: true,\n        draggable: true,\n        progress: undefined,\n        }\n    );\n}","import React from 'react';\n// import ReactPlayer from 'react-player';\n//importing material-ui\nimport Zoom from '@material-ui/core/Zoom';\nimport Avatar from '@material-ui/core/Avatar';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport IconButton from '@material-ui/core/IconButton';\n//importing material-ui-icons\nimport CloseIcon from '@material-ui/icons/Close';\n//importing styles\nimport './DialogCustom.css'\n\nfunction DialogCustom({ open, close, user, photo }) {\n    \n    return (\n        <Dialog\n            open={open}\n            fullScreen \n            onClose={close}\n            aria-labelledby=\"alert-dialog-title\"\n            aria-describedby=\"alert-dialog-description\"\n            >\n                \n         {/*   <p style={{fontSize:'10px'}}> DialogCustom.js</p>*/}\n            <DialogTitle id=\"alert-dialog-title-dialogCustom\">\n                <div>\n                    <Avatar src={user.photoURL}/>\n                </div>\n                <div>\n                    <IconButton edge=\"end\" color=\"inherit\" onClick={close} aria-label=\"close\">\n                        <CloseIcon />\n                    </IconButton>\n                </div>\n            </DialogTitle>\n            <DialogContent>\n                <Zoom in={open} style={{ transitionDelay: open ? '300ms' : '0ms' }}>\n                    <img src={photo} alt=\"\" className=\"DialogCustom__photo\"/>\n                </Zoom>\n            </DialogContent>\n        </Dialog>\n    )\n}\n\nexport default DialogCustom\n","import React, { useEffect, useState } from \"react\";\nimport { useStateValue } from \"./StateProvider\";\n//importing components\nimport DropdownMenu from \"./DropdownMenu\";\nimport { toastInfo } from \"./toastInfo\";\nimport DialogCustom from \"./DialogCustom\";\n//importing material-ui\nimport Zoom from \"@material-ui/core/Zoom\";\nimport Drawer from \"@material-ui/core/Drawer\";\nimport Avatar from \"@material-ui/core/Avatar\";\nimport Dialog from \"@material-ui/core/Dialog\";\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\nimport DialogContent from \"@material-ui/core/DialogContent\";\nimport DialogActions from \"@material-ui/core/DialogActions\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport { makeStyles } from \"@material-ui/core/styles\";\n//importing material-ui-icons\nimport PhotoCameraIcon from \"@material-ui/icons/PhotoCamera\";\nimport ArrowBackIcon from \"@material-ui/icons/ArrowBack\";\nimport EditIcon from \"@material-ui/icons/Edit\";\nimport CheckIcon from \"@material-ui/icons/Check\";\n//importing styles\nimport \"./DrawerLeft.css\";\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: \"flex\",\n  },\n  drawerPaper: {\n    position: \"absolute\",\n  },\n}));\n\nfunction DrawerLeft({ drawerLeft, setDrawerLeft, db, auth, storage }) {\n  const classes = useStyles();\n  const [{ user }] = useStateValue();\n  const [name, setName] = useState(\"\");\n  const [about, setAbout] = useState(\"\");\n  const [phone, setPhone] = useState(\"\");\n  const [showEditName, setShowEditName] = useState(false);\n  const [showEditAbout, setShowEditAbout] = useState(false);\n  const [showEditPhone, setShowEditPhone] = useState(false);\n  const [showProfilePhoto, setShowProfilePhoto] = useState(false);\n  const [uploadPhotoLink, setUploadPhotoLink] = useState(null);\n  const [showDialogUpload, setShowDialogUpload] = useState(false);\n  const [menuProfile, setMenuProfile] = useState(null);\n  const [photo, setPhoto] = useState(\"\");\n\n  useEffect(() => {\n    setName(user.displayName);\n\n    db.collection(\"users\")\n      .doc(user.uid)\n      .onSnapshot(function (doc) {\n        setPhoto(doc.data()?.photoURL);\n        setAbout(doc.data()?.about);\n        setPhone(doc.data()?.phone);\n      });\n  }, [user.uid, user.displayName, db]);\n\n  const updateName = (e) => {\n    e.preventDefault();\n\n    if (user.uid) {\n      db.collection(\"users\")\n        .doc(user.uid)\n        .update({\n          name: name,\n        })\n        .then(function () {\n          console.log(\"Обновлено!\");\n        })\n        .catch(function (error) {\n          // The document probably doesn't exist.\n          console.error(\"Не удалось обновить: \", error);\n        });\n\n      auth.currentUser.updateProfile({\n        displayName: name,\n      });\n    }\n    setShowEditName(false);\n  };\n\n  const updateAbout = (e) => {\n    e.preventDefault();\n\n    if (user.uid) {\n      db.collection(\"users\") \n        .doc(user.uid)\n        .update({\n          about: about,\n        })\n        .then(function () {\n          console.log(\"Обновлено!\");\n        })\n        .catch(function (error) {\n          // The document probably doesn't exist.\n          console.error(\"Не получилось обновить: \", error);\n        });\n    }\n    setShowEditAbout(false);\n  };\n\n  const updatePhone = (e) => {\n    e.preventDefault();\n\n    if (user.uid) {\n      db.collection(\"users\") \n        .doc(user.uid)\n        .update({\n          phone: phone,\n        })\n        .then(function () {\n          console.log(\"Обновлено phone!\");\n        })\n        .catch(function (error) {\n          // The document probably doesn't exist.\n          console.error(\"Не получилось обновить phone: \", error);\n        });\n    }\n    setShowEditPhone(false);\n  };\n\n  const editName = () => {\n    setShowEditName(true);\n  };\n\n  const editAbout = () => {\n    setShowEditAbout(true);\n  };\n\n  const editPhone = () => {\n    setShowEditPhone(true);\n  };\n\n  const handleDrawerClose = () => {\n    setDrawerLeft(false);\n    setShowEditName(false);\n    setShowEditAbout(false);\n    setShowEditPhone(false);\n  };\n\n  const viewPhoto = () => {\n    const viewPhoto = \"viewPhoto\";\n\n    if (user) {\n      setShowProfilePhoto(true);\n    } else {\n      toastInfo(\"Нет фото!\", viewPhoto, \"top-center\");\n    }\n    setMenuProfile(null);\n  };\n\n  const viewPhotoClose = () => {\n    setShowProfilePhoto(false);\n  };\n\n  const takePhoto = () => {\n    const takePhoto = \"takePhoto\";\n    toastInfo(\"Выбранное фото больше недоступно!\", takePhoto, \"top-center\");\n  };\n\n  const removedPhoto = () => {\n    const removedPhoto = \"removedPhoto\";\n    toastInfo(\n      \"Удаленное фото больше не доступно!\",\n      removedPhoto,\n      \"top-center\"\n    );\n  };\n\n  const onFileChangeImage = async (e) => {\n    const imageFileSizeToastId = \"imageFileSizeToastId\";\n    const file = e.target.files[0];\n\n    if (file.size > 3 * 1024 * 1024) {\n      toastInfo(\n        \"Фотка не должна быть больше 3Mb\",\n        imageFileSizeToastId,\n        \"top-center\"\n      );\n    } else {\n      const storageRef = storage.ref();\n      if (user.isAnonymous === true) {\n        const imagesRef = storageRef.child(`user/anonymous/${user.uid}`);\n        const fileRef = imagesRef.child(file.name);\n        await fileRef.put(file);\n        setUploadPhotoLink(await fileRef.getDownloadURL());\n        console.log(\"uploading image\", uploadPhotoLink);\n      } else {\n        const imagesRef = storageRef.child(`user/regular/${user.uid}`);\n        const fileRef = imagesRef.child(file.name);\n        await fileRef.put(file);\n        setUploadPhotoLink(await fileRef.getDownloadURL());\n        console.log(\"uploading image\", uploadPhotoLink);\n      }\n    }\n    setMenuProfile(null);\n    setShowDialogUpload(true);\n  };\n\n  const uploadPhoto = () => {\n    return (\n      <div className=\"profileMenu_uploadPhoto\">\n\n    {/*    <span style={{fontSize:'10px'}}> uploadPhoto.js</span>*/}\n        <label htmlFor=\"file-input\">Загрузить фото</label>\n        <input\n          id=\"file-input\"\n          type=\"file\"\n          onChange={onFileChangeImage}\n          accept=\"image/*\"\n        />\n      </div>\n    );\n  };\n\n  const handleUploadPhoto = () => {\n    const uploadPhotoError = \"uploadPhotoError\";\n\n    if (uploadPhotoLink) {\n      auth.currentUser.updateProfile({\n        photoURL: uploadPhotoLink,\n      });\n      db.collection(\"rooms\").doc(user.uid).set(\n        {\n          photoURL: uploadPhotoLink,\n        },\n        { merge: true }\n      );\n      setShowDialogUpload(false);\n    } else {\n      toastInfo(\"Select photo to upload!\", uploadPhotoError, \"top-center\");\n    }\n  };\n\n  const handleDialogUploadClose = () => {\n    setShowDialogUpload(false);\n  };\n\n  const handleProfileMenu = (event) => {\n    setMenuProfile(event.currentTarget);\n  };\n\n  const handleProfileMenuClose = () => {\n    setMenuProfile(null);\n  };\n\n  const menuLists = [\n    {\n      title: \"Увеличить\",\n      onClick: () => viewPhoto(),\n      id: Math.random() * 100000,\n    },\n   // {\n     // title: \"Take photo\",\n     // onClick: () => takePhoto(),\n      //id: Math.random() * 100000,\n    //},\n    {\n      title: uploadPhoto(),\n      onClick: () => handleUploadPhoto(),\n      id: Math.random() * 100000,\n    },\n   /* {\n      title: \"Removed photo\",\n      onClick: () => removedPhoto(),\n      id: Math.random() * 100000,\n    },*/\n  ];\n\n  return ( \n    <div>\n      {/*<span style={{fontSize:'10px'}}> Drawer-DrawerLeft.js</span>*/}\n      <Drawer\n        anchor=\"left\"\n        variant=\"persistent\"\n        open={drawerLeft}\n        classes={{ paper: classes.drawerPaper }}\n      >\n        <div className=\"drawerLeft__header\">\n          <div className=\"drawerLeft__header_container\">\n            <IconButton onClick={handleDrawerClose}>\n              <ArrowBackIcon />\n            </IconButton>\n            <p>Ваш профиль и ваша заявка</p>\n          </div>\n        </div>\n\n        <div className=\"drawerLeft__content\">\n          <div className=\"drawerLeft__content_photo\">\n            <div className=\"profilePhoto\">\n              <Zoom\n                in={drawerLeft}\n                style={{ transitionDelay: drawerLeft ? \"300ms\" : \"0ms\" }}\n              >\n                {photo ? (\n                  <Avatar src={photo} className=\"profilePhoto__layer_bottom\" />\n                ) : (\n                  <Avatar />\n                )}\n              </Zoom>\n              <div\n                className=\"profilePhoto__layer_top\"\n                onClick={handleProfileMenu}\n              >\n                <div className=\"profilePhoto__text\">\n                  <PhotoCameraIcon />\n                  <p>Изменить</p>\n                  <p>Фото</p>\n                </div>\n              </div>\n            </div> \n\n            <DropdownMenu\n              menuLists={menuLists}\n              menu={menuProfile}\n              handleMenuClose={handleProfileMenuClose}\n            />\n\n            <DialogCustom\n              open={showProfilePhoto}\n              close={viewPhotoClose}\n              photo={photo}\n              user={user} \n            />\n          </div>\n\n          <div className=\"profileMenu__diaglog\">\n            <Dialog\n              open={showDialogUpload}\n              onClose={handleDialogUploadClose}\n              aria-labelledby=\"form-dialog-title\"\n            >\n              <DialogTitle id=\"form-dialog-title-drawerLeft\">\n                Загрузить фото(если вы водитель, то можно фото машины)\n              </DialogTitle>\n              <DialogContent id=\"form-dialog-content\">\n                <div className=\"profileMenu__uploadPhoto_dialog\">\n                  <img src={uploadPhotoLink} alt=\"\" />\n                </div>\n              </DialogContent>\n              <DialogActions>\n                <div className=\"profileMenu_uploadPhoto_iconButton\">\n                  <IconButton onClick={handleUploadPhoto}>\n                    <CheckIcon />\n                  </IconButton>\n                </div>\n              </DialogActions>\n            </Dialog>\n          </div>\n\n          <div className=\"drawerLeft__content_name\">\n            <p>Ваше имя и предложение\n            {  localStorage.getItem(\"role\") == 'Водитель' ? (\n                 <span className=\"span_namer\">Например Вася, езжу каждый день в Макеевку, в 10 утра</span> \n            ):(\n              <span className=\"span_namer\">Например Аня, пассажир, езжу каждый день в центр Донецка с Текстильщика в 8 утра, кто подвезет?</span> \n            )\n\n            }\n            </p> \n            <form>\n              {showEditName ? (\n                <>\n                  <input\n                    value={name}\n                    onChange={(e) => setName(e.target.value)}\n                    type=\"text\"\n                    styles={{ borderBottom: \"1px solid green !important\" }}\n                    \n                  />\n                  <CheckIcon onClick={updateName} />\n                </>\n              ) : (\n                <>\n                  <span>{name}</span>\n                  <EditIcon onClick={editName} />\n                </>\n              )}\n            </form>\n          </div>\n\n          <div className=\"drawerLeft__note\">\n            <span>\n             Напишите имя и оставьте свое предложение\n            </span>\n          </div>\n\n          <div className=\"drawerLeft__content_name\">\n            <p>Телефон</p>\n            <form>\n              {showEditPhone ? (\n                <>\n                  <input\n                    value={phone}\n                    onChange={(e) => setPhone(e.target.value)}\n                    type=\"text\"\n                  />\n                  <CheckIcon onClick={updatePhone} />\n                </>\n              ) : (\n                <>\n                  <span>{phone}</span>\n                  <EditIcon onClick={editPhone} />\n                </>\n              )}\n            </form>\n          </div>\n          <div className=\"drawerLeft__content_name\">\n            <p>Обо мне</p>\n            <form>\n              {showEditAbout ? (\n                <>\n                  <input\n                    value={about}\n                    onChange={(e) => setAbout(e.target.value)}\n                    type=\"text\"\n                  />\n                  <CheckIcon onClick={updateAbout} />\n                </>\n              ) : (\n                <>\n                  <span>{about}</span>\n                  <EditIcon onClick={editAbout} />\n                </>\n              )}\n            </form>\n          </div>\n        </div>\n      </Drawer>\n    </div>\n  );\n}\n\nexport default DrawerLeft;\n"],"sourceRoot":""}